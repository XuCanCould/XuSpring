<!doctype html>
<html>
<head>
<meta charset='UTF-8'><meta name='viewport' content='width=device-width initial-scale=1'>

<link href='https://fonts.loli.net/css?family=Open+Sans:400italic,700italic,700,400&subset=latin,latin-ext' rel='stylesheet' type='text/css' /><style type='text/css'>html {overflow-x: initial !important;}:root { --bg-color:#ffffff; --text-color:#333333; --select-text-bg-color:#B5D6FC; --select-text-font-color:auto; --monospace:"Lucida Console",Consolas,"Courier",monospace; --title-bar-height:20px; }
.mac-os-11 { --title-bar-height:28px; }
html { font-size: 14px; background-color: var(--bg-color); color: var(--text-color); font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; -webkit-font-smoothing: antialiased; }
body { margin: 0px; padding: 0px; height: auto; inset: 0px; font-size: 1rem; line-height: 1.42857; overflow-x: hidden; background: inherit; tab-size: 4; }
iframe { margin: auto; }
a.url { word-break: break-all; }
a:active, a:hover { outline: 0px; }
.in-text-selection, ::selection { text-shadow: none; background: var(--select-text-bg-color); color: var(--select-text-font-color); }
#write { margin: 0px auto; height: auto; width: inherit; word-break: normal; overflow-wrap: break-word; position: relative; white-space: normal; overflow-x: visible; padding-top: 36px; }
#write.first-line-indent p { text-indent: 2em; }
#write.first-line-indent li p, #write.first-line-indent p * { text-indent: 0px; }
#write.first-line-indent li { margin-left: 2em; }
.for-image #write { padding-left: 8px; padding-right: 8px; }
body.typora-export { padding-left: 30px; padding-right: 30px; }
.typora-export .footnote-line, .typora-export li, .typora-export p { white-space: pre-wrap; }
.typora-export .task-list-item input { pointer-events: none; }
@media screen and (max-width: 500px) {
  body.typora-export { padding-left: 0px; padding-right: 0px; }
  #write { padding-left: 20px; padding-right: 20px; }
  .CodeMirror-sizer { margin-left: 0px !important; }
  .CodeMirror-gutters { display: none !important; }
}
#write li > figure:last-child { margin-bottom: 0.5rem; }
#write ol, #write ul { position: relative; }
img { max-width: 100%; vertical-align: middle; image-orientation: from-image; }
button, input, select, textarea { color: inherit; font: inherit; }
input[type="checkbox"], input[type="radio"] { line-height: normal; padding: 0px; }
*, ::after, ::before { box-sizing: border-box; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p, #write pre { width: inherit; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p { position: relative; }
p { line-height: inherit; }
h1, h2, h3, h4, h5, h6 { break-after: avoid-page; break-inside: avoid; orphans: 4; }
p { orphans: 4; }
h1 { font-size: 2rem; }
h2 { font-size: 1.8rem; }
h3 { font-size: 1.6rem; }
h4 { font-size: 1.4rem; }
h5 { font-size: 1.2rem; }
h6 { font-size: 1rem; }
.md-math-block, .md-rawblock, h1, h2, h3, h4, h5, h6, p { margin-top: 1rem; margin-bottom: 1rem; }
.hidden { display: none; }
.md-blockmeta { color: rgb(204, 204, 204); font-weight: 700; font-style: italic; }
a { cursor: pointer; }
sup.md-footnote { padding: 2px 4px; background-color: rgba(238, 238, 238, 0.7); color: rgb(85, 85, 85); border-radius: 4px; cursor: pointer; }
sup.md-footnote a, sup.md-footnote a:hover { color: inherit; text-transform: inherit; text-decoration: inherit; }
#write input[type="checkbox"] { cursor: pointer; width: inherit; height: inherit; }
figure { overflow-x: auto; margin: 1.2em 0px; max-width: calc(100% + 16px); padding: 0px; }
figure > table { margin: 0px; }
tr { break-inside: avoid; break-after: auto; }
thead { display: table-header-group; }
table { border-collapse: collapse; border-spacing: 0px; width: 100%; overflow: auto; break-inside: auto; text-align: left; }
table.md-table td { min-width: 32px; }
.CodeMirror-gutters { border-right: 0px; background-color: inherit; }
.CodeMirror-linenumber { user-select: none; }
.CodeMirror { text-align: left; }
.CodeMirror-placeholder { opacity: 0.3; }
.CodeMirror pre { padding: 0px 4px; }
.CodeMirror-lines { padding: 0px; }
div.hr:focus { cursor: none; }
#write pre { white-space: pre-wrap; }
#write.fences-no-line-wrapping pre { white-space: pre; }
#write pre.ty-contain-cm { white-space: normal; }
.CodeMirror-gutters { margin-right: 4px; }
.md-fences { font-size: 0.9rem; display: block; break-inside: avoid; text-align: left; overflow: visible; white-space: pre; background: inherit; position: relative !important; }
.md-fences-adv-panel { width: 100%; margin-top: 10px; text-align: center; padding-top: 0px; padding-bottom: 8px; overflow-x: auto; }
#write .md-fences.mock-cm { white-space: pre-wrap; }
.md-fences.md-fences-with-lineno { padding-left: 0px; }
#write.fences-no-line-wrapping .md-fences.mock-cm { white-space: pre; overflow-x: auto; }
.md-fences.mock-cm.md-fences-with-lineno { padding-left: 8px; }
.CodeMirror-line, twitterwidget { break-inside: avoid; }
.footnotes { opacity: 0.8; font-size: 0.9rem; margin-top: 1em; margin-bottom: 1em; }
.footnotes + .footnotes { margin-top: 0px; }
.md-reset { margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: top; background: 0px 0px; text-decoration: none; text-shadow: none; float: none; position: static; width: auto; height: auto; white-space: nowrap; cursor: inherit; -webkit-tap-highlight-color: transparent; line-height: normal; font-weight: 400; text-align: left; box-sizing: content-box; direction: ltr; }
li div { padding-top: 0px; }
blockquote { margin: 1rem 0px; }
li .mathjax-block, li p { margin: 0.5rem 0px; }
li blockquote { margin: 1rem 0px; }
li { margin: 0px; position: relative; }
blockquote > :last-child { margin-bottom: 0px; }
blockquote > :first-child, li > :first-child { margin-top: 0px; }
.footnotes-area { color: rgb(136, 136, 136); margin-top: 0.714rem; padding-bottom: 0.143rem; white-space: normal; }
#write .footnote-line { white-space: pre-wrap; }
@media print {
  body, html { border: 1px solid transparent; height: 99%; break-after: avoid; break-before: avoid; font-variant-ligatures: no-common-ligatures; }
  #write { margin-top: 0px; padding-top: 0px; border-color: transparent !important; }
  .typora-export * { -webkit-print-color-adjust: exact; }
  .typora-export #write { break-after: avoid; }
  .typora-export #write::after { height: 0px; }
  .is-mac table { break-inside: avoid; }
  .typora-export-show-outline .typora-export-sidebar { display: none; }
}
.footnote-line { margin-top: 0.714em; font-size: 0.7em; }
a img, img a { cursor: pointer; }
pre.md-meta-block { font-size: 0.8rem; min-height: 0.8rem; white-space: pre-wrap; background: rgb(204, 204, 204); display: block; overflow-x: hidden; }
p > .md-image:only-child:not(.md-img-error) img, p > img:only-child { display: block; margin: auto; }
#write.first-line-indent p > .md-image:only-child:not(.md-img-error) img { left: -2em; position: relative; }
p > .md-image:only-child { display: inline-block; width: 100%; }
#write .MathJax_Display { margin: 0.8em 0px 0px; }
.md-math-block { width: 100%; }
.md-math-block:not(:empty)::after { display: none; }
.MathJax_ref { fill: currentcolor; }
[contenteditable="true"]:active, [contenteditable="true"]:focus, [contenteditable="false"]:active, [contenteditable="false"]:focus { outline: 0px; box-shadow: none; }
.md-task-list-item { position: relative; list-style-type: none; }
.task-list-item.md-task-list-item { padding-left: 0px; }
.md-task-list-item > input { position: absolute; top: 0px; left: 0px; margin-left: -1.2em; margin-top: calc(1em - 10px); border: none; }
.math { font-size: 1rem; }
.md-toc { min-height: 3.58rem; position: relative; font-size: 0.9rem; border-radius: 10px; }
.md-toc-content { position: relative; margin-left: 0px; }
.md-toc-content::after, .md-toc::after { display: none; }
.md-toc-item { display: block; color: rgb(65, 131, 196); }
.md-toc-item a { text-decoration: none; }
.md-toc-inner:hover { text-decoration: underline; }
.md-toc-inner { display: inline-block; cursor: pointer; }
.md-toc-h1 .md-toc-inner { margin-left: 0px; font-weight: 700; }
.md-toc-h2 .md-toc-inner { margin-left: 2em; }
.md-toc-h3 .md-toc-inner { margin-left: 4em; }
.md-toc-h4 .md-toc-inner { margin-left: 6em; }
.md-toc-h5 .md-toc-inner { margin-left: 8em; }
.md-toc-h6 .md-toc-inner { margin-left: 10em; }
@media screen and (max-width: 48em) {
  .md-toc-h3 .md-toc-inner { margin-left: 3.5em; }
  .md-toc-h4 .md-toc-inner { margin-left: 5em; }
  .md-toc-h5 .md-toc-inner { margin-left: 6.5em; }
  .md-toc-h6 .md-toc-inner { margin-left: 8em; }
}
a.md-toc-inner { font-size: inherit; font-style: inherit; font-weight: inherit; line-height: inherit; }
.footnote-line a:not(.reversefootnote) { color: inherit; }
.md-attr { display: none; }
.md-fn-count::after { content: "."; }
code, pre, samp, tt { font-family: var(--monospace); }
kbd { margin: 0px 0.1em; padding: 0.1em 0.6em; font-size: 0.8em; color: rgb(36, 39, 41); background: rgb(255, 255, 255); border: 1px solid rgb(173, 179, 185); border-radius: 3px; box-shadow: rgba(12, 13, 14, 0.2) 0px 1px 0px, rgb(255, 255, 255) 0px 0px 0px 2px inset; white-space: nowrap; vertical-align: middle; }
.md-comment { color: rgb(162, 127, 3); opacity: 0.6; font-family: var(--monospace); }
code { text-align: left; vertical-align: initial; }
a.md-print-anchor { white-space: pre !important; border-width: initial !important; border-style: none !important; border-color: initial !important; display: inline-block !important; position: absolute !important; width: 1px !important; right: 0px !important; outline: 0px !important; background: 0px 0px !important; text-decoration: initial !important; text-shadow: initial !important; }
.os-windows.monocolor-emoji .md-emoji { font-family: "Segoe UI Symbol", sans-serif; }
.md-diagram-panel > svg { max-width: 100%; }
[lang="flow"] svg, [lang="mermaid"] svg { max-width: 100%; height: auto; }
[lang="mermaid"] .node text { font-size: 1rem; }
table tr th { border-bottom: 0px; }
video { max-width: 100%; display: block; margin: 0px auto; }
iframe { max-width: 100%; width: 100%; border: none; }
.highlight td, .highlight tr { border: 0px; }
mark { background: rgb(255, 255, 0); color: rgb(0, 0, 0); }
.md-html-inline .md-plain, .md-html-inline strong, mark .md-inline-math, mark strong { color: inherit; }
.md-expand mark .md-meta { opacity: 0.3 !important; }
mark .md-meta { color: rgb(0, 0, 0); }
@media print {
  .typora-export h1, .typora-export h2, .typora-export h3, .typora-export h4, .typora-export h5, .typora-export h6 { break-inside: avoid; }
}
.md-diagram-panel .messageText { stroke: none !important; }
.md-diagram-panel .start-state { fill: var(--node-fill); }
.md-diagram-panel .edgeLabel rect { opacity: 1 !important; }
.md-fences.md-fences-math { font-size: 1em; }
.md-fences-advanced:not(.md-focus) { padding: 0px; white-space: nowrap; border: 0px; }
.md-fences-advanced:not(.md-focus) { background: inherit; }
.typora-export-show-outline .typora-export-content { max-width: 1440px; margin: auto; display: flex; flex-direction: row; }
.typora-export-sidebar { width: 300px; font-size: 0.8rem; margin-top: 80px; margin-right: 18px; }
.typora-export-show-outline #write { --webkit-flex:2; flex: 2 1 0%; }
.typora-export-sidebar .outline-content { position: fixed; top: 0px; max-height: 100%; overflow: hidden auto; padding-bottom: 30px; padding-top: 60px; width: 300px; }
@media screen and (max-width: 1024px) {
  .typora-export-sidebar, .typora-export-sidebar .outline-content { width: 240px; }
}
@media screen and (max-width: 800px) {
  .typora-export-sidebar { display: none; }
}
.outline-content li, .outline-content ul { margin-left: 0px; margin-right: 0px; padding-left: 0px; padding-right: 0px; list-style: none; }
.outline-content ul { margin-top: 0px; margin-bottom: 0px; }
.outline-content strong { font-weight: 400; }
.outline-expander { width: 1rem; height: 1.42857rem; position: relative; display: table-cell; vertical-align: middle; cursor: pointer; padding-left: 4px; }
.outline-expander::before { content: "ï„¥"; position: relative; font-family: Ionicons; display: inline-block; font-size: 8px; vertical-align: middle; }
.outline-item { padding-top: 3px; padding-bottom: 3px; cursor: pointer; }
.outline-expander:hover::before { content: "ï„£"; }
.outline-h1 > .outline-item { padding-left: 0px; }
.outline-h2 > .outline-item { padding-left: 1em; }
.outline-h3 > .outline-item { padding-left: 2em; }
.outline-h4 > .outline-item { padding-left: 3em; }
.outline-h5 > .outline-item { padding-left: 4em; }
.outline-h6 > .outline-item { padding-left: 5em; }
.outline-label { cursor: pointer; display: table-cell; vertical-align: middle; text-decoration: none; color: inherit; }
.outline-label:hover { text-decoration: underline; }
.outline-item:hover { border-color: rgb(245, 245, 245); background-color: var(--item-hover-bg-color); }
.outline-item:hover { margin-left: -28px; margin-right: -28px; border-left: 28px solid transparent; border-right: 28px solid transparent; }
.outline-item-single .outline-expander::before, .outline-item-single .outline-expander:hover::before { display: none; }
.outline-item-open > .outline-item > .outline-expander::before { content: "ï„£"; }
.outline-children { display: none; }
.info-panel-tab-wrapper { display: none; }
.outline-item-open > .outline-children { display: block; }
.typora-export .outline-item { padding-top: 1px; padding-bottom: 1px; }
.typora-export .outline-item:hover { margin-right: -8px; border-right: 8px solid transparent; }
.typora-export .outline-expander::before { content: "+"; font-family: inherit; top: -1px; }
.typora-export .outline-expander:hover::before, .typora-export .outline-item-open > .outline-item > .outline-expander::before { content: "âˆ’"; }
.typora-export-collapse-outline .outline-children { display: none; }
.typora-export-collapse-outline .outline-item-open > .outline-children, .typora-export-no-collapse-outline .outline-children { display: block; }
.typora-export-no-collapse-outline .outline-expander::before { content: "" !important; }
.typora-export-show-outline .outline-item-active > .outline-item .outline-label { font-weight: 700; }
.md-inline-math-container mjx-container { zoom: 0.95; }


.CodeMirror { height: auto; }
.CodeMirror.cm-s-inner { background: inherit; }
.CodeMirror-scroll { overflow: auto hidden; z-index: 3; }
.CodeMirror-gutter-filler, .CodeMirror-scrollbar-filler { background-color: rgb(255, 255, 255); }
.CodeMirror-gutters { border-right: 1px solid rgb(221, 221, 221); background: inherit; white-space: nowrap; }
.CodeMirror-linenumber { padding: 0px 3px 0px 5px; text-align: right; color: rgb(153, 153, 153); }
.cm-s-inner .cm-keyword { color: rgb(119, 0, 136); }
.cm-s-inner .cm-atom, .cm-s-inner.cm-atom { color: rgb(34, 17, 153); }
.cm-s-inner .cm-number { color: rgb(17, 102, 68); }
.cm-s-inner .cm-def { color: rgb(0, 0, 255); }
.cm-s-inner .cm-variable { color: rgb(0, 0, 0); }
.cm-s-inner .cm-variable-2 { color: rgb(0, 85, 170); }
.cm-s-inner .cm-variable-3 { color: rgb(0, 136, 85); }
.cm-s-inner .cm-string { color: rgb(170, 17, 17); }
.cm-s-inner .cm-property { color: rgb(0, 0, 0); }
.cm-s-inner .cm-operator { color: rgb(152, 26, 26); }
.cm-s-inner .cm-comment, .cm-s-inner.cm-comment { color: rgb(170, 85, 0); }
.cm-s-inner .cm-string-2 { color: rgb(255, 85, 0); }
.cm-s-inner .cm-meta { color: rgb(85, 85, 85); }
.cm-s-inner .cm-qualifier { color: rgb(85, 85, 85); }
.cm-s-inner .cm-builtin { color: rgb(51, 0, 170); }
.cm-s-inner .cm-bracket { color: rgb(153, 153, 119); }
.cm-s-inner .cm-tag { color: rgb(17, 119, 0); }
.cm-s-inner .cm-attribute { color: rgb(0, 0, 204); }
.cm-s-inner .cm-header, .cm-s-inner.cm-header { color: rgb(0, 0, 255); }
.cm-s-inner .cm-quote, .cm-s-inner.cm-quote { color: rgb(0, 153, 0); }
.cm-s-inner .cm-hr, .cm-s-inner.cm-hr { color: rgb(153, 153, 153); }
.cm-s-inner .cm-link, .cm-s-inner.cm-link { color: rgb(0, 0, 204); }
.cm-negative { color: rgb(221, 68, 68); }
.cm-positive { color: rgb(34, 153, 34); }
.cm-header, .cm-strong { font-weight: 700; }
.cm-del { text-decoration: line-through; }
.cm-em { font-style: italic; }
.cm-link { text-decoration: underline; }
.cm-error { color: red; }
.cm-invalidchar { color: red; }
.cm-constant { color: rgb(38, 139, 210); }
.cm-defined { color: rgb(181, 137, 0); }
div.CodeMirror span.CodeMirror-matchingbracket { color: rgb(0, 255, 0); }
div.CodeMirror span.CodeMirror-nonmatchingbracket { color: rgb(255, 34, 34); }
.cm-s-inner .CodeMirror-activeline-background { background: inherit; }
.CodeMirror { position: relative; overflow: hidden; }
.CodeMirror-scroll { height: 100%; outline: 0px; position: relative; box-sizing: content-box; background: inherit; }
.CodeMirror-sizer { position: relative; }
.CodeMirror-gutter-filler, .CodeMirror-hscrollbar, .CodeMirror-scrollbar-filler, .CodeMirror-vscrollbar { position: absolute; z-index: 6; display: none; outline: 0px; }
.CodeMirror-vscrollbar { right: 0px; top: 0px; overflow: hidden; }
.CodeMirror-hscrollbar { bottom: 0px; left: 0px; overflow: auto hidden; }
.CodeMirror-scrollbar-filler { right: 0px; bottom: 0px; }
.CodeMirror-gutter-filler { left: 0px; bottom: 0px; }
.CodeMirror-gutters { position: absolute; left: 0px; top: 0px; padding-bottom: 10px; z-index: 3; overflow-y: hidden; }
.CodeMirror-gutter { white-space: normal; height: 100%; box-sizing: content-box; padding-bottom: 30px; margin-bottom: -32px; display: inline-block; }
.CodeMirror-gutter-wrapper { position: absolute; z-index: 4; background: 0px 0px !important; border: none !important; }
.CodeMirror-gutter-background { position: absolute; top: 0px; bottom: 0px; z-index: 4; }
.CodeMirror-gutter-elt { position: absolute; cursor: default; z-index: 4; }
.CodeMirror-lines { cursor: text; }
.CodeMirror pre { border-radius: 0px; border-width: 0px; background: 0px 0px; font-family: inherit; font-size: inherit; margin: 0px; white-space: pre; overflow-wrap: normal; color: inherit; z-index: 2; position: relative; overflow: visible; }
.CodeMirror-wrap pre { overflow-wrap: break-word; white-space: pre-wrap; word-break: normal; }
.CodeMirror-code pre { border-right: 30px solid transparent; width: fit-content; }
.CodeMirror-wrap .CodeMirror-code pre { border-right: none; width: auto; }
.CodeMirror-linebackground { position: absolute; inset: 0px; z-index: 0; }
.CodeMirror-linewidget { position: relative; z-index: 2; overflow: auto; }
.CodeMirror-wrap .CodeMirror-scroll { overflow-x: hidden; }
.CodeMirror-measure { position: absolute; width: 100%; height: 0px; overflow: hidden; visibility: hidden; }
.CodeMirror-measure pre { position: static; }
.CodeMirror div.CodeMirror-cursor { position: absolute; visibility: hidden; border-right: none; width: 0px; }
.CodeMirror div.CodeMirror-cursor { visibility: hidden; }
.CodeMirror-focused div.CodeMirror-cursor { visibility: inherit; }
.cm-searching { background: rgba(255, 255, 0, 0.4); }
span.cm-underlined { text-decoration: underline; }
span.cm-strikethrough { text-decoration: line-through; }
.cm-tw-syntaxerror { color: rgb(255, 255, 255); background-color: rgb(153, 0, 0); }
.cm-tw-deleted { text-decoration: line-through; }
.cm-tw-header5 { font-weight: 700; }
.cm-tw-listitem:first-child { padding-left: 10px; }
.cm-tw-box { border-style: solid; border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-color: inherit; border-top-width: 0px !important; }
.cm-tw-underline { text-decoration: underline; }
@media print {
  .CodeMirror div.CodeMirror-cursor { visibility: hidden; }
}


:root {
    --side-bar-bg-color: #fafafa;
    --control-text-color: #777;
}

@include-when-export url(https://fonts.loli.net/css?family=Open+Sans:400italic,700italic,700,400&subset=latin,latin-ext);

/* open-sans-regular - latin-ext_latin */
  /* open-sans-italic - latin-ext_latin */
    /* open-sans-700 - latin-ext_latin */
    /* open-sans-700italic - latin-ext_latin */
  html {
    font-size: 16px;
    -webkit-font-smoothing: antialiased;
}

body {
    font-family: "Open Sans","Clear Sans", "Helvetica Neue", Helvetica, Arial, 'Segoe UI Emoji', sans-serif;
    color: rgb(51, 51, 51);
    line-height: 1.6;
}

#write {
    max-width: 860px;
  	margin: 0 auto;
  	padding: 30px;
    padding-bottom: 100px;
}

@media only screen and (min-width: 1400px) {
	#write {
		max-width: 1024px;
	}
}

@media only screen and (min-width: 1800px) {
	#write {
		max-width: 1200px;
	}
}

#write > ul:first-child,
#write > ol:first-child{
    margin-top: 30px;
}

a {
    color: #4183C4;
}
h1,
h2,
h3,
h4,
h5,
h6 {
    position: relative;
    margin-top: 1rem;
    margin-bottom: 1rem;
    font-weight: bold;
    line-height: 1.4;
    cursor: text;
}
h1:hover a.anchor,
h2:hover a.anchor,
h3:hover a.anchor,
h4:hover a.anchor,
h5:hover a.anchor,
h6:hover a.anchor {
    text-decoration: none;
}
h1 tt,
h1 code {
    font-size: inherit;
}
h2 tt,
h2 code {
    font-size: inherit;
}
h3 tt,
h3 code {
    font-size: inherit;
}
h4 tt,
h4 code {
    font-size: inherit;
}
h5 tt,
h5 code {
    font-size: inherit;
}
h6 tt,
h6 code {
    font-size: inherit;
}
h1 {
    font-size: 2.25em;
    line-height: 1.2;
    border-bottom: 1px solid #eee;
}
h2 {
    font-size: 1.75em;
    line-height: 1.225;
    border-bottom: 1px solid #eee;
}

/*@media print {
    .typora-export h1,
    .typora-export h2 {
        border-bottom: none;
        padding-bottom: initial;
    }

    .typora-export h1::after,
    .typora-export h2::after {
        content: "";
        display: block;
        height: 100px;
        margin-top: -96px;
        border-top: 1px solid #eee;
    }
}*/

h3 {
    font-size: 1.5em;
    line-height: 1.43;
}
h4 {
    font-size: 1.25em;
}
h5 {
    font-size: 1em;
}
h6 {
   font-size: 1em;
    color: #777;
}
p,
blockquote,
ul,
ol,
dl,
table{
    margin: 0.8em 0;
}
li>ol,
li>ul {
    margin: 0 0;
}
hr {
    height: 2px;
    padding: 0;
    margin: 16px 0;
    background-color: #e7e7e7;
    border: 0 none;
    overflow: hidden;
    box-sizing: content-box;
}

li p.first {
    display: inline-block;
}
ul,
ol {
    padding-left: 30px;
}
ul:first-child,
ol:first-child {
    margin-top: 0;
}
ul:last-child,
ol:last-child {
    margin-bottom: 0;
}
blockquote {
    border-left: 4px solid #dfe2e5;
    padding: 0 15px;
    color: #777777;
}
blockquote blockquote {
    padding-right: 0;
}
table {
    padding: 0;
    word-break: initial;
}
table tr {
    border: 1px solid #dfe2e5;
    margin: 0;
    padding: 0;
}
table tr:nth-child(2n),
thead {
    background-color: #f8f8f8;
}
table th {
    font-weight: bold;
    border: 1px solid #dfe2e5;
    border-bottom: 0;
    margin: 0;
    padding: 6px 13px;
}
table td {
    border: 1px solid #dfe2e5;
    margin: 0;
    padding: 6px 13px;
}
table th:first-child,
table td:first-child {
    margin-top: 0;
}
table th:last-child,
table td:last-child {
    margin-bottom: 0;
}

.CodeMirror-lines {
    padding-left: 4px;
}

.code-tooltip {
    box-shadow: 0 1px 1px 0 rgba(0,28,36,.3);
    border-top: 1px solid #eef2f2;
}

.md-fences,
code,
tt {
    border: 1px solid #e7eaed;
    background-color: #f8f8f8;
    border-radius: 3px;
    padding: 0;
    padding: 2px 4px 0px 4px;
    font-size: 0.9em;
}

code {
    background-color: #f3f4f4;
    padding: 0 2px 0 2px;
}

.md-fences {
    margin-bottom: 15px;
    margin-top: 15px;
    padding-top: 8px;
    padding-bottom: 6px;
}


.md-task-list-item > input {
  margin-left: -1.3em;
}

@media print {
    html {
        font-size: 13px;
    }
    table,
    pre {
        page-break-inside: avoid;
    }
    pre {
        word-wrap: break-word;
    }
}

.md-fences {
	background-color: #f8f8f8;
}
#write pre.md-meta-block {
	padding: 1rem;
    font-size: 85%;
    line-height: 1.45;
    background-color: #f7f7f7;
    border: 0;
    border-radius: 3px;
    color: #777777;
    margin-top: 0 !important;
}

.mathjax-block>.code-tooltip {
	bottom: .375rem;
}

.md-mathjax-midline {
    background: #fafafa;
}

#write>h3.md-focus:before{
	left: -1.5625rem;
	top: .375rem;
}
#write>h4.md-focus:before{
	left: -1.5625rem;
	top: .285714286rem;
}
#write>h5.md-focus:before{
	left: -1.5625rem;
	top: .285714286rem;
}
#write>h6.md-focus:before{
	left: -1.5625rem;
	top: .285714286rem;
}
.md-image>.md-meta {
    /*border: 1px solid #ddd;*/
    border-radius: 3px;
    padding: 2px 0px 0px 4px;
    font-size: 0.9em;
    color: inherit;
}

.md-tag {
    color: #a7a7a7;
    opacity: 1;
}

.md-toc { 
    margin-top:20px;
    padding-bottom:20px;
}

.sidebar-tabs {
    border-bottom: none;
}

#typora-quick-open {
    border: 1px solid #ddd;
    background-color: #f8f8f8;
}

#typora-quick-open-item {
    background-color: #FAFAFA;
    border-color: #FEFEFE #e5e5e5 #e5e5e5 #eee;
    border-style: solid;
    border-width: 1px;
}

/** focus mode */
.on-focus-mode blockquote {
    border-left-color: rgba(85, 85, 85, 0.12);
}

header, .context-menu, .megamenu-content, footer{
    font-family: "Segoe UI", "Arial", sans-serif;
}

.file-node-content:hover .file-node-icon,
.file-node-content:hover .file-node-open-state{
    visibility: visible;
}

.mac-seamless-mode #typora-sidebar {
    background-color: #fafafa;
    background-color: var(--side-bar-bg-color);
}

.md-lang {
    color: #b4654d;
}

/*.html-for-mac {
    --item-hover-bg-color: #E6F0FE;
}*/

#md-notification .btn {
    border: 0;
}

.dropdown-menu .divider {
    border-color: #e5e5e5;
    opacity: 0.4;
}

.ty-preferences .window-content {
    background-color: #fafafa;
}

.ty-preferences .nav-group-item.active {
    color: white;
    background: #999;
}

.menu-item-container a.menu-style-btn {
    background-color: #f5f8fa;
    background-image: linear-gradient( 180deg , hsla(0, 0%, 100%, 0.8), hsla(0, 0%, 100%, 0)); 
}

#github {
            position: fixed;
            right: 10%;
            bottom: 5%;
        }

</style><title>XuSpring</title>
</head>
<body class='typora-export os-windows'><div class='typora-export-content'>
    <div id="github"><a href="https://github.com/XuCanCould/xuSpring">
        <svg t="1717935734821" class="icon" viewBox="0 0 1024 1024" version="1.1"
            xmlns="http://www.w3.org/2000/svg" p-id="4415" width="50" height="50">
            <path
                d="M695.765333 981.333333h-276.053333c-26.794667 0-47.317333-21.077333-47.317333-48.64V739.84c0-29.184 6.314667-56.746667 17.365333-81.066667-129.365333-48.64-214.528-150.784-214.528-264.277333 0-53.504 17.365333-103.765333 50.474667-147.498667-12.629333-42.154667-15.786667-95.658667-12.629334-157.269333C216.234667 62.122667 236.8 42.666667 261.973333 42.666667c14.208 0 134.101333 1.621333 203.52 64.853333a504.448 504.448 0 0 1 184.533334 0C717.866667 44.288 837.717333 42.666667 853.504 42.666667c25.216 0 45.738667 19.456 47.317333 45.397333 4.693333 61.610667 0 115.114667-12.629333 157.269333C921.301333 290.688 938.666667 340.906667 938.666667 392.832c0 113.493333-85.162667 215.637333-214.528 264.277333a207.786667 207.786667 0 0 1 17.365333 81.066667v192.896c1.578667 27.562667-20.48 50.261333-45.738667 50.261333z m-228.693333-97.28h181.333333V739.84c0-27.562667-12.586667-53.504-33.109333-71.338667-14.165333-11.349333-20.48-30.805333-15.786667-50.261333 4.778667-17.834667 18.944-32.426667 36.309334-35.669333 123.050667-24.32 208.213333-102.144 208.213333-189.696 0-47.018667-25.258667-82.688-45.738667-105.386667-14.208-14.549333-17.365333-35.626667-7.893333-55.082667 6.314667-12.970667 15.786667-40.533333 15.786667-89.173333-39.466667 6.485333-85.205333 19.456-102.528 45.397333-11.093333 16.213333-31.573333 24.32-50.474667 19.456a393.045333 393.045333 0 0 0-194.005333 0c-18.944 4.864-37.888-3.242667-50.474667-19.456-17.365333-25.941333-63.146667-38.912-102.528-45.397333 1.578667 48.64 9.429333 76.202667 15.786667 89.173333 7.850667 17.834667 4.693333 40.533333-7.936 55.082667-20.48 22.698667-45.738667 58.368-45.738667 105.386667 0 87.552 85.205333 163.754667 208.213333 189.696 17.365333 3.242667 31.573333 17.834667 36.266667 35.669333 4.736 17.834667-1.578667 37.290667-15.786667 50.261333a95.104 95.104 0 0 0-33.109333 71.296v144.298667h3.157333z"
                fill="#172B4D" p-id="4416"></path>
            <path
                d="M403.968 788.394667c-212.949333 0-309.162667-194.56-313.898667-202.666667-11.050667-24.32-1.578667-53.461333 20.48-64.810667 23.68-11.349333 52.053333-1.621333 63.146667 21.077334 3.114667 6.485333 80.426667 157.269333 241.28 149.162666 26.837333-1.621333 48.896 19.456 48.896 46.976 1.578667 27.562667-18.901333 50.261333-45.738667 50.261334h-14.165333z"
                fill="#172B4D" p-id="4417"></path>
        </svg>
    </a></div>
<div id='write' class=''>
<div id='write'  class=''><h1 id='spring'><span>ğŸ–Šç¬”è®° | æ‰‹å†™ç®€æ˜“çš„ Spring æ¡†æ¶</span></h1><h1 id='å†™åœ¨å¼€å§‹'><span>å†™åœ¨å¼€å§‹</span></h1><p><strong><span>ä¸ºä»€ä¹ˆå†™ï¼Ÿ</span></strong></p><p><span>è¿›è¡Œä¸€äº›é›•èŠ±æ“ä½œã€‚ã€‚ã€‚åç»­å†™ä¸€ä¸ªå°è®ºå›ï¼Œè®©è¿™ä¸ªå°é¡¹ç›®å¥½çœ‹ä¸€ç‚¹è€Œä¸”ä¹‹å‰æœ‰å­¦é•¿æåˆ°è‡ªå·±ä¹Ÿæƒ³å°è¯•ï¼Œäºæ˜¯æ•´ä¸ªé¡¹ç›®å°±å¼€å§‹äº†</span></p><h2 id='maven-å¤šæ¨¡å—'><span>maven å¤šæ¨¡å—</span></h2><p><span>å‚è€ƒçš„ </span><a href='https://github.com/michaelliao/summer-framework'><span>Summer Framework</span></a><span> ä½¿ç”¨äº†å¤šæ¨¡å—çš„é¡¹ç›®ã€‚</span></p><p><span>å…ˆåˆ›å»ºä¸€ä¸ªç©ºé¡¹ç›®ï¼Œä½†è¿™é‡Œç©ºé¡¹ç›®ä¸æ˜¯çˆ¶é¡¹ç›®ã€‚éœ€è¦æ–°å»ºæ¨¡å—ä½œä¸ºçˆ¶é¡¹ç›®ã€‚çˆ¶æ¨¡å—ä¸­åªæœ‰ </span><code>pom.xml</code><span> ä½†æ˜¯ç›´æ¥åˆ›å»ºç©ºmavené¡¹ç›®éœ€è¦æ³¨æ„çš„æ˜¯æŒ‡å®šåŸå‹ </span><code>archetype</code><span>ã€‚ç›´æ¥è‡ªå·±æŒ‡å®šé™¤äº†éœ€è¦ groupIdã€archetypeIdç­‰ï¼Œè¿˜éœ€è¦æŒ‡å®šé¡¹ç›®åŸå‹ï¼Œå¦åˆ™ä¼šå‡ºç° </span><code>The desired archetype does not exist</code><span> æŠ¥é”™ï¼Œè¿™é‡Œæ›´ä¾¿æ·çš„æ–¹å¼æ˜¯é€‰æ‹©æä¾›çš„åŸå‹ </span><code>maven-archetype-archetype</code><span>ã€‚</span></p><h1 id='èµ„æºå¤„ç†'><span>èµ„æºå¤„ç†</span></h1><p><span>ResourceResolver - æ‰«æç±»ï¼ŒpropertyResolver - å¤„ç†é…ç½®æ–‡ä»¶ã€‚</span></p><h2 id='resourceresolver'><span>ResourceResolver</span></h2><blockquote><p><span>è¯»å–èµ„æºæ–‡ä»¶ï¼Œå®é™…ä¸Šç›¸å½“äºå®ç°</span><code>@ComponentScan</code></p></blockquote><p><span>è™½ç„¶ç±»åŠ è½½å™¨å¯ä»¥æ ¹æ® </span><code>classpath</code><span> çš„å®šä½æ¥åŠ è½½ç±»åï¼Œä½†æ˜¯ä¸èƒ½ç›´æ¥æ‰«æç»™å‡ºåŒ…åä¸‹çš„æ‰€æœ‰ç±»ï¼Œæ‰€æœ‰è¦å®ç°  </span><code>@ComponentScan</code><span> ï¼Œå¾—åˆ°åˆ¶å®šåŒ…åä¸‹çš„å…¨éƒ¨ç±»ï¼Œéœ€è¦å¯¹ </span><code>classpath</code><span> è¿›è¡Œæ‰«æã€‚</span></p><p><span>äºæ˜¯ï¼Œæ‰«æç±» å˜æˆäº† æ‰«æè·¯å¾„ä¸‹çš„æ–‡ä»¶å¹¶æ‰¾åˆ°ç±»ã€‚</span></p><p><span>å°†å…·ä½“éœ€è¦æ‰«æçš„æ–‡ä»¶ç±»å‹äº¤ä¸ªè°ƒç”¨è€…ï¼Œå³ å°† </span><code>Function&lt;Resource, R&gt; mapper</code><span> ä½œä¸ºå‚æ•°ï¼Œä½¿å¾—è°ƒç”¨è¿™åªéœ€è¦å…³æ³¨å¦‚ä½•ä½¿ç”¨è¯¥æ–¹æ³•å’Œä¼ å…¥çš„è½¬æ¢é€»è¾‘ã€‚è€Œåœ¨è¿™é‡Œçš„å®ç°ï¼Œè¢«åˆ’åˆ†ä¸ºäº†ä¸‰ä¸ªæ–¹æ³•ï¼š</span></p><ul><li><code>scan</code><span> ä½œä¸ºå…¬å…±æ¥å£è¢«è°ƒç”¨ã€‚</span></li><li><code>scan0</code><span> è´Ÿè´£æ‰§è¡Œå®é™…æ‰«æçš„èµ·å§‹ç‚¹é€»è¾‘ï¼Œåˆ†ç¦»æ‰¾åˆ°èµ„æºå’Œå¤„ç†èµ„æºã€‚</span></li><li><code>scanFile</code><span> éå†æ–‡ä»¶ï¼Œåˆ›å»ºå…¶èµ„æºå¯¹è±¡ã€‚</span></li></ul><h3 id='scan0'><span>scan0</span></h3><p><code>Enumeration&lt;URL&gt; en</code><span> å­˜å‚¨éœ€è¦è¿›è¡Œæ‰«æçš„åŒ…åï¼Œè€Œæ–‡ä»¶ç±»å‹ä¼šåœ¨è·¯å¾„çš„æœ€å‰ç«¯æç¤ºï¼šä¾‹å¦‚</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="bash"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="bash"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.2px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">file:/E:/workspace/XuSpring/spring-context/target/test-classes/resourcesResolver/scan</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 22px;"></div><div class="CodeMirror-gutters" style="display: none; height: 22px;"></div></div></div></pre><p><span>æˆ‘ä»¬éœ€è¦è¿™é‡Œæç¤ºçš„æ–‡ä»¶ç±»å‹æ¥åˆ¤æ–­ä½¿ç”¨ä¸åŒçš„å¤„ç†ï¼Œå…·ä½“çš„å¤„ç†åœ¨è°ƒç”¨çš„ </span><code>scanFile</code><span> ä¸­</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.20117px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-operator">&lt;</span><span class="cm-variable">R</span><span class="cm-operator">&gt;</span> <span class="cm-variable-3">void</span> <span class="cm-def">scan0</span>(<span class="cm-variable-3">String</span> <span class="cm-variable">basePackagePath</span>, <span class="cm-variable-3">String</span> <span class="cm-variable">path</span>, <span class="cm-variable">List</span><span class="cm-operator">&lt;</span><span class="cm-variable">R</span><span class="cm-operator">&gt;</span> <span class="cm-variable">collector</span>, <span class="cm-variable">Function</span><span class="cm-operator">&lt;</span><span class="cm-variable">Resource</span>, <span class="cm-variable">R</span><span class="cm-operator">&gt;</span> <span class="cm-variable">mapper</span>) <span class="cm-keyword">throws</span> <span class="cm-variable">IOException</span>, <span class="cm-variable">URISyntaxException</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">logger</span>.<span class="cm-variable">atDebug</span>().<span class="cm-variable">log</span>(<span class="cm-string">"scan path: {}"</span>, <span class="cm-variable">path</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">Enumeration</span><span class="cm-operator">&lt;</span><span class="cm-variable">URL</span><span class="cm-operator">&gt;</span> <span class="cm-variable">en</span> <span class="cm-operator">=</span> <span class="cm-variable">getContextClassLoader</span>().<span class="cm-variable">getResources</span>(<span class="cm-variable">path</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">while</span> (<span class="cm-variable">en</span>.<span class="cm-variable">hasMoreElements</span>()) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">URL</span> <span class="cm-variable">url</span> <span class="cm-operator">=</span> <span class="cm-variable">en</span>.<span class="cm-variable">nextElement</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">URI</span> <span class="cm-variable">uri</span> <span class="cm-operator">=</span> <span class="cm-variable">url</span>.<span class="cm-variable">toURI</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// å»æ‰æœ«å°¾æ–œæ </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-3">String</span> <span class="cm-variable">uriStr</span> <span class="cm-operator">=</span> <span class="cm-variable">removeTrailingSlash</span>(<span class="cm-variable">uriToString</span>(<span class="cm-variable">uri</span>));</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// åŸºäºæ–œæ çš„åŸºç¡€åŒ…è·¯å¾„</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-3">String</span> <span class="cm-variable">uriBaseStr</span> <span class="cm-operator">=</span> <span class="cm-variable">uriStr</span>.<span class="cm-variable">substring</span>(<span class="cm-number">0</span>, <span class="cm-variable">uriStr</span>.<span class="cm-variable">length</span>() <span class="cm-operator">-</span> <span class="cm-variable">basePackagePath</span>.<span class="cm-variable">length</span>());</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">uriBaseStr</span>.<span class="cm-variable">startsWith</span>(<span class="cm-string">"file:"</span>)) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">uriBaseStr</span> <span class="cm-operator">=</span> <span class="cm-variable">uriBaseStr</span>.<span class="cm-variable">substring</span>(<span class="cm-number">5</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">uriBaseStr</span>.<span class="cm-variable">startsWith</span>(<span class="cm-string">"jar:"</span>)) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">scanFile</span>(<span class="cm-atom">true</span>, <span class="cm-variable">uriBaseStr</span>, <span class="cm-variable">jarUriToPath</span>(<span class="cm-variable">basePackagePath</span>, <span class="cm-variable">uri</span>), <span class="cm-variable">collector</span>, <span class="cm-variable">mapper</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  } <span class="cm-keyword">else</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">scanFile</span>(<span class="cm-atom">false</span>, <span class="cm-variable">uriBaseStr</span>, <span class="cm-variable">Paths</span>.<span class="cm-variable">get</span>(<span class="cm-variable">uri</span>), <span class="cm-variable">collector</span>, <span class="cm-variable">mapper</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 470px;"></div><div class="CodeMirror-gutters" style="display: none; height: 470px;"></div></div></div></pre><h3 id='scanfile'><span>scanFile</span></h3><p><span>å°†åˆ¶å®šçš„åŒ…åä½œä¸ºæ ¹ç›®å½•è¿›è¡Œæ‰«æã€‚æ³¨æ„åœ¨è°ƒç”¨è¿™ä¸ªæ–¹æ³•æ˜¯å»é™¤äº†æ–‡ä»¶è·¯å¾„çš„ </span><code>file:</code><span> è¡¨ç¤ºï¼Œè€Œåœ¨åˆ›å»ºèµ„æºæ—¶æ·»åŠ ï¼Œæ˜¯å› ä¸ºä½œä¸ºè·¯å¾„å‰ç¼€æ—¶ä¼šå½±å“æ–‡ä»¶çš„è®¿é—®ï¼Œè€Œæˆ‘ä»¬åˆéœ€è¦è¿™ä½œä¸ºæˆ‘ä»¬åç»­èµ„æºå¯¹è±¡çš„æ–‡ä»¶è®¿é—®æ ‡è¯†ã€‚</span></p><blockquote><p><code>Files::isRegularFile</code><span> æŒ‡çš„å¸¸è§„æ–‡ä»¶æ˜¯ä»€ä¹ˆï¼Ÿ</span></p><p><span>è®¡ç®—æœºæ–‡ä»¶ç³»ç»Ÿä¸­æœ€åŸºæœ¬ã€æœ€å¸¸è§çš„æ–‡ä»¶ç±»å‹ã€‚å®ƒä»¬ç”¨æ¥å­˜å‚¨ç”¨æˆ·æ•°æ®æˆ–ç¨‹åºä»£ç ï¼ŒåŒ…æ‹¬æ–‡æœ¬æ–‡ä»¶ã€å›¾åƒæ–‡ä»¶ã€éŸ³é¢‘æ–‡ä»¶ã€è§†é¢‘æ–‡ä»¶ã€æ–‡æ¡£ã€ç¨‹åºç­‰ã€‚</span></p><p><span>ä¸ä¹‹ç›¸å¯¹çš„æ˜¯ç³»ç»Ÿæ–‡ä»¶ï¼ˆå¦‚è®¾å¤‡æ–‡ä»¶ã€ç®¡é“ã€å¥—æ¥å­—ã€ç¬¦å·é“¾æ¥ç­‰ï¼‰ï¼Œè¿™äº›ç‰¹æ®Šç±»å‹çš„æ–‡ä»¶ä¸ç›´æ¥ç”¨äºå­˜å‚¨ç”¨æˆ·æ•°æ®ï¼Œè€Œæ˜¯æœåŠ¡äºæ“ä½œç³»ç»Ÿç®¡ç†å’Œè¿›ç¨‹é—´é€šä¿¡ç­‰åŠŸèƒ½ã€‚</span></p></blockquote><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.19922px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-operator">&lt;</span><span class="cm-variable">R</span><span class="cm-operator">&gt;</span> <span class="cm-variable-3">void</span> <span class="cm-def">scanFile</span>(<span class="cm-variable-3">boolean</span> <span class="cm-variable">isJar</span>, <span class="cm-variable-3">String</span> <span class="cm-variable">base</span>, <span class="cm-variable">Path</span> <span class="cm-variable">root</span>, <span class="cm-variable">List</span><span class="cm-operator">&lt;</span><span class="cm-variable">R</span><span class="cm-operator">&gt;</span> <span class="cm-variable">collector</span>, <span class="cm-variable">Function</span><span class="cm-operator">&lt;</span><span class="cm-variable">Resource</span>, <span class="cm-variable">R</span><span class="cm-operator">&gt;</span> <span class="cm-variable">mapper</span>) <span class="cm-keyword">throws</span> <span class="cm-variable">IOException</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-3">String</span> <span class="cm-variable">baseDir</span> <span class="cm-operator">=</span> <span class="cm-variable">removeTrailingSlash</span>(<span class="cm-variable">base</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">Files</span>.<span class="cm-variable">walk</span>(<span class="cm-variable">root</span>).<span class="cm-variable">filter</span>(<span class="cm-variable">Files</span>::<span class="cm-variable">isRegularFile</span>).<span class="cm-variable">forEach</span>(<span class="cm-variable">file</span> <span class="cm-operator">-&gt;</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">Resource</span> <span class="cm-variable">res</span> <span class="cm-operator">=</span> <span class="cm-atom">null</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">isJar</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">res</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">Resource</span>(<span class="cm-variable">baseDir</span>, <span class="cm-variable">removeLeadingSlash</span>(<span class="cm-variable">file</span>.<span class="cm-variable">toString</span>()));</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  } <span class="cm-keyword">else</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// æ™®é€šæ–‡ä»¶éœ€è¦åœ¨è·¯å¾„å‰åŠ  file: å¹¶ä¸”éœ€è¦å»æ‰å¼€å¤´çš„æ–œæ </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-3">String</span> <span class="cm-variable">path</span> <span class="cm-operator">=</span> <span class="cm-variable">file</span>.<span class="cm-variable">toString</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-3">String</span> <span class="cm-variable">name</span> <span class="cm-operator">=</span> <span class="cm-variable">removeLeadingSlash</span>(<span class="cm-variable">path</span>.<span class="cm-variable">substring</span>(<span class="cm-variable">baseDir</span>.<span class="cm-variable">length</span>()));</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">res</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">Resource</span>(<span class="cm-string">"file:"</span> <span class="cm-operator">+</span> <span class="cm-variable">path</span>, <span class="cm-variable">name</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">logger</span>.<span class="cm-variable">atDebug</span>().<span class="cm-variable">log</span>(<span class="cm-string">"found resource: {}"</span>, <span class="cm-variable">res</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">R</span> <span class="cm-variable">r</span> <span class="cm-operator">=</span> <span class="cm-variable">mapper</span>.<span class="cm-variable">apply</span>(<span class="cm-variable">res</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">r</span> <span class="cm-operator">!=</span> <span class="cm-atom">null</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">collector</span>.<span class="cm-variable">add</span>(<span class="cm-variable">r</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  });</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 448px;"></div><div class="CodeMirror-gutters" style="display: none; height: 448px;"></div></div></div></pre><p>&nbsp;</p><h2 id='porpertyresolver'><span>PorpertyResolver</span></h2><blockquote><p><span>è¯»å–é…ç½®æ–‡ä»¶ï¼Œå¹¶æ‰¾åˆ°éœ€è¦åœ¨å±æ€§ä¸Šæ³¨å…¥çš„å€¼</span></p></blockquote><p><span>åœ¨ </span><code>pom.xml</code><span> çš„è®¾ç½®äº†ï¼š</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="xml"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="xml"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.2px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">dependencyManagement</span><span class="cm-tag cm-bracket">&gt;</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">dependencies</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">dependency</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">groupId</span><span class="cm-tag cm-bracket">&gt;</span>org.junit<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">groupId</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">artifactId</span><span class="cm-tag cm-bracket">&gt;</span>junit-bom<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">artifactId</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">version</span><span class="cm-tag cm-bracket">&gt;</span>5.9.2<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">version</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">type</span><span class="cm-tag cm-bracket">&gt;</span>pom<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">type</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">scope</span><span class="cm-tag cm-bracket">&gt;</span>import<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">scope</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">dependency</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">dependencies</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">dependencyManagement</span><span class="cm-tag cm-bracket">&gt;</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 246px;"></div><div class="CodeMirror-gutters" style="display: none; height: 246px;"></div></div></div></pre><p><span>åœ¨dependencyManagementå…ƒç´ ä¸­å£°æ˜æ‰€ä¾èµ–çš„jaråŒ…çš„ç‰ˆæœ¬å·ç­‰ä¿¡æ¯ï¼Œé‚£ä¹ˆæ‰€æœ‰å­é¡¹ç›®å†æ¬¡å¼•å…¥æ­¤ä¾èµ–jaråŒ…æ—¶åˆ™æ— éœ€æ˜¾å¼çš„åˆ—å‡ºç‰ˆæœ¬å·ã€‚Mavenä¼šæ²¿ç€çˆ¶å­å±‚çº§å‘ä¸Šå¯»æ‰¾æ‹¥æœ‰dependencyManagement å…ƒç´ çš„é¡¹ç›®ï¼Œç„¶åä½¿ç”¨å®ƒæŒ‡å®šçš„ç‰ˆæœ¬å·ã€‚</span></p><p><strong><span>ä½¿ç”¨ä¼˜ç‚¹</span></strong></p><p><span>å¦‚æœæœ‰å¤šä¸ªå­é¡¹ç›®éƒ½å¼•ç”¨åŒä¸€æ ·ä¾èµ–ï¼Œåˆ™å¯ä»¥é¿å…åœ¨æ¯ä¸ªä½¿ç”¨çš„å­é¡¹ç›®é‡Œéƒ½å£°æ˜ä¸€ä¸ªç‰ˆæœ¬å·ã€‚å½“æƒ³å‡çº§æˆ–åˆ‡æ¢åˆ°å¦ä¸€ä¸ªç‰ˆæœ¬æ—¶ï¼Œåªéœ€è¦åœ¨é¡¶å±‚çˆ¶å®¹å™¨é‡Œæ›´æ–°ï¼Œè€Œä¸éœ€è¦é€ä¸ªä¿®æ”¹å­é¡¹ç›®ï¼›å¦å¤–å¦‚æœæŸä¸ªå­é¡¹ç›®éœ€è¦å¦å¤–çš„ä¸€ä¸ªç‰ˆæœ¬ï¼Œåªéœ€è¦å£°æ˜versionå³å¯ã€‚</span></p><p><span>è¿˜å¯¼å…¥äº†ä¸€äº›åŸºæœ¬é…ç½®ï¼š</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="xml" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="xml"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.2px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">&lt;!-- æ³¨è§£ --&gt;</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">dependency</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">groupId</span><span class="cm-tag cm-bracket">&gt;</span>jakarta.annotation<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">groupId</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">artifactId</span><span class="cm-tag cm-bracket">&gt;</span>jakarta.annotation-api<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">artifactId</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">version</span><span class="cm-tag cm-bracket">&gt;</span>2.1.1<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">version</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">dependency</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">&lt;!-- æ—¥å¿—æŠ½è±¡å±‚ --&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">dependency</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">groupId</span><span class="cm-tag cm-bracket">&gt;</span>org.slf4j<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">groupId</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">artifactId</span><span class="cm-tag cm-bracket">&gt;</span>slf4j-api<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">artifactId</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">version</span><span class="cm-tag cm-bracket">&gt;</span>2.0.7<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">version</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">dependency</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">&lt;!-- å®é™…çš„æ—¥å¿—æ¡†æ¶ SLF4Jçš„å®ç° --&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">dependency</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">groupId</span><span class="cm-tag cm-bracket">&gt;</span>ch.qos.logback<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">groupId</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">artifactId</span><span class="cm-tag cm-bracket">&gt;</span>logback-classic<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">artifactId</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">version</span><span class="cm-tag cm-bracket">&gt;</span>1.4.12<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">version</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">dependency</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">&lt;!-- YAMLè§£æå™¨å’Œç”Ÿæˆå™¨åº“ --&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">dependency</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">groupId</span><span class="cm-tag cm-bracket">&gt;</span>org.yaml<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">groupId</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">artifactId</span><span class="cm-tag cm-bracket">&gt;</span>snakeyaml<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">artifactId</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">version</span><span class="cm-tag cm-bracket">&gt;</span>2.0<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">version</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">dependency</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">&lt;!-- å•å…ƒæµ‹è¯• --&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">dependency</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">groupId</span><span class="cm-tag cm-bracket">&gt;</span>org.junit.jupiter<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">groupId</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">artifactId</span><span class="cm-tag cm-bracket">&gt;</span>junit-jupiter<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">artifactId</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">scope</span><span class="cm-tag cm-bracket">&gt;</span>test<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">scope</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">dependency</span><span class="cm-tag cm-bracket">&gt;</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 762px;"></div><div class="CodeMirror-gutters" style="display: none; height: 762px;"></div></div></div></pre><h3 id='æ€è·¯'><span>æ€è·¯</span></h3><p><span>åˆ›å»ºå¹¶å®ç°å±æ€§è§£æå™¨ï¼Œè§£æå’Œè·å–ç³»ç»Ÿç¯å¢ƒå˜é‡ä¸­çš„å±æ€§å€¼ã€‚</span></p><p><span>æ— è®ºæ˜¯è¿™é‡Œè¿˜æ˜¯ä¸€èˆ¬çš„æ–‡ä»¶å¤„ç†éƒ½å¯ä»¥åˆ†ä¸ºä¸¤æ­¥ï¼š</span></p><ol start='' ><li><span>é€šè¿‡æ–‡ä»¶è·¯å¾„æ‰“å¼€æ–‡ä»¶ï¼ˆè·¯å¾„æŒ‡å®šï¼‰</span></li><li><span>å¾—åˆ°æ–‡ä»¶å¯¹è±¡è¿›è¡Œæ“ä½œï¼ˆå†…å®¹å¤„ç†ï¼‰</span></li><li><span>æ‰©å±•å¸¸ç”¨é…ç½®æ–‡ä»¶ç±»å‹ </span><code>yml</code><span> çš„å¤„ç†</span></li></ol><h4 id='è·¯å¾„æŒ‡å®šå’Œæ‰“å¼€-1'><span>è·¯å¾„æŒ‡å®šå’Œæ‰“å¼€</span></h4><p><span>åœ¨ </span><code>ClassPathUtils</code><span> ä¸­ç¼–å†™äº†é€šè¿‡æ–‡ä»¶è·¯å¾„æ‰“å¼€æ–‡ä»¶ï¼Œè€Œè¿™é‡Œç›´æ¥è¿”å›æ–‡ä»¶æµå¤„ç†åçš„ç»“æœï¼Œä½†é€šè¿‡æ¥å£çš„ä½¿ç”¨ï¼Œå°†å…·ä½“çš„å¤„ç†äº¤ç»™äº†è°ƒç”¨è€…</span></p><h4 id='å†…å®¹å¤„ç†'><span>å†…å®¹å¤„ç†</span></h4><ol start='' ><li><p><span>åˆå§‹åŒ–æ—¶è¯»å–å±æ€§å¹¶æ³¨å†Œè½¬æ¢å™¨ï¼ˆå°† </span><code>String</code><span> ï¼ˆé»˜è®¤è¯»å–åˆ°çš„å±æ€§ç±»å‹ï¼‰è½¬æ¢ä¸ºå¯¹åº”ç±»å‹ï¼‰</span></p></li><li><p><span>æä¾›è·å–å±æ€§çš„å·¥å…·ç±»</span></p><ol start='' ><li><span>è¦æ±‚keyä¸ä¸ºç©ºï¼š</span><code>notEmpty(String key)</code></li><li><span>é€šè¿‡keyè·å–ï¼š </span><code>getProperty(String key)</code></li><li><span>é€šè¿‡keyè·å–å¦‚æœä¸ºç©ºè¿”å›æŒ‡å®šçš„é»˜è®¤å€¼ï¼š </span><code>getProperty(String key, String defaultValue)</code></li><li><span>é€šè¿‡keyè·å–æŒ‡å®šç±»å‹çš„é…ç½®é¡¹ï¼š </span><code>getProperty(String key, Class&lt;T&gt; targetType)</code></li><li><span>é€šè¿‡keyè·å–å¿…è¦é¡¹ï¼š </span><code>getRequiredProperty(String key)</code></li><li><span>é€šè¿‡keyå’Œç±»å‹è·å–å¿…è¦é¡¹ï¼š </span><code>getRequiredProperty(String key, Class&lt;T&gt; targetType)</code></li><li><span>ç±»å‹è½¬æ¢ï¼š</span><code>convert(Class&lt;?&gt; clazz, String value)</code><span> ã€</span><code>parseValue(String value)</code></li><li><span>è§£æè¡¨è¾¾å¼ï¼š</span><code>parsePropertyExpr(String key)</code></li></ol></li></ol><p>&nbsp;</p><h3 id='å®ç°'><span>å®ç°</span></h3><h4 id='è·¯å¾„æŒ‡å®šå’Œæ‰“å¼€-2'><span>è·¯å¾„æŒ‡å®šå’Œæ‰“å¼€</span></h4><p><span>å°†æ–‡ä»¶æµçš„å…·ä½“å¤„ç†äº¤ç»™äº†è°ƒç”¨è€…éœ€è¦å®ç°çš„ </span><code>inputStreamCallback</code><span> æ¥å£ã€‚</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.2px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-keyword">static</span> <span class="cm-operator">&lt;</span><span class="cm-variable">T</span><span class="cm-operator">&gt;</span> <span class="cm-variable">T</span> <span class="cm-def">readInputStream</span>(<span class="cm-variable-3">String</span> <span class="cm-variable">path</span>, <span class="cm-variable">InputStreamCallback</span><span class="cm-operator">&lt;</span><span class="cm-variable">T</span><span class="cm-operator">&gt;</span> <span class="cm-variable">inputStreamCallback</span>) {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">path</span>.<span class="cm-variable">startsWith</span>(<span class="cm-string">"/"</span>)) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">path</span> <span class="cm-operator">=</span> <span class="cm-variable">path</span>.<span class="cm-variable">substring</span>(<span class="cm-number">1</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">try</span> (<span class="cm-variable">InputStream</span> <span class="cm-variable">input</span> <span class="cm-operator">=</span> <span class="cm-variable">getContextClassLoader</span>().<span class="cm-variable">getResourceAsStream</span>(<span class="cm-variable">path</span>)) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">input</span> <span class="cm-operator">==</span> <span class="cm-atom">null</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">throw</span> <span class="cm-keyword">new</span> <span class="cm-variable">FileNotFoundException</span>(<span class="cm-string">"File not found in classpath: "</span> <span class="cm-operator">+</span> <span class="cm-variable">path</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">inputStreamCallback</span>.<span class="cm-variable">doWithInputStream</span>(<span class="cm-variable">input</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  } <span class="cm-keyword">catch</span> (<span class="cm-variable">IOException</span> <span class="cm-variable">e</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">e</span>.<span class="cm-variable">printStackTrace</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">throw</span> <span class="cm-keyword">new</span> <span class="cm-variable">UncheckedIOException</span>(<span class="cm-variable">e</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 314px;"></div><div class="CodeMirror-gutters" style="display: none; height: 314px;"></div></div></div></pre><p><span>è¿™é‡Œä¹Ÿç®—æ˜¯ä¸€ä¸ªä½¿ç”¨ç¤ºä¾‹ï¼š</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.2px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-keyword">static</span> <span class="cm-variable-3">String</span> <span class="cm-def">readString</span>(<span class="cm-variable-3">String</span> <span class="cm-variable">path</span>) {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">readInputStream</span>(<span class="cm-variable">path</span>, <span class="cm-variable">input</span> <span class="cm-operator">-&gt;</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-3">byte</span>[] <span class="cm-variable">bytes</span> <span class="cm-operator">=</span> <span class="cm-variable">input</span>.<span class="cm-variable">readAllBytes</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-keyword">new</span> <span class="cm-variable-3">String</span>(<span class="cm-variable">bytes</span>, <span class="cm-variable">StandardCharsets</span>.<span class="cm-variable">UTF_8</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  });</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 134px;"></div><div class="CodeMirror-gutters" style="display: none; height: 134px;"></div></div></div></pre><p><span>ä¼˜å…ˆä½¿ç”¨å½“å‰çº¿ç¨‹çš„ç±»åŠ è½½å™¨ï¼ˆæä¾›æ›´ç»†ç²’åº¦çš„ç±»åŠ è½½æ§åˆ¶ï¼Œç‰¹åˆ«æ˜¯å½“æ¶‰åŠåˆ°ç±»éš”ç¦»å’Œæ’ä»¶æœºåˆ¶ï¼‰ï¼Œæ²¡æœ‰åˆ™ä½¿ç”¨å½“å‰ç±»çš„ç±»åŠ è½½å™¨</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.2px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">static</span> <span class="cm-variable">ClassLoader</span> <span class="cm-def">getContextClassLoader</span>() {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">ClassLoader</span> <span class="cm-variable">cl</span> <span class="cm-operator">=</span> <span class="cm-atom">null</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">cl</span> <span class="cm-operator">=</span> <span class="cm-variable">Thread</span>.<span class="cm-variable">currentThread</span>().<span class="cm-variable">getContextClassLoader</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">cl</span> <span class="cm-operator">==</span> <span class="cm-atom">null</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">cl</span> <span class="cm-operator">=</span> <span class="cm-variable">ClassPathUtils</span>.<span class="cm-keyword">class</span>.<span class="cm-variable">getClassLoader</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">cl</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 179px;"></div><div class="CodeMirror-gutters" style="display: none; height: 179px;"></div></div></div></pre><h4 id='æ”¯æŒyml'><span>æ”¯æŒyml</span></h4><p><span>è¿™é‡Œä½¿ç”¨äº† github ä¸Šå¼€æºçš„</span><a href='https://github.com/snakeyaml/snakeyaml'><span>YAMLå¤„ç†åº“</span></a><span>ï¼Œè€Œæˆ‘ä»¬è¦åšçš„åªæ˜¯åœ¨æ­¤åŸºç¡€ä¸Šè¿›è¡Œé…ç½®ï¼Œä¹Ÿä½¿ç”¨äº† </span><code>JAVA10</code><span> çš„æ–°ç‰¹æ€§ </span><code>var</code><span>ã€‚</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.2px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-meta">@SuppressWarnings</span>(<span class="cm-string">"unchecked"</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-keyword">static</span> <span class="cm-variable">Map</span><span class="cm-operator">&lt;</span><span class="cm-variable-3">String</span>, <span class="cm-variable-3">Object</span><span class="cm-operator">&gt;</span> <span class="cm-def">loadYaml</span>(<span class="cm-variable-3">String</span> <span class="cm-variable">path</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">var</span> <span class="cm-variable">loaderOptions</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">LoaderOptions</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">var</span> <span class="cm-variable">dumperOptions</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">DumperOptions</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">var</span> <span class="cm-variable">representer</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">Representer</span>(<span class="cm-variable">dumperOptions</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">var</span> <span class="cm-variable">resolver</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">NoImplicitResolver</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">var</span> <span class="cm-variable">yaml</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">Yaml</span>(<span class="cm-keyword">new</span> <span class="cm-variable">Constructor</span>(<span class="cm-variable">loaderOptions</span>), <span class="cm-variable">representer</span>, <span class="cm-variable">dumperOptions</span>, <span class="cm-variable">loaderOptions</span>, <span class="cm-variable">resolver</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">ClassPathUtils</span>.<span class="cm-variable">readInputStream</span>(<span class="cm-variable">path</span>, (<span class="cm-variable">input</span>) <span class="cm-operator">-&gt;</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> (<span class="cm-variable">Map</span><span class="cm-operator">&lt;</span><span class="cm-variable-3">String</span>, <span class="cm-variable-3">Object</span><span class="cm-operator">&gt;</span>) <span class="cm-variable">yaml</span>.<span class="cm-variable">load</span>(<span class="cm-variable">input</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  });</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 269px;"></div><div class="CodeMirror-gutters" style="display: none; height: 269px;"></div></div></div></pre><p>&nbsp;</p><h4 id='åˆå§‹åŒ–'><span>åˆå§‹åŒ–</span></h4><p><span>åœ¨æ³¨å†Œè½¬æ¢å™¨æ—¶ï¼Œå¯¹äºå¸¸ç”¨çš„ç±»å‹ï¼ˆå¸¸ç”¨çš„åŸºç¡€æ•°æ®ç±»å‹å’Œå¸¸ç”¨çš„æ—¶é—´ç±»å‹ï¼‰ï¼Œå­˜å…¥äº† </span><code>Map&lt;Class&lt;?&gt;, Function&lt;String, Object&gt;&gt; converters</code><span> ä¸­ï¼Œå¯¹äºåŸºç¡€ç±»å‹è¿˜å­˜å…¥äº†å…¶å°è£…ç±»ï¼Œè€Œéœ€è¦æ³¨æ„çš„æ˜¯å°è£…ç±»å‹å’ŒåŸºç¡€ç±»å‹ä¼ å…¥æ–¹æ³•çš„ä¸åŒã€‚</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.2px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">converters</span>.<span class="cm-variable">put</span>(<span class="cm-variable-3">boolean</span>.<span class="cm-keyword">class</span>, <span class="cm-variable">s</span> <span class="cm-operator">-&gt;</span> <span class="cm-variable-3">Boolean</span>.<span class="cm-variable">parseBoolean</span>(<span class="cm-variable">s</span>));</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">converters</span>.<span class="cm-variable">put</span>(<span class="cm-variable-3">Boolean</span>.<span class="cm-keyword">class</span>, <span class="cm-variable">s</span> <span class="cm-operator">-&gt;</span> <span class="cm-variable-3">Boolean</span>.<span class="cm-variable">valueOf</span>(<span class="cm-variable">s</span>));</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><h4 id='notemptystring-key'><span>notEmpty(String key)</span></h4><p><span>è¿”å›é»˜è®¤å€¼èƒ½å¤Ÿåœ¨ä¸€è¡Œä»£ç ä¸­å®Œæˆ </span><code>key</code><span> çš„æœ‰æ•ˆæ€§çš„å¤„ç†</span></p><p><span>eg: </span><code>String k = notEmpty(key.substring(2, key.length() - 1));</code></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.2px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">String</span> <span class="cm-def">notEmpty</span>(<span class="cm-variable-3">String</span> <span class="cm-variable">key</span>) {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-atom">false</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">throw</span> <span class="cm-keyword">new</span> <span class="cm-variable">IllegalArgumentException</span>(<span class="cm-string">"Invalid key: "</span> <span class="cm-operator">+</span> <span class="cm-variable">key</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">key</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 134px;"></div><div class="CodeMirror-gutters" style="display: none; height: 134px;"></div></div></div></pre><h4 id='convert'><span>Convert</span></h4><p><span>é€šè¿‡æŒ‡å®šç±»å‹æ‰¾åˆ° </span><code>value</code><span> å¯¹åº”çš„è½¬æ¢æ–¹æ³•ï¼Œè€Œ </span><code>converter.apply(value)</code><span> å®é™…ä¸Šæ˜¯ </span><code>converter</code><span> ä½œä¸ºè°ƒåº¦è€…</span><sup class='md-footnote'><a href='#dfref-footnote-1' name='ref-footnote-1'>1</a></sup><span>è°ƒç”¨ </span><code>Function</code><span> å¯¹è±¡çš„ </span><code>apply</code><span> æ–¹æ³•ã€‚å…¶ä¸­ </span><code>apply</code><span> æ–¹æ³•æ¥è‡ª </span><code>Function</code><span> æ¥å£ã€‚</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.2px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-operator">&lt;</span><span class="cm-variable">T</span><span class="cm-operator">&gt;</span> <span class="cm-variable">T</span> <span class="cm-def">convert</span>(<span class="cm-variable-3">String</span> <span class="cm-variable">value</span>, <span class="cm-variable">Class</span><span class="cm-operator">&lt;</span><span class="cm-variable">T</span><span class="cm-operator">&gt;</span> <span class="cm-variable">targetType</span>) {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">Function</span><span class="cm-operator">&lt;</span><span class="cm-variable-3">String</span>, <span class="cm-variable-3">Object</span><span class="cm-operator">&gt;</span> <span class="cm-variable">converter</span> <span class="cm-operator">=</span> <span class="cm-variable">converters</span>.<span class="cm-variable">get</span>(<span class="cm-variable">targetType</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">converter</span> <span class="cm-operator">==</span> <span class="cm-atom">null</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">throw</span> <span class="cm-keyword">new</span> <span class="cm-variable">IllegalArgumentException</span>(<span class="cm-string">"Unsupported value type: "</span> <span class="cm-operator">+</span> <span class="cm-variable">targetType</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> (<span class="cm-variable">T</span>) <span class="cm-variable">converter</span>.<span class="cm-variable">apply</span>(<span class="cm-variable">value</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 157px;"></div><div class="CodeMirror-gutters" style="display: none; height: 157px;"></div></div></div></pre><h4 id='record'><span>record</span></h4><p><code>java14</code><span> å¼•å…¥çš„</span><strong><span>æ•°æ®å®¹å™¨</span></strong><span>æ¦‚å¿µï¼Œç±»çš„å£°æ˜ååˆ†ç®€æ´ï¼Œ </span><code>record</code><span> å‚æ•°ä½œä¸ºå±æ€§ã€‚</span></p><ul><li><p><span>å¸¦æœ‰</span><em><span>å…¨éƒ¨å‚æ•°çš„æ„é€ æ–¹æ³•</span></em></p></li><li><p><span>public è®¿é—®å™¨ï¼Œæ—  setï¼Œget æ–¹æ³•ã€‚æ²¡æœ‰éµå¾ª Bean çš„å‘½åè§„èŒƒ</span></p><ul><li><span>å·²è¿™é‡Œçš„ä»£ç ä¸ºä¾‹ï¼Œä½¿ç”¨ </span><code>(new PropertyExpr(&quot;key&quot;, &quot;&quot;)).key()</code><span> æ¥å¾—åˆ° </span><code>key</code></li></ul></li><li><p><span>è‡ªåŠ¨å®ç° </span><code>toString()</code><span>, </span><code>hashCode()</code><span>, </span><code>equals()</code></p></li><li><p><code>final</code><span> ç±»ï¼Œä¸èƒ½ç»§æ‰¿ </span><code>record</code></p></li><li><p><span>ä¸èƒ½å£°æ˜å®ä¾‹å±æ€§ï¼Œèƒ½å£°æ˜ </span><code>static</code><span> æˆå‘˜</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.2px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">record</span> <span class="cm-def">PropertyExpr</span>(<span class="cm-variable-3">String</span> <span class="cm-variable">key</span>, <span class="cm-variable-3">String</span> <span class="cm-variable">defaultValue</span>) {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p>&nbsp;</p><hr /><h1 id='----ioc----'><span>â€” IOC â€”</span></h1><p><span>å¯¹äºIoCå®¹å™¨æ¥è¯´ï¼Œåˆ›å»ºBeançš„è¿‡ç¨‹åˆ†ä¸¤æ­¥ï¼š</span></p><ol start='' ><li><p><span>åˆ›å»ºBeançš„å®ä¾‹ï¼Œæ­¤æ—¶å¿…é¡»æ³¨å…¥å¼ºä¾èµ–ã€‚</span></p><p><span>åœ¨ </span><code>CreateBeanDefinitions</code><span> ä¸­å®Œæˆã€‚</span></p></li><li><p><span>å¯¹Beanå®ä¾‹è¿›è¡ŒSetteræ–¹æ³•æ³¨å…¥å’Œå­—æ®µæ³¨å…¥ã€‚</span></p><p><span>åœ¨ </span><code>bean</code><span> ç¤ºä¾‹åˆ›å»ºåå¤„ç†ï¼Œå³ stepï¼š</span><code>createBeanInstance</code><span> ä¸­å®Œæˆ</span></p></li></ol><h2 id='createbeandefinitions-1'><span>CreateBeanDefinitions</span></h2><ul><li><p><code>@Target</code><span> å®šä¹‰å½“å‰æ³¨è§£å¯ä»¥åº”ç”¨çš„ä½ç½®ã€‚</span></p><ul><li><code>ElementType.FIELD</code><span>  å­—æ®µ</span></li><li><code>ElementType.METHOD</code><span> æ–¹æ³•</span></li><li><code>ElementType.PARAMETER</code><span> æ–¹æ³•å‚æ•°</span></li></ul></li><li><p><code>@Retention</code><span> æ³¨è§£çš„ç”Ÿå‘½å‘¨æœŸï¼Œè¦æ±‚ä¼ å…¥ä¸‹åˆ—å€¼ï¼š</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.2px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">enum</span> <span class="cm-def">RetentionPolicy</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// Annotations are to be discarded by the compiler.</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">SOURCE</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// Annotations are to be recorded in the class file by the compiler but need not be retained by the VM at run time.  This is the default behavior.</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">CLASS</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">// Annotations are to be recorded in the class file by the compiler and retained by the VM at run time, so they may be read reflectively.</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">RUNTIME</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 269px;"></div><div class="CodeMirror-gutters" style="display: none; height: 269px;"></div></div></div></pre></li><li><p><code>@Documented</code><span> ä½¿ç”¨æ­¤æ³¨è§£çš„å…ƒç´ å°†ä¼šè¢«åŒ…å«åœ¨ç”Ÿæˆçš„ JavaDoc æ–‡æ¡£ä¸­</span></p></li></ul><p><span>åœ¨è¿™ä¸ªé¡¹ç›®ä¸­å¤„ç†çš„æ³¨è§£ï¼ˆjavaå¼€å‘çš„æŠ¥èœåï¼‰ï¼š</span></p><p><code>@Autowired</code><span>ã€</span><code>@Bean</code><span>ã€</span><code>@Component</code><span>ã€</span><code>@ComponentScan</code><span>ã€</span><code>@Configuration</code><span>ã€</span><code>@Import</code><span>ã€</span><code>@Order</code><span>ã€</span><code>@Primary</code><span>ã€</span><code>@Value</code></p><h3 id='beandefinition'><span>BeanDefinition</span></h3><p><span>ç”±äºBeanéƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„åå­—æ ‡è¯†ï¼Œæ‰€ä»¥æœ€ç®€å•çš„æ˜¯ç°å® </span><code>HashMap&lt;String, Object&gt;</code><span> ï¼Œä½†è¿™æ ·å…³äº </span><code>bean</code><span> æˆ‘ä»¬èƒ½è·å–åˆ°å¯¹è±¡ï¼Œ</span><code>bean</code><span> çš„åç§°ã€åˆå§‹åŒ–æ–¹æ³•ã€é”€æ¯æ–¹æ³•ã€</span><code>bean</code><span> æ˜¯å¦æœ‰å·¥å‚ï¼Ÿè¿™æ ·çš„æ–¹å¼ä¼šé—æ¼å¤ªå¤šçš„ä¿¡æ¯ï¼Œäºæ˜¯æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªç”¨äºæè¿° </span><code>bean</code><span> å®šä¹‰çš„å¯¹è±¡ï¼Œå³ </span><code>BeanDefinition</code><span>ã€‚</span></p><p><span>å†…å«å±æ€§ï¼šnameï¼ˆå”¯ä¸€çš„beanåç§°ï¼‰ã€</span><strong><span>beanClass</span></strong><sup class='md-footnote'><a href='#dfref-footnote-2' name='ref-footnote-2'>2</a></sup><span>ï¼ˆbeançš„</span><em><span>å£°æ˜ç±»å‹</span></em><span> ï¼‰ã€instanceï¼ˆå•ä¾‹æ¨¡å¼ä¸‹çš„å®ä¾‹æŒ‡é’ˆ</span><sup class='md-footnote'><a href='#dfref-footnote-3' name='ref-footnote-3'>3</a></sup><span>ï¼‰ã€constructorï¼ˆæ„é€ æ–¹æ³•ï¼‰ã€factoryNameï¼ˆå·¥å‚æ–¹æ³•åç§°ï¼‰ã€factoryMethodï¼ˆå®é™…çš„å·¥å‚æ–¹æ³•ï¼‰ã€orderï¼ˆbeané¡ºåºï¼‰ã€åˆå§‹åŒ–/é”€æ¯æ–¹æ³•å’Œå…¶åç§°ã€‚</span></p><ul><li><p><span>æ„é€ æ–¹æ³•ï¼šä½¿ç”¨å·¥å‚æ–¹æ³•çš„ </span><code>bean</code><span> å’Œæ„é€ æ–¹æ³•çš„beanå¯¹åº”ä¸åŒçš„ </span><code>BeanDefinition</code><span> åˆ›å»ºæ–¹å¼ï¼ˆæ˜¾è€Œæ˜“è§çš„ï¼ŒåšåŸºç¡€çš„åˆ›å»ºååˆé‡æ–°è°ƒsetæ–¹æ³•å®åœ¨æ˜¯å¤ªéº»çƒ¦äº†ï¼‰ï¼Œéœ€è¦æ³¨æ„åœ¨ä¸åŒä½¿ç”¨çš„æƒ…æ™¯ä¸‹çš„æ„é€ æ–¹æ³•éœ€è¦å°†ä¸€äº›å±æ€§èµ‹ç©ºï¼ˆ </span><code>this.constructor/ factoryName/factoryMethod</code><span> ï¼‰</span></p></li><li><p><code>getter</code><span>ï¼šä½¿ç”¨ </span><code>@Nullable</code><span> è¡¨ç¤ºè¿”å›å€¼å¯èƒ½ä¸ºç©ºï¼Œè§„èŒƒä»£ç </span></p></li><li><p><code>toString</code><span>ï¼šé»˜è®¤çš„ </span><code>toString</code><span> å®ç°ï¼Œä½†ç”±äºç‰¹æ®Šçš„æ„é€ /å·¥å‚ï¼Œéœ€è¦è¿›è¡Œå¤„ç†</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.2px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-meta">@Override</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable-3">String</span> <span class="cm-def">toString</span>() {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-string">"BeanDefinition [name="</span> <span class="cm-operator">+</span> <span class="cm-variable">name</span> <span class="cm-operator">+</span> <span class="cm-string">", beanClass="</span> <span class="cm-operator">+</span> <span class="cm-variable">beanClass</span>.<span class="cm-variable">getName</span>() <span class="cm-operator">+</span> <span class="cm-string">", factory="</span> <span class="cm-operator">+</span> <span class="cm-variable">getCreateDetail</span>() <span class="cm-operator">+</span> <span class="cm-string">", init-method="</span> <span class="cm-operator">+</span> (<span class="cm-variable">initMethod</span> <span class="cm-operator">==</span> <span class="cm-atom">null</span> <span class="cm-operator">?</span> <span class="cm-string">"null"</span> : <span class="cm-variable">initMethod</span>.<span class="cm-variable">getName</span>()) <span class="cm-operator">+</span> <span class="cm-string">", destroy-method="</span> <span class="cm-operator">+</span> (<span class="cm-variable">destroyMethod</span> <span class="cm-operator">==</span> <span class="cm-atom">null</span> <span class="cm-operator">?</span> <span class="cm-string">"null"</span> : <span class="cm-variable">destroyMethod</span>.<span class="cm-variable">getName</span>()) <span class="cm-operator">+</span> <span class="cm-string">", primary="</span> <span class="cm-operator">+</span> <span class="cm-variable">primary</span> <span class="cm-operator">+</span> <span class="cm-string">", instance="</span> <span class="cm-operator">+</span> <span class="cm-variable">instance</span> <span class="cm-operator">+</span> <span class="cm-string">"]"</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; <span class="cm-comment">// è·å–åˆ›å»ºbeançš„è¯¦ç»†ä¿¡æ¯ï¼ˆé‡ç‚¹æ˜¯å·¥å‚æ–¹æ³•çš„ä¿¡æ¯ï¼‰</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-3">String</span> <span class="cm-def">getCreateDetail</span>() {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-keyword">this</span>.<span class="cm-variable">factoryMethod</span> <span class="cm-operator">!=</span> <span class="cm-atom">null</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-3">String</span> <span class="cm-variable">params</span> <span class="cm-operator">=</span> <span class="cm-variable-3">String</span>.<span class="cm-variable">join</span>(<span class="cm-string">", "</span>, <span class="cm-variable">Arrays</span>.<span class="cm-variable">stream</span>(<span class="cm-keyword">this</span>.<span class="cm-variable">factoryMethod</span>.<span class="cm-variable">getParameterTypes</span>()).<span class="cm-variable">map</span>(<span class="cm-variable">t</span> <span class="cm-operator">-&gt;</span> <span class="cm-variable">t</span>.<span class="cm-variable">getSimpleName</span>()).<span class="cm-variable">toArray</span>(<span class="cm-variable-3">String</span>[]::<span class="cm-keyword">new</span>));</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-keyword">this</span>.<span class="cm-variable">factoryMethod</span>.<span class="cm-variable">getDeclaringClass</span>().<span class="cm-variable">getSimpleName</span>() <span class="cm-operator">+</span> <span class="cm-string">"."</span> <span class="cm-operator">+</span> <span class="cm-keyword">this</span>.<span class="cm-variable">factoryMethod</span>.<span class="cm-variable">getName</span>() <span class="cm-operator">+</span> <span class="cm-string">"("</span> <span class="cm-operator">+</span> <span class="cm-variable">params</span> <span class="cm-operator">+</span> <span class="cm-string">")"</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-atom">null</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 403px;"></div><div class="CodeMirror-gutters" style="display: none; height: 403px;"></div></div></div></pre></li></ul><p><span>å¤„ç†é€šè¿‡ç±»å‹æ‰¾åˆ°å¯¹åº” </span><code>Bean</code><span> æˆ– </span><code>BeanDefinition</code><span> æ—¶ï¼Œç”±äºå­˜åœ¨å£°æ˜ç±»å‹å’Œå®é™…ç±»å‹ä¸ä¸€æ ·çš„æƒ…å†µï¼Œæ— æ³•ç›´æ¥ä½¿ç”¨ </span><code>Map&lt;Class&lt;?&gt;, BeanDefinition&gt;</code><span> ï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„å¤„ç†æ–¹å¼å°±åªèƒ½æ˜¯ï¼š</span></p><p><span>é€šè¿‡éå†æ‰¾å‡ºæ‰€æœ‰ç¬¦åˆç±»å‹çš„Beanï¼Œå¦‚æœä¸å”¯ä¸€ï¼Œè€Œå¦‚æœæœ‰ä¸”ä»…æœ‰ä¸€ä¸ªæ ‡æ³¨äº† </span><code>@Primary</code><span>ï¼Œå°±è¿”å›æ ‡æ³¨äº†</span><code>@Primary</code><span> çš„Beanï¼Œå¦åˆ™ç›´æ¥æŠ¥ </span><code>NoUnique BeanDefinition Exception</code><span> é”™è¯¯ï¼Œå¤šä¸ªBeanå´åˆæ²¡æœ‰ä»»ä½•è¢«æ ‡æ³¨äº† </span><code>@Primary</code><span>ï¼ŒåŒæ ·æŠ¥é”™ã€‚</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.2px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable">BeanDefinition</span> <span class="cm-def">findBeanDefinition</span>(<span class="cm-variable">Class</span><span class="cm-operator">&lt;?&gt;</span> <span class="cm-variable">type</span>) {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">List</span><span class="cm-operator">&lt;</span><span class="cm-variable">BeanDefinition</span><span class="cm-operator">&gt;</span> <span class="cm-variable">beanDefinitions</span> <span class="cm-operator">=</span> <span class="cm-variable">findBeanDefinitions</span>(<span class="cm-variable">type</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">beanDefinitions</span>.<span class="cm-variable">isEmpty</span>()) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-atom">null</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">beanDefinitions</span>.<span class="cm-variable">size</span>() <span class="cm-operator">==</span> <span class="cm-number">1</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">beanDefinitions</span>.<span class="cm-variable">get</span>(<span class="cm-number">0</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">List</span><span class="cm-operator">&lt;</span><span class="cm-variable">BeanDefinition</span><span class="cm-operator">&gt;</span> <span class="cm-variable">primaryDefs</span> <span class="cm-operator">=</span> <span class="cm-variable">beanDefinitions</span>.<span class="cm-variable">stream</span>().<span class="cm-variable">filter</span>(<span class="cm-variable">def</span> <span class="cm-operator">-&gt;</span> <span class="cm-variable">def</span>.<span class="cm-variable">isPrimary</span>()).<span class="cm-variable">collect</span>(<span class="cm-variable">Collectors</span>.<span class="cm-variable">toList</span>());</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">primaryDefs</span>.<span class="cm-variable">size</span>() <span class="cm-operator">==</span> <span class="cm-number">1</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">primaryDefs</span>.<span class="cm-variable">get</span>(<span class="cm-number">0</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">primaryDefs</span>.<span class="cm-variable">isEmpty</span>()) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">throw</span> <span class="cm-keyword">new</span> <span class="cm-variable">NoUniqueBeanDefinitionException</span>(<span class="cm-variable-3">String</span>.<span class="cm-variable">format</span>(<span class="cm-string">"Multiple bean with type '%s' found, but no @Primary specified."</span>, <span class="cm-variable">type</span>.<span class="cm-variable">getName</span>()));</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  } <span class="cm-keyword">else</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">throw</span> <span class="cm-keyword">new</span> <span class="cm-variable">NoUniqueBeanDefinitionException</span>(<span class="cm-variable-3">String</span>.<span class="cm-variable">format</span>(<span class="cm-string">"Multiple bean with type '%s' found, and multiple @Primary specified."</span>, <span class="cm-variable">type</span>.<span class="cm-variable">getName</span>()));</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 470px;"></div><div class="CodeMirror-gutters" style="display: none; height: 470px;"></div></div></div></pre><p>&nbsp;</p><hr /><p>&nbsp;</p><h3 id='annoconfigappcontext'><span>AnnoConfigAppContext</span></h3><blockquote><p><span>AnnotationConfigApplicationContextï¼ˆä¸ºäº†å¤§çº²æ’ç‰ˆæœ‰è¶³å¤Ÿçš„ç©ºé—´å¯¹åŸåç§°è¿›è¡Œäº†ä¸€äº›ç®€åŒ–ã€‚ï¼‰</span></p><p><span>åœ¨æ‰«æç±»ä¸èµ„æºä¹‹åï¼Œå¼€å§‹å¤„ç†å¯¹è±¡çš„åˆ›å»ºä¸ç®¡ç†ï¼ŒBeanDefinitionæ˜¯ç¬¬ä¸€æ­¥ï¼Œè®°å½•å®¹å™¨ä¸­beançš„ä¿¡æ¯ã€‚</span></p><p><span>AnnotationConfigApplicationContext è´Ÿè´£å¤„ç†åŸºäºæ³¨è§£çš„é…ç½®ï¼Œä¸»è¦ä»»åŠ¡æ˜¯åˆå§‹åŒ–å’Œç®¡ç†beanã€‚å®ƒä»ç»™å®šçš„é…ç½®ç±»å¼€å§‹ï¼Œæ‰«æå…¶ä¸­çš„@Componentæ³¨è§£ï¼Œåˆ›å»ºå¯¹åº”çš„BeanDefinitionå¯¹è±¡ï¼ŒBeanDefinitionåŒ…å«äº†å®¹å™¨ä¸­beançš„åŸºæœ¬ä¿¡æ¯ï¼Œå¦‚beançš„åç§°ã€ç±»å‹ã€ä¾èµ–å…³ç³»ç­‰ã€‚è¿™ä¸ªè¿‡ç¨‹æ˜¯åˆ›å»ºå’Œç®¡ç†beançš„ç¬¬ä¸€æ­¥ï¼Œä¸ºåç»­çš„beanå®ä¾‹åŒ–å’Œä¾èµ–æ³¨å…¥å¥ å®šäº†åŸºç¡€ã€‚</span></p></blockquote><p><code>propertyResolver</code><span> å±æ€§å®ç°ç±»å’Œèµ„æºæ‰«æçš„æ•´åˆï¼Œ</span><code>beans</code><span> å³åœ¨å®¹å™¨ä¸­ç®¡ç†beanå’Œbeanä¿¡æ¯çš„é˜Ÿåˆ—</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.2px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">protected</span> <span class="cm-keyword">final</span> <span class="cm-variable">PropertyResolver</span> <span class="cm-variable">propertyResolver</span>;</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">protected</span> <span class="cm-keyword">final</span> <span class="cm-variable">Map</span><span class="cm-operator">&lt;</span><span class="cm-variable-3">String</span>, <span class="cm-variable">BeanDefinition</span><span class="cm-operator">&gt;</span> <span class="cm-variable">beans</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable">AnnotationConfigApplicationContext</span>(<span class="cm-variable">Class</span><span class="cm-operator">&lt;?&gt;</span> <span class="cm-variable">configClass</span>, <span class="cm-variable">PropertyResolver</span> <span class="cm-variable">propertyResolver</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">this</span>.<span class="cm-variable">propertyResolver</span> <span class="cm-operator">=</span> <span class="cm-variable">propertyResolver</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// è·å–æ‰€æœ‰Beançš„Classç±»å‹</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">final</span> <span class="cm-variable">Set</span><span class="cm-operator">&lt;</span><span class="cm-variable-3">String</span><span class="cm-operator">&gt;</span> <span class="cm-variable">beanClassNames</span> <span class="cm-operator">=</span> <span class="cm-variable">scanForClassNames</span>(<span class="cm-variable">configClass</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// åˆ›å»ºBeanDefinition</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">this</span>.<span class="cm-variable">beans</span> <span class="cm-operator">=</span> <span class="cm-variable">createBeanDefinitions</span>(<span class="cm-variable">beanClassNames</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 314px;"></div><div class="CodeMirror-gutters" style="display: none; height: 314px;"></div></div></div></pre><h4 id='scanclassnames'><span>scanClassNames</span></h4><p><span>è€Œåœ¨ </span><code>scanClassNames</code><span> ä¸­å®ç°äº† </span><code>ComponentScan</code><span> ï¼Œè¿™ä¸ªæ–¹æ³•åŠŸèƒ½æ›´å…·ä½“çš„æè¿°æ˜¯æ‰«æç»„ä»¶å¹¶è¿”å›ç±»åã€‚</span></p><blockquote><p><span>åœ¨è¿›è¡Œæ•´ç†äºæ˜¯é‡æ–°çœ‹ä»£ç çš„æ—¶å€™åœ¨æƒ³ </span><code>Component</code><span> çš„ </span><code>value</code><span> åº”è¯¥æ˜¯ </span><code>String[]</code><span>ï¼Œä¸ºä»€ä¹ˆæˆ‘çš„ä»£ç é‡æ–° </span><code>new</code><span> äº† </span><code>String[]</code><span>ï¼Œç„¶åå‘ç°åœ¨å®šä¹‰ </span><code>Component</code><span> çš„æ—¶å€™ä¸æ˜¯å®šä¹‰ </span><code>String[]</code><span> è€Œæ˜¯ </span><code>String</code><span> ã€‚å†™çš„æ—¶å€™å°±æœ‰ç‚¹çƒ¦èºåœ° alt+enter å¿«æ·ä¿®å¤äº†ï¼ˆï¼ˆ</span></p></blockquote><ol start='' ><li><span>æ‰¾åˆ° </span><code>ComponentScan</code><span> æ³¨è§£ï¼Œå¾—åˆ°å½“å‰åŒ…å</span></li><li><span>æ‰«ææ‰€æœ‰åŒ…ï¼Œè·å–ä»¥ </span><code>.class</code><span> ç»“å°¾çš„æ–‡ä»¶å¹¶æ·»åŠ åˆ° </span><code>className</code><span> çš„ </span><code>set</code><span> ä¸­ï¼ˆå¤„ç†win/linuxçš„è·¯å¾„åˆ†å‰²ç¬¦é—®é¢˜ï¼‰</span></li><li><span>å¤„ç† </span><code>@Import</code><span> å¯¼å…¥çš„é…ç½®</span></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.2px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Set</span><span class="cm-operator">&lt;</span><span class="cm-variable-3">String</span><span class="cm-operator">&gt;</span> <span class="cm-def">scanForClassNames</span>(<span class="cm-variable">Class</span><span class="cm-operator">&lt;?&gt;</span> <span class="cm-variable">configClass</span>) {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">ComponentScan</span> <span class="cm-variable">scan</span> <span class="cm-operator">=</span> <span class="cm-variable">ClassUtils</span>.<span class="cm-variable">findAnnotation</span>(<span class="cm-variable">configClass</span>, <span class="cm-variable">ComponentScan</span>.<span class="cm-keyword">class</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">// è·å–é…ç½®åŒ…åï¼Œæ²¡æœ‰æ ‡æ³¨åˆ™é»˜è®¤å½“å‰åŒ…å</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">final</span> <span class="cm-variable-3">String</span>[] <span class="cm-variable">scanPackages</span> <span class="cm-operator">=</span> <span class="cm-variable">scan</span> <span class="cm-operator">==</span> <span class="cm-atom">null</span> <span class="cm-operator">||</span> <span class="cm-variable">scan</span>.<span class="cm-variable">value</span>().<span class="cm-variable">length</span> <span class="cm-operator">==</span> <span class="cm-number">0</span> <span class="cm-operator">?</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">new</span> <span class="cm-variable-3">String</span>[] { <span class="cm-variable">configClass</span>.<span class="cm-variable">getPackage</span>().<span class="cm-variable">getName</span>() } : <span class="cm-variable">scan</span>.<span class="cm-variable">value</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">logger</span>.<span class="cm-variable">atInfo</span>().<span class="cm-variable">log</span>(<span class="cm-string">"component scan in packages: {}"</span>, <span class="cm-variable">Arrays</span>.<span class="cm-variable">toString</span>(<span class="cm-variable">scanPackages</span>));</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">Set</span><span class="cm-operator">&lt;</span><span class="cm-variable-3">String</span><span class="cm-operator">&gt;</span> <span class="cm-variable">classNameSet</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">HashSet</span><span class="cm-operator">&lt;&gt;</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">for</span> (<span class="cm-variable-3">String</span> <span class="cm-variable">pkg</span> : <span class="cm-variable">scanPackages</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">logger</span>.<span class="cm-variable">atDebug</span>().<span class="cm-variable">log</span>(<span class="cm-string">"scan package: {}"</span>, <span class="cm-variable">pkg</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">ResourceResolver</span> <span class="cm-variable">rr</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">ResourceResolver</span>(<span class="cm-variable">pkg</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">List</span><span class="cm-operator">&lt;</span><span class="cm-variable-3">String</span><span class="cm-operator">&gt;</span> <span class="cm-variable">classList</span> <span class="cm-operator">=</span> <span class="cm-variable">rr</span>.<span class="cm-variable">scan</span>(<span class="cm-variable">resource</span> <span class="cm-operator">-&gt;</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-3">String</span> <span class="cm-variable">name</span> <span class="cm-operator">=</span> <span class="cm-variable">resource</span>.<span class="cm-variable">name</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">name</span>.<span class="cm-variable">endsWith</span>(<span class="cm-string">".class"</span>)) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">name</span>.<span class="cm-variable">substring</span>(<span class="cm-number">0</span>, <span class="cm-variable">name</span>.<span class="cm-variable">length</span>() <span class="cm-operator">-</span> <span class="cm-number">6</span>).<span class="cm-variable">replace</span>(<span class="cm-string">"/"</span>, <span class="cm-string">"."</span>).<span class="cm-variable">replace</span>(<span class="cm-string">"\\"</span>, <span class="cm-string">"."</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-atom">null</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  });</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">logger</span>.<span class="cm-variable">isDebugEnabled</span>()) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">classList</span>.<span class="cm-variable">forEach</span>((<span class="cm-variable">className</span>) <span class="cm-operator">-&gt;</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">logger</span>.<span class="cm-variable">debug</span>(<span class="cm-string">"class found by component scan: {}"</span>, <span class="cm-variable">className</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  });</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">classNameSet</span>.<span class="cm-variable">addAll</span>(<span class="cm-variable">classList</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">// å¤„ç†è¢« @Import å¯¼å…¥çš„é…ç½®ç±»</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">Import</span> <span class="cm-variable">importConfig</span> <span class="cm-operator">=</span> <span class="cm-variable">configClass</span>.<span class="cm-variable">getAnnotation</span>(<span class="cm-variable">Import</span>.<span class="cm-keyword">class</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">importConfig</span> <span class="cm-operator">!=</span> <span class="cm-atom">null</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">for</span> (<span class="cm-variable">Class</span><span class="cm-operator">&lt;?&gt;</span> <span class="cm-variable">importClass</span> : <span class="cm-variable">importConfig</span>.<span class="cm-variable">value</span>()) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-3">String</span> <span class="cm-variable">importClassName</span> <span class="cm-operator">=</span> <span class="cm-variable">importClass</span>.<span class="cm-variable">getName</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">classNameSet</span>.<span class="cm-variable">contains</span>(<span class="cm-variable">importClassName</span>)) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">logger</span>.<span class="cm-variable">warn</span>(<span class="cm-string">"ignore import: "</span> <span class="cm-operator">+</span> <span class="cm-variable">importClassName</span> <span class="cm-operator">+</span> <span class="cm-string">" for it is already been scanned."</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  } <span class="cm-keyword">else</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">logger</span>.<span class="cm-variable">debug</span>(<span class="cm-string">"class found by import: {}"</span>, <span class="cm-variable">importClassName</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">classNameSet</span>.<span class="cm-variable">add</span>(<span class="cm-variable">importClassName</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">classNameSet</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 896px;"></div><div class="CodeMirror-gutters" style="display: none; height: 896px;"></div></div></div></pre><p><span>åœ¨è¿™é‡Œè¢«è°ƒç”¨çš„æ–¹æ³• </span><code>findAnnotation</code><span>ï¼Œå¤„ç†æ³¨è§£çš„ç»§æ‰¿å’Œå…ƒæ³¨è§£çš„æƒ…å†µã€‚</span></p><p><span>æ¯”å¦‚ï¼šå½“å‰ç±»æ³¨é‡Šçš„æ˜¯ </span><code>@Service</code><span>ï¼Œè¿™ä¸ªç±»ç¡®å®æ˜¯ä¸€ä¸ªç»„ä»¶ï¼Œä½†åœ¨è°ƒç”¨æ—¶ä¼ å…¥çš„æ˜¯ </span><code>Component.class</code><span> ï¼Œç›´æ¥æ¯”è¾ƒä¼šé—æ¼è¿™ä¸ªç»„ä»¶ï¼Œäºæ˜¯éœ€è¦é€šè¿‡é€’å½’è¿›ä¸€æ­¥æŸ¥è¯¢ã€‚</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.2px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-keyword">static</span> <span class="cm-operator">&lt;</span><span class="cm-variable">A</span> <span class="cm-keyword">extends</span> <span class="cm-variable">Annotation</span><span class="cm-operator">&gt;</span> <span class="cm-variable">A</span> <span class="cm-def">findAnnotation</span>(<span class="cm-variable">Class</span><span class="cm-operator">&lt;?&gt;</span> <span class="cm-variable">target</span>, <span class="cm-variable">Class</span><span class="cm-operator">&lt;</span><span class="cm-variable">A</span><span class="cm-operator">&gt;</span> <span class="cm-variable">annoClass</span>) {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">A</span> <span class="cm-variable">annotation</span> <span class="cm-operator">=</span> <span class="cm-variable">target</span>.<span class="cm-variable">getAnnotation</span>(<span class="cm-variable">annoClass</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">for</span> (<span class="cm-variable">Annotation</span> <span class="cm-variable">anno</span> : <span class="cm-variable">target</span>.<span class="cm-variable">getAnnotations</span>()) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">Class</span><span class="cm-operator">&lt;?</span> <span class="cm-keyword">extends</span> <span class="cm-variable">Annotation</span><span class="cm-operator">&gt;</span> <span class="cm-variable">annoType</span> <span class="cm-operator">=</span> <span class="cm-variable">anno</span>.<span class="cm-variable">annotationType</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// å¯¹äºé java.lang.annotation çš„æ³¨è§£ï¼Œé€’å½’æŸ¥æ‰¾</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-operator">!</span><span class="cm-variable">annoType</span>.<span class="cm-variable">getPackageName</span>().<span class="cm-variable">equals</span>(<span class="cm-string">"java.lang.annotation"</span>)) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// å¤„ç†æ³¨è§£çš„ç»§æ‰¿å’Œå…ƒæ³¨è§£çš„æƒ…å†µ</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">A</span> <span class="cm-variable">found</span> <span class="cm-operator">=</span> <span class="cm-variable">findAnnotation</span>(<span class="cm-variable">annoType</span>, <span class="cm-variable">annoClass</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">found</span> <span class="cm-operator">!=</span> <span class="cm-atom">null</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">annotation</span> <span class="cm-operator">!=</span> <span class="cm-atom">null</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">throw</span> <span class="cm-keyword">new</span> <span class="cm-variable">BeanDefinitionException</span>(<span class="cm-string">"Duplicate @"</span> <span class="cm-operator">+</span> <span class="cm-variable">annoClass</span>.<span class="cm-variable">getSimpleName</span>() <span class="cm-operator">+</span> <span class="cm-string">" found on class "</span> <span class="cm-operator">+</span> <span class="cm-variable">target</span>.<span class="cm-variable">getSimpleName</span>());</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">annotation</span> <span class="cm-operator">=</span> <span class="cm-variable">found</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">annotation</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 426px;"></div><div class="CodeMirror-gutters" style="display: none; height: 426px;"></div></div></div></pre><h4 id='createbeandefinitions-2'><span>createBeanDefinitions</span></h4><p><span>å½“å½“å‰ </span><code>bean</code><span> æ˜¯ç»„ä»¶ï¼Œå¹¶ä¸”ä¸æ˜¯æ¥å£ã€ä¸è¢« </span><code>private</code><span> ä¿®é¥°ï¼Œåˆ™åˆ›å»º </span><code>beanName</code><span> å¯¹åº”çš„ </span><code>beanDefinition</code><span> ï¼Œå°†ä»–ä»¬å­˜å‚¨åœ¨ä¸€ä¸ªåˆ—è¡¨ä¸­ã€‚è€Œåœ¨åˆ›å»º </span><code>beanDefinition</code><span> æ—¶ï¼Œéœ€è¦é¢å¤–æ³¨æ„çš„å½“å‰ </span><code>bean</code><span> æ˜¯å¦æ˜¯é€šè¿‡å·¥å‚æ–¹æ³•ç®¡ç†ã€‚</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.2px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">Map</span><span class="cm-operator">&lt;</span><span class="cm-variable-3">String</span>, <span class="cm-variable">BeanDefinition</span><span class="cm-operator">&gt;</span> <span class="cm-def">createBeanDefinitions</span>(<span class="cm-variable">Set</span><span class="cm-operator">&lt;</span><span class="cm-variable-3">String</span><span class="cm-operator">&gt;</span> <span class="cm-variable">beanClassNames</span>) {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">HashMap</span><span class="cm-operator">&lt;</span><span class="cm-variable-3">String</span>, <span class="cm-variable">BeanDefinition</span><span class="cm-operator">&gt;</span> <span class="cm-variable">defs</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">HashMap</span><span class="cm-operator">&lt;&gt;</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">for</span> (<span class="cm-variable-3">String</span> <span class="cm-variable">beanClassName</span> : <span class="cm-variable">beanClassNames</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">Class</span> <span class="cm-variable">clazz</span> <span class="cm-operator">=</span> <span class="cm-atom">null</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">try</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">clazz</span> <span class="cm-operator">=</span> <span class="cm-variable">Class</span>.<span class="cm-variable">forName</span>(<span class="cm-variable">beanClassName</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  } <span class="cm-keyword">catch</span> (<span class="cm-variable">ClassNotFoundException</span> <span class="cm-variable">e</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">throw</span> <span class="cm-keyword">new</span> <span class="cm-variable">RuntimeException</span>(<span class="cm-variable">e</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">clazz</span>.<span class="cm-variable">isAnnotation</span>() <span class="cm-operator">||</span> <span class="cm-variable">clazz</span>.<span class="cm-variable">isEnum</span>() <span class="cm-operator">||</span> <span class="cm-variable">clazz</span>.<span class="cm-variable">isRecord</span>() <span class="cm-operator">||</span> <span class="cm-variable">clazz</span>.<span class="cm-variable">isInterface</span>()) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">continue</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// åˆ¤æ–­æ˜¯å¦ä¸ºç»„ä»¶</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">Component</span> <span class="cm-variable">component</span> <span class="cm-operator">=</span> <span class="cm-variable">ClassUtils</span>.<span class="cm-variable">findAnnotation</span>(<span class="cm-variable">clazz</span>, <span class="cm-variable">Component</span>.<span class="cm-keyword">class</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">component</span> <span class="cm-operator">!=</span> <span class="cm-atom">null</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">logger</span>.<span class="cm-variable">atDebug</span>().<span class="cm-variable">log</span>(<span class="cm-string">"found component: {}"</span>, <span class="cm-variable">clazz</span>.<span class="cm-variable">getName</span>());</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// å¾—åˆ°ç±»çš„ä¿®é¥°ç¬¦</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-3">int</span> <span class="cm-variable">mod</span> <span class="cm-operator">=</span> <span class="cm-variable">clazz</span>.<span class="cm-variable">getModifiers</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">Modifier</span>.<span class="cm-variable">isAbstract</span>(<span class="cm-variable">mod</span>)) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">throw</span> <span class="cm-keyword">new</span> <span class="cm-variable">BeanDefinitionException</span>(<span class="cm-string">"@Component class "</span> <span class="cm-operator">+</span> <span class="cm-variable">clazz</span>.<span class="cm-variable">getName</span>() <span class="cm-operator">+</span> <span class="cm-string">" must not be abstract."</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">Modifier</span>.<span class="cm-variable">isPrivate</span>(<span class="cm-variable">mod</span>)) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">throw</span> <span class="cm-keyword">new</span> <span class="cm-variable">BeanDefinitionException</span>(<span class="cm-string">"@Component class "</span> <span class="cm-operator">+</span> <span class="cm-variable">clazz</span>.<span class="cm-variable">getName</span>() <span class="cm-operator">+</span> <span class="cm-string">" must not be private."</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-3">String</span> <span class="cm-variable">beanName</span> <span class="cm-operator">=</span> <span class="cm-variable">ClassUtils</span>.<span class="cm-variable">getBeanName</span>(<span class="cm-variable">clazz</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">BeanDefinition</span> <span class="cm-variable">beanDefinition</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">BeanDefinition</span>(<span class="cm-variable">beanName</span>, <span class="cm-variable">clazz</span>, <span class="cm-variable">getSuitableConstructor</span>(<span class="cm-variable">clazz</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">getOrder</span>(<span class="cm-variable">clazz</span>), <span class="cm-variable">clazz</span>.<span class="cm-variable">isAnnotationPresent</span>(<span class="cm-variable">Primary</span>.<span class="cm-keyword">class</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-atom">null</span>, <span class="cm-atom">null</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">ClassUtils</span>.<span class="cm-variable">findAnnotationMethod</span>(<span class="cm-variable">clazz</span>, <span class="cm-variable">PostConstruct</span>.<span class="cm-keyword">class</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">ClassUtils</span>.<span class="cm-variable">findAnnotationMethod</span>(<span class="cm-variable">clazz</span>, <span class="cm-variable">PreDestroy</span>.<span class="cm-keyword">class</span>));</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">addBeanDefinitions</span>(<span class="cm-variable">defs</span>, <span class="cm-variable">beanDefinition</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">logger</span>.<span class="cm-variable">atDebug</span>().<span class="cm-variable">log</span>(<span class="cm-string">"define bean: {}"</span>, <span class="cm-variable">beanDefinition</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">Configuration</span> <span class="cm-variable">configuration</span> <span class="cm-operator">=</span> <span class="cm-variable">ClassUtils</span>.<span class="cm-variable">findAnnotation</span>(<span class="cm-variable">clazz</span>, <span class="cm-variable">Configuration</span>.<span class="cm-keyword">class</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">configuration</span> <span class="cm-operator">!=</span> <span class="cm-atom">null</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">scanFactoryMethods</span>(<span class="cm-variable">beanName</span>, <span class="cm-variable">clazz</span>, <span class="cm-variable">defs</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">defs</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 1008px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1008px;"></div></div></div></pre><p><code>scanFactoryMethods</code></p><blockquote><p><code>HashMap</code><span> è¦æ±‚ </span><code>key</code><span> å”¯ä¸€ï¼Œå½“å­˜å…¥keyå·²ç»å­˜åœ¨çš„é”®å€¼å¯¹æ—¶ï¼Œä¼šè¦†ç›–åŸæœ‰çš„</span></p><p><span>å¯¹å·¥å‚ç±»çš„è¦æ±‚ç¹çï¼Œè€Œä¸”æ˜¯ä¸€ä¸ªå®Œæ•´çš„åˆ¤æ–­ï¼Œä½œä¸ºæ–¹æ³•æå‡ºæ˜¯å¾ˆæ˜æ™ºçš„ã€‚</span></p></blockquote><p><span>ä¸å¯ä»¥è¢« </span><code>final</code><span>ã€</span><code>abstract</code><span>ã€</span><code>private</code><span> ä¿®é¥°ï¼Œè€Œä¸”ä½œä¸ºæ–¹æ³•ç±»éœ€è¦è¿”å›çš„æ˜¯å¯¹è±¡ï¼Œä¸èƒ½æ˜¯åŸºç¡€ç±»å‹ï¼Œä¹Ÿä¸åº”è¯¥è¿”å›ç©ºã€‚</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.2px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-3">void</span> <span class="cm-def">scanFactoryMethods</span>(<span class="cm-variable-3">String</span> <span class="cm-variable">factoryBeanName</span>, <span class="cm-variable">Class</span><span class="cm-operator">&lt;?&gt;</span> <span class="cm-variable">clazz</span>, <span class="cm-variable">HashMap</span><span class="cm-operator">&lt;</span><span class="cm-variable-3">String</span>, <span class="cm-variable">BeanDefinition</span><span class="cm-operator">&gt;</span> <span class="cm-variable">defs</span>) {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">Method</span>[] <span class="cm-variable">methods</span> <span class="cm-operator">=</span> <span class="cm-variable">clazz</span>.<span class="cm-variable">getDeclaredMethods</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">for</span> (<span class="cm-variable">Method</span> <span class="cm-variable">method</span> : <span class="cm-variable">methods</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">Bean</span> <span class="cm-variable">bean</span> <span class="cm-operator">=</span> <span class="cm-variable">method</span>.<span class="cm-variable">getAnnotation</span>(<span class="cm-variable">Bean</span>.<span class="cm-keyword">class</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// æ˜¯å¦è¢« bean æ³¨é‡Š</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">bean</span> <span class="cm-operator">!=</span> <span class="cm-atom">null</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// æ£€æŸ¥ä¿®é¥°ç¬¦</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-3">int</span> <span class="cm-variable">mod</span> <span class="cm-operator">=</span> <span class="cm-variable">method</span>.<span class="cm-variable">getModifiers</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">Modifier</span>.<span class="cm-variable">isAbstract</span>(<span class="cm-variable">mod</span>)) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">throw</span> <span class="cm-keyword">new</span> <span class="cm-variable">BeanDefinitionException</span>(<span class="cm-string">"@Bean method "</span> <span class="cm-operator">+</span> <span class="cm-variable">clazz</span>.<span class="cm-variable">getName</span>() <span class="cm-operator">+</span> <span class="cm-string">"."</span> <span class="cm-operator">+</span> <span class="cm-variable">method</span>.<span class="cm-variable">getName</span>() <span class="cm-operator">+</span> <span class="cm-string">" must not be abstract."</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">Modifier</span>.<span class="cm-variable">isFinal</span>(<span class="cm-variable">mod</span>)) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">throw</span> <span class="cm-keyword">new</span> <span class="cm-variable">BeanDefinitionException</span>(<span class="cm-string">"@Bean method "</span> <span class="cm-operator">+</span> <span class="cm-variable">clazz</span>.<span class="cm-variable">getName</span>() <span class="cm-operator">+</span> <span class="cm-string">"."</span> <span class="cm-operator">+</span> <span class="cm-variable">method</span>.<span class="cm-variable">getName</span>() <span class="cm-operator">+</span> <span class="cm-string">" must not be final."</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">Modifier</span>.<span class="cm-variable">isPrivate</span>(<span class="cm-variable">mod</span>)) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">throw</span> <span class="cm-keyword">new</span> <span class="cm-variable">BeanDefinitionException</span>(<span class="cm-string">"@Bean method "</span> <span class="cm-operator">+</span> <span class="cm-variable">clazz</span>.<span class="cm-variable">getName</span>() <span class="cm-operator">+</span> <span class="cm-string">"."</span> <span class="cm-operator">+</span> <span class="cm-variable">method</span>.<span class="cm-variable">getName</span>() <span class="cm-operator">+</span> <span class="cm-string">" must not be private."</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// å·¥å‚æ–¹æ³•çš„è¿”å›ç±»å‹ä¸åº”è¯¥æ˜¯åŸºæœ¬ç±»å‹ï¼ˆprimitive typeï¼‰ä¹Ÿä¸åº”è¯¥è¿”å›ç©ºç±»å‹ï¼ˆvoidï¼‰</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">Class</span><span class="cm-operator">&lt;?&gt;</span> <span class="cm-variable">classType</span> <span class="cm-operator">=</span> <span class="cm-variable">method</span>.<span class="cm-variable">getReturnType</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">classType</span>.<span class="cm-variable">isPrimitive</span>()) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">throw</span> <span class="cm-keyword">new</span> <span class="cm-variable">BeanDefinitionException</span>(<span class="cm-string">"@Bean method "</span> <span class="cm-operator">+</span> <span class="cm-variable">clazz</span>.<span class="cm-variable">getName</span>() <span class="cm-operator">+</span> <span class="cm-string">"."</span> <span class="cm-operator">+</span> <span class="cm-variable">method</span>.<span class="cm-variable">getName</span>() <span class="cm-operator">+</span> <span class="cm-string">" must not return primitive type."</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">classType</span> <span class="cm-operator">==</span> <span class="cm-variable-3">void</span>.<span class="cm-keyword">class</span> <span class="cm-operator">||</span> <span class="cm-variable">classType</span> <span class="cm-operator">==</span> <span class="cm-variable-3">Void</span>.<span class="cm-keyword">class</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">throw</span> <span class="cm-keyword">new</span> <span class="cm-variable">BeanDefinitionException</span>(<span class="cm-string">"@Bean method "</span> <span class="cm-operator">+</span> <span class="cm-variable">clazz</span>.<span class="cm-variable">getName</span>() <span class="cm-operator">+</span> <span class="cm-string">"."</span> <span class="cm-operator">+</span> <span class="cm-variable">method</span>.<span class="cm-variable">getName</span>() <span class="cm-operator">+</span> <span class="cm-string">" must not return void."</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// åˆ›å»º beanDefinition</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">var</span> <span class="cm-variable">def</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">BeanDefinition</span>(<span class="cm-variable">ClassUtils</span>.<span class="cm-variable">getBeanName</span>(<span class="cm-variable">method</span>), <span class="cm-variable">classType</span>, <span class="cm-variable">factoryBeanName</span>, <span class="cm-variable">method</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">getOrder</span>(<span class="cm-variable">method</span>), <span class="cm-variable">method</span>.<span class="cm-variable">isAnnotationPresent</span>(<span class="cm-variable">Primary</span>.<span class="cm-keyword">class</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">bean</span>.<span class="cm-variable">initMethod</span>().<span class="cm-variable">isEmpty</span>() <span class="cm-operator">?</span> <span class="cm-atom">null</span> : <span class="cm-variable">bean</span>.<span class="cm-variable">initMethod</span>(),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">bean</span>.<span class="cm-variable">destroyMethod</span>().<span class="cm-variable">isEmpty</span>() <span class="cm-operator">?</span> <span class="cm-atom">null</span> : <span class="cm-variable">bean</span>.<span class="cm-variable">destroyMethod</span>(),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-atom">null</span>, <span class="cm-atom">null</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">addBeanDefinitions</span>(<span class="cm-variable">defs</span>, <span class="cm-variable">def</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">logger</span>.<span class="cm-variable">atDebug</span>().<span class="cm-variable">log</span>(<span class="cm-string">"define bean: {}"</span>, <span class="cm-variable">def</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 941px;"></div><div class="CodeMirror-gutters" style="display: none; height: 941px;"></div></div></div></pre><h2 id='createbeaninstance'><span>createBeanInstance</span></h2><p><span>åœ¨å¤„ç†äº† </span><code>BeanDefinition</code><span> ä¹‹åï¼Œæˆ‘ä»¬éœ€è¦å¼€å§‹çœŸæ­£çš„åˆ›å»º </span><code>bean</code><span> å¯¹è±¡ï¼Œè€Œåˆ›å»º </span><code>bean</code><span> ï¼Œæœ€å…³é”®çš„åœ°æ–¹åœ¨äºå±æ€§çš„è‡ªåŠ¨æ³¨å…¥ï¼Œè¿™é‡Œå¯èƒ½ä¼šäº§ç”Ÿå¾ªç¯ä¾èµ–ï¼Œè€Œä¸”å­˜åœ¨å¤šç§æ³¨å…¥æ–¹å¼ï¼šæ„é€ æ–¹æ³•æ³¨å…¥ã€å·¥å‚æ–¹æ³•æ³¨å…¥ã€setteræ–¹æ³•æ³¨å…¥ã€å­—æ®µæ³¨å…¥ï¼Œè€Œåœ¨ </span><code>bean</code><span> çš„åˆ›å»ºæ—¶å°±éœ€è¦å¤„ç†å‰ä¸¤ç§â€”â€”æ„é€ æ–¹æ³•æ³¨å…¥å’Œå·¥å‚æ–¹æ³•æ³¨å…¥ï¼Œè€Œåä¸¤ç§åˆ™æ”¯æŒå…ˆåˆ›å»º </span><code>bean</code><span> å®ä¾‹ï¼Œç„¶åé€šè¿‡åå°„æ³¨å…¥ã€‚</span></p><p><span>åœ¨å¤„ç†å¾ªç¯ä¾èµ–æ—¶ï¼Œå¦‚ï¼š</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.2px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-def">A</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">final</span> <span class="cm-variable">B</span> <span class="cm-variable">b</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">A</span>(<span class="cm-variable">B</span> <span class="cm-variable">b</span>) { <span class="cm-keyword">this</span>.<span class="cm-variable">b</span> <span class="cm-operator">=</span> <span class="cm-variable">b</span>; }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-def">B</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">final</span> <span class="cm-variable">A</span> <span class="cm-variable">a</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">B</span>(<span class="cm-variable">A</span> <span class="cm-variable">a</span>) { <span class="cm-keyword">this</span>.<span class="cm-variable">a</span> <span class="cm-operator">=</span> <span class="cm-variable">a</span>; }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 202px;"></div><div class="CodeMirror-gutters" style="display: none; height: 202px;"></div></div></div></pre><p><span>æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ª </span><code>Set&lt;String&gt; creatingBeanNames</code><span> ï¼Œåœ¨æ¯æ¬¡åˆ›å»ºå¯¹è±¡æ—¶å‘ </span><code>creatingBean</code><span> ä¸­æ·»åŠ å½“å‰beançš„åç§°ï¼Œè€Œå½“ </span><code>set</code><span> ä¸­å­˜åœ¨è¿™ä¸ªå€¼å°±æ„å‘³ç€å¾ªç¯ä¾èµ–ï¼Œä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œåœ¨ä¸Šé¢ä»£ç çš„å®é™…è¿‡ç¨‹ä¸ºï¼š</span></p><p><span>åˆ›å»º </span><code>A</code><span> çš„æ–¹æ³•ä¸­ï¼Œ </span><code>A</code><span> è¢«æ·»åŠ åˆ° </span><code>creatingBeanNames</code><span>ï¼Œç”±äºæˆå‘˜å±æ€§ </span><code>B</code><span> è¢« </span><code>final</code><span> ä¿®é¥°ï¼Œè¿›å…¥åˆ›å»ºBçš„æ–¹æ³•ï¼Œæ­¤æ—¶ </span><code>B</code><span> è¢«æ·»åŠ åˆ° </span><code>creatingBeanNames</code><span> ä¸­ï¼Œåˆéœ€è¦è¿›è¡Œå±æ€§ A çš„åˆ›å»ºï¼Œè€Œåœ¨è¿™é‡Œçš„è°ƒç”¨ä¸­ï¼Œä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</span></p><p><span>è€Œå¦‚æœä¸è¢« </span><code>final</code><span> ä¿®é¥°ï¼Œæˆ‘ä»¬å¯ä»¥åˆ†ä¸¤æ­¥ï¼Œå…ˆåˆ†åˆ«å®ä¾‹åŒ– </span><code>bean</code><span>ï¼Œå†æ³¨å…¥ä¾èµ–ã€‚</span></p><p><span>æ‰€ä»¥ï¼Œå¯¹äº </span><code>IoC</code><span> å®¹å™¨æ¥è¯´ï¼Œåˆ›å»º </span><code>Bean</code><span> çš„è¿‡ç¨‹åˆ†ä¸¤æ­¥ï¼š</span></p><ol start='' ><li><span>åˆ›å»º </span><code>Bean</code><span> çš„å®ä¾‹ï¼Œæ­¤æ—¶å¿…é¡»æ³¨å…¥å¼ºä¾èµ–ï¼›</span></li><li><span>å¯¹ </span><code>Bean</code><span> å®ä¾‹è¿›è¡Œ </span><code>Setter</code><span> æ–¹æ³•æ³¨å…¥å’Œå­—æ®µæ³¨å…¥ã€‚</span></li></ol><p><span>å¤„ç†å¼ºä¾èµ–ï¼ˆæ„é€ æ–¹æ³•ã€å·¥å‚æ–¹æ³•ï¼‰ï¼š</span></p><h3 id='createbeanasearlysingleton'><span>createBeanAsEarlySingleton</span></h3><p><span>åœ¨è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ </span><code>bean</code><span> å®ä¾‹åˆ›å»ºçš„é¡ºåºï¼Œæˆ‘ä»¬éœ€è¦å…ˆåˆ›å»º </span><code>@configuration</code><span> ç±»å‹çš„ </span><code>bean</code><span>ï¼Œåˆ›å»ºæ™®é€š </span><code>bean</code><span> æ—¶ï¼Œé…ç½® </span><code>bean</code><span> å·²ç»å°±ç»ªï¼Œå¯ä»¥ä¿è¯æ™®é€š </span><code>bean</code><span> ä¾èµ–æ³¨å…¥çš„è¿‡ç¨‹ã€‚</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.2px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> <span class="cm-tab" role="presentation" cm-text="	">   </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">// åˆ›å»º @configuration ç±»å‹çš„bean</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">this</span>.<span class="cm-variable">beans</span>.<span class="cm-variable">values</span>().<span class="cm-variable">stream</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// è¿‡æ»¤å‡º @configuration ç±»å‹çš„bean</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  .<span class="cm-variable">filter</span>(<span class="cm-keyword">this</span>::<span class="cm-variable">isConfigurationDefinition</span>).<span class="cm-variable">sorted</span>().<span class="cm-variable">map</span>(<span class="cm-variable">bd</span> <span class="cm-operator">-&gt;</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">createBeanAsEarlySingleton</span>(<span class="cm-variable">bd</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">bd</span>.<span class="cm-variable">getName</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }).<span class="cm-variable">collect</span>(<span class="cm-variable">Collectors</span>.<span class="cm-variable">toList</span>());</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// åˆ›å»ºå…¶ä»–bean</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">createNormalBeans</span>();</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 224px;"></div><div class="CodeMirror-gutters" style="display: none; height: 224px;"></div></div></div></pre><p><code>createNormalBeans</code><span>ï¼šå€¼å¾—æ³¨æ„çš„æ˜¯åœ¨è¿™é‡Œæˆ‘ä»¬è¿›è¡Œäº†ä¸¤æ¬¡ </span><code>bd.getInstance() == null</code><span> çš„åˆ¤æ–­ï¼Œè¿™æ˜¯å› ä¸ºåœ¨å‰é¢è¢«å®ä¾‹åŒ–çš„ç±»å‹å°†åç»­éœ€è¦å®ä¾‹åŒ–çš„beanä½œä¸ºäº†å±æ€§ï¼Œåœ¨å‰è€…æœ¬èº«çš„å®ä¾‹åŒ–ä¸­å®Œæˆäº†åè€…çš„å®ä¾‹åŒ–ï¼Œè¿™é‡Œé€šè¿‡å†æ¬¡åˆ¤æ–­æ’é™¤è¿™ç§æƒ…å†µå¯¹ç¨‹åºçš„å½±å“</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.2px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-3">void</span> <span class="cm-def">createNormalBeans</span>() {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">List</span><span class="cm-operator">&lt;</span><span class="cm-variable">BeanDefinition</span><span class="cm-operator">&gt;</span> <span class="cm-variable">unInstance</span> <span class="cm-operator">=</span> <span class="cm-keyword">this</span>.<span class="cm-variable">beans</span>.<span class="cm-variable">values</span>().<span class="cm-variable">stream</span>().</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">filter</span>(<span class="cm-variable">bd</span> <span class="cm-operator">-&gt;</span> <span class="cm-variable">bd</span>.<span class="cm-variable">getInstance</span>() <span class="cm-operator">==</span> <span class="cm-atom">null</span>).<span class="cm-variable">sorted</span>().<span class="cm-variable">collect</span>(<span class="cm-variable">Collectors</span>.<span class="cm-variable">toList</span>());</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">unInstance</span>.<span class="cm-variable">forEach</span>(<span class="cm-variable">bd</span> <span class="cm-operator">-&gt;</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// å¦‚æœBeanæœªè¢«åˆ›å»º(å¯èƒ½åœ¨å…¶ä»–Beançš„æ„é€ æ–¹æ³•æ³¨å…¥å‰è¢«åˆ›å»º):</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span>(<span class="cm-variable">bd</span>.<span class="cm-variable">getInstance</span>() <span class="cm-operator">==</span> <span class="cm-atom">null</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">createBeanAsEarlySingleton</span>(<span class="cm-variable">bd</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  });</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 224px;"></div><div class="CodeMirror-gutters" style="display: none; height: 224px;"></div></div></div></pre><p><span>è€Œåœ¨ </span><code>createBeanAsEarlySingleton</code><span> çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ›´æ¸…æ™°çš„æ„Ÿå—åˆ° </span><code>spring</code><span> æ˜¯å¦‚ä½•åˆ›å»º </span><code>bean</code><span> çš„å®ä¾‹</span></p><p><span>é¦–å…ˆï¼Œé€šè¿‡ </span><code>creatingBeanNames.add(definition.getName())</code><span> æˆ‘ä»¬å®Œæˆäº†å¯¹å¾ªç¯ä¾èµ–çš„å¤„ç†ï¼›</span></p><p><span>åœ¨æ­¤ä¹‹åæˆ‘ä»¬éœ€è¦æ³¨æ„ </span><code>bean</code><span> çš„åˆå§‹åŒ–æ–¹å¼ï¼Œä½¿ç”¨æ„é€ æ–¹æ³•è¿˜æ˜¯å·¥å‚æ–¹æ³•ï¼Ÿè¿™é‡Œé€šè¿‡ </span><code>BeanDefinition</code><span> çš„å±æ€§ </span><code>definition.getFactoryName()</code><span> æ˜¯å¦å­˜åœ¨æ¥è¿›ä¸€æ­¥åˆ¤æ–­å·¥å‚æ–¹æ³•æ˜¯å¦å­˜åœ¨ï¼›</span></p><p><span>ç¡®è®¤äº†æ„é€ æ–¹å¼ä¹‹åï¼Œå¤„ç†beançš„å‚æ•°ï¼Œå› ä¸ºåœ¨æ„é€ æ–¹æ³•æ³¨å…¥æ—¶æ˜¯ï¼š</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.2px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">class</span> <span class="cm-def">Hello</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">JdbcTemplate</span> <span class="cm-variable">jdbcTemplate</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable">Hello</span>(<span class="cm-meta">@Autowired</span> <span class="cm-variable">JdbcTemplate</span> <span class="cm-variable">jdbcTemplate</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">this</span>.<span class="cm-variable">jdbcTemplate</span> <span class="cm-operator">=</span> <span class="cm-variable">jdbcTemplate</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 134px;"></div><div class="CodeMirror-gutters" style="display: none; height: 134px;"></div></div></div></pre><p><span>å¤„ç†è¿™ç§æƒ…å†µæˆ‘ä»¬éœ€è¦å¾—åˆ°æ‰€æœ‰çš„å‚æ•°ï¼Œå¹¶ä¸”å¾—åˆ°å‚æ•°çš„æ³¨è§£ï¼Œç„¶å</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.2px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable-3">Object</span> <span class="cm-def">createBeanAsEarlySingleton</span>(<span class="cm-variable">BeanDefinition</span> <span class="cm-variable">definition</span>) {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">logger</span>.<span class="cm-variable">atDebug</span>().<span class="cm-variable">log</span>(<span class="cm-string">"Try create bean '{}' as early singleton: {}"</span>, <span class="cm-variable">definition</span>.<span class="cm-variable">getName</span>(), <span class="cm-variable">definition</span>.<span class="cm-variable">getBeanClass</span>().<span class="cm-variable">getName</span>());</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-operator">!</span><span class="cm-variable">creatingBeanNames</span>.<span class="cm-variable">add</span>(<span class="cm-variable">definition</span>.<span class="cm-variable">getName</span>())) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">throw</span> <span class="cm-keyword">new</span> <span class="cm-variable">UnsatisfiedDependencyException</span>(</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-3">String</span>.<span class="cm-variable">format</span>(<span class="cm-string">"Circular dependency detected when create bean '%s'"</span>, <span class="cm-variable">definition</span>.<span class="cm-variable">getName</span>()));</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// å¾—åˆ°åˆ›å»ºbeançš„æ–¹æ³•ï¼Œæ„é€ æ–¹æ³•/å·¥å‚æ–¹æ³•</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">Executable</span> <span class="cm-variable">createFn</span> <span class="cm-operator">=</span> <span class="cm-atom">null</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">definition</span>.<span class="cm-variable">getFactoryName</span>() <span class="cm-operator">==</span> <span class="cm-atom">null</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">createFn</span> <span class="cm-operator">=</span> <span class="cm-variable">definition</span>.<span class="cm-variable">getConstructor</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  } <span class="cm-keyword">else</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">createFn</span> <span class="cm-operator">=</span> <span class="cm-variable">definition</span>.<span class="cm-variable">getFactoryMethod</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// å¤„ç†åˆ›å»ºbeançš„å‚æ•°</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">final</span> <span class="cm-variable">Parameter</span>[] <span class="cm-variable">parameters</span> <span class="cm-operator">=</span> <span class="cm-variable">createFn</span>.<span class="cm-variable">getParameters</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">final</span> <span class="cm-variable">Annotation</span>[][] <span class="cm-variable">annotations</span> <span class="cm-operator">=</span> <span class="cm-variable">createFn</span>.<span class="cm-variable">getParameterAnnotations</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-3">Object</span>[] <span class="cm-variable">args</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable-3">Object</span>[<span class="cm-variable">parameters</span>.<span class="cm-variable">length</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">for</span> (<span class="cm-variable-3">int</span> <span class="cm-variable">i</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>; <span class="cm-variable">i</span> <span class="cm-operator">&lt;</span> <span class="cm-variable">parameters</span>.<span class="cm-variable">length</span>; <span class="cm-variable">i</span> <span class="cm-operator">++</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">final</span> <span class="cm-variable">Parameter</span> <span class="cm-variable">parameter</span> <span class="cm-operator">=</span> <span class="cm-variable">parameters</span>[<span class="cm-variable">i</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">final</span> <span class="cm-variable">Annotation</span>[] <span class="cm-variable">paramAnnos</span> <span class="cm-operator">=</span> <span class="cm-variable">annotations</span>[<span class="cm-variable">i</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// è¿™é‡Œåªå¤„ç†è¢« @Autowiredã€@Value æ³¨è§£çš„å‚æ•°</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">final</span> <span class="cm-variable">Value</span> <span class="cm-variable">value</span> <span class="cm-operator">=</span> <span class="cm-variable">ClassUtils</span>.<span class="cm-variable">getAnnotation</span>(<span class="cm-variable">paramAnnos</span>, <span class="cm-variable">Value</span>.<span class="cm-keyword">class</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">final</span> <span class="cm-variable">Autowired</span> <span class="cm-variable">autowired</span> <span class="cm-operator">=</span> <span class="cm-variable">ClassUtils</span>.<span class="cm-variable">getAnnotation</span>(<span class="cm-variable">paramAnnos</span>, <span class="cm-variable">Autowired</span>.<span class="cm-keyword">class</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// @Configurationç±»å‹çš„Beanæ˜¯å·¥å‚ï¼Œä¸å…è®¸ä½¿ç”¨@Autowiredåˆ›å»º</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">final</span> <span class="cm-variable-3">boolean</span> <span class="cm-variable">isConfiguration</span> <span class="cm-operator">=</span> <span class="cm-variable">isConfigurationDefinition</span>(<span class="cm-variable">definition</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">isConfiguration</span> <span class="cm-operator">&amp;&amp;</span> <span class="cm-variable">autowired</span> <span class="cm-operator">!=</span> <span class="cm-atom">null</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">throw</span> <span class="cm-keyword">new</span> <span class="cm-variable">BeanCreationException</span>(<span class="cm-variable-3">String</span>.<span class="cm-variable">format</span>(<span class="cm-string">"Cannot specify @Autowired when create @Configuration bean '%s': %s."</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">definition</span>.<span class="cm-variable">getName</span>(), <span class="cm-variable">definition</span>.<span class="cm-variable">getBeanClass</span>().<span class="cm-variable">getName</span>()));</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// å¯¹æ³¨è§£ @Valueã€@Autowired çš„è¦æ±‚</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">value</span> <span class="cm-operator">==</span> <span class="cm-atom">null</span> <span class="cm-operator">&amp;&amp;</span> <span class="cm-variable">autowired</span> <span class="cm-operator">==</span> <span class="cm-atom">null</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-3">String</span>.<span class="cm-variable">format</span>(<span class="cm-string">"Must specify @Autowired or @Value when create bean '%s': %s."</span>, <span class="cm-variable">definition</span>.<span class="cm-variable">getName</span>(), <span class="cm-variable">definition</span>.<span class="cm-variable">getBeanClass</span>().<span class="cm-variable">getName</span>());</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">value</span> <span class="cm-operator">!=</span> <span class="cm-atom">null</span> <span class="cm-operator">&amp;&amp;</span> <span class="cm-variable">autowired</span> <span class="cm-operator">!=</span> <span class="cm-atom">null</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">throw</span> <span class="cm-keyword">new</span> <span class="cm-variable">BeanCreationException</span>(</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-3">String</span>.<span class="cm-variable">format</span>(<span class="cm-string">"Cannot specify both @Autowired and @Value when create bean '%s': %s."</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">definition</span>.<span class="cm-variable">getName</span>(), <span class="cm-variable">definition</span>.<span class="cm-variable">getBeanClass</span>().<span class="cm-variable">getName</span>()));</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">final</span> <span class="cm-variable">Class</span><span class="cm-operator">&lt;?&gt;</span> <span class="cm-variable">type</span> <span class="cm-operator">=</span> <span class="cm-variable">parameter</span>.<span class="cm-variable">getType</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">value</span> <span class="cm-operator">!=</span> <span class="cm-atom">null</span>) { <span class="cm-comment">// @Value</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">args</span>[<span class="cm-variable">i</span>] <span class="cm-operator">=</span> <span class="cm-keyword">this</span>.<span class="cm-variable">propertyResolver</span>.<span class="cm-variable">getRequiredProperty</span>(<span class="cm-variable">value</span>.<span class="cm-variable">value</span>(), <span class="cm-variable">type</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  } <span class="cm-keyword">else</span> { <span class="cm-comment">// @Autowired</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-3">String</span> <span class="cm-variable">name</span> <span class="cm-operator">=</span> <span class="cm-variable">autowired</span>.<span class="cm-variable">name</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-3">boolean</span> <span class="cm-variable">required</span> <span class="cm-operator">=</span> <span class="cm-variable">autowired</span>.<span class="cm-variable">value</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">BeanDefinition</span> <span class="cm-variable">dependsOnDef</span> <span class="cm-operator">=</span> <span class="cm-variable">name</span>.<span class="cm-variable">isEmpty</span>() <span class="cm-operator">?</span> <span class="cm-variable">findBeanDefinition</span>(<span class="cm-variable">type</span>) : <span class="cm-variable">findBeanDefinition</span>(<span class="cm-variable">name</span>, <span class="cm-variable">type</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">required</span> <span class="cm-operator">&amp;&amp;</span> <span class="cm-variable">dependsOnDef</span> <span class="cm-operator">==</span> <span class="cm-atom">null</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">throw</span> <span class="cm-keyword">new</span> <span class="cm-variable">BeanCreationException</span>(<span class="cm-variable-3">String</span>.<span class="cm-variable">format</span>(<span class="cm-string">"Missing autowired bean with type '%s' when create bean '%s': %s."</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">type</span>.<span class="cm-variable">getName</span>(), <span class="cm-variable">definition</span>.<span class="cm-variable">getName</span>(), <span class="cm-variable">definition</span>.<span class="cm-variable">getBeanClass</span>().<span class="cm-variable">getName</span>()));</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">dependsOnDef</span> <span class="cm-operator">!=</span> <span class="cm-atom">null</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-3">Object</span> <span class="cm-variable">autowiredBeanInstance</span> <span class="cm-operator">=</span> <span class="cm-variable">dependsOnDef</span>.<span class="cm-variable">getInstance</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">autowiredBeanInstance</span> <span class="cm-operator">==</span> <span class="cm-atom">null</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// è¿˜æ²¡æœ‰è¢«åˆå§‹åŒ–ï¼Œåˆ™ createBeanAsEarlySingleton åˆ›å»º</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">autowiredBeanInstance</span> <span class="cm-operator">=</span> <span class="cm-variable">createBeanAsEarlySingleton</span>(<span class="cm-variable">dependsOnDef</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">args</span>[<span class="cm-variable">i</span>] <span class="cm-operator">=</span> <span class="cm-variable">autowiredBeanInstance</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  } <span class="cm-keyword">else</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">args</span>[<span class="cm-variable">i</span>] <span class="cm-operator">=</span> <span class="cm-atom">null</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// åˆ›å»ºbeanå¯¹è±¡</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-3">Object</span> <span class="cm-variable">instance</span> <span class="cm-operator">=</span> <span class="cm-atom">null</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// æ„é€ æ–¹æ³•</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">definition</span>.<span class="cm-variable">getFactoryName</span>() <span class="cm-operator">==</span> <span class="cm-atom">null</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">try</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">instance</span> <span class="cm-operator">=</span> <span class="cm-variable">definition</span>.<span class="cm-variable">getConstructor</span>().<span class="cm-variable">newInstance</span>(<span class="cm-variable">args</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  } <span class="cm-keyword">catch</span> (<span class="cm-variable">Exception</span> <span class="cm-variable">e</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">throw</span> <span class="cm-keyword">new</span> <span class="cm-variable">BeanCreationException</span>(<span class="cm-variable-3">String</span>.<span class="cm-variable">format</span>(<span class="cm-string">"Exception when create bean '%s': %s"</span>, <span class="cm-variable">definition</span>.<span class="cm-variable">getName</span>(), <span class="cm-variable">definition</span>.<span class="cm-variable">getBeanClass</span>().<span class="cm-variable">getName</span>()), <span class="cm-variable">e</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  } <span class="cm-keyword">else</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// å·¥å‚æ–¹æ³•</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-3">Object</span> <span class="cm-variable">configInstance</span> <span class="cm-operator">=</span> <span class="cm-variable">getBean</span>(<span class="cm-variable">definition</span>.<span class="cm-variable">getFactoryName</span>());</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">try</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">instance</span> <span class="cm-operator">=</span> <span class="cm-variable">definition</span>.<span class="cm-variable">getFactoryMethod</span>().<span class="cm-variable">invoke</span>(<span class="cm-variable">configInstance</span>, <span class="cm-variable">args</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  } <span class="cm-keyword">catch</span> (<span class="cm-variable">Exception</span> <span class="cm-variable">e</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">throw</span> <span class="cm-keyword">new</span> <span class="cm-variable">BeanCreationException</span>(<span class="cm-variable-3">String</span>.<span class="cm-variable">format</span>(<span class="cm-string">"Exception when create bean '%s': %s"</span>, <span class="cm-variable">definition</span>.<span class="cm-variable">getName</span>(), <span class="cm-variable">definition</span>.<span class="cm-variable">getBeanClass</span>().<span class="cm-variable">getName</span>()), <span class="cm-variable">e</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">definition</span>.<span class="cm-variable">setInstance</span>(<span class="cm-variable">instance</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">definition</span>.<span class="cm-variable">getInstance</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 2195px;"></div><div class="CodeMirror-gutters" style="display: none; height: 2195px;"></div></div></div></pre><p><span>å¤„ç†å¼±ä¾èµ–ï¼ˆ </span><code>setter</code><span> å’Œå­—æ®µæ³¨å…¥ï¼‰ï¼š</span></p><h3 id='injectproperties'><span>injectProperties</span></h3><p><span>å¾—åˆ°å®šä¹‰çš„å±æ€§å’Œæ–¹æ³•ï¼Œç„¶åæ³¨å…¥å±æ€§</span></p><p><span>å¤„ç†çˆ¶ç±»ï¼Œå¦‚æœçˆ¶ç±»ä¸ä¸ºç©ºï¼Œåˆ™é€’å½’è°ƒç”¨è¿›è¡Œå±æ€§æ³¨å…¥</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.2002px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-3">void</span> <span class="cm-def">injectProperties</span>(<span class="cm-variable">BeanDefinition</span> <span class="cm-variable">def</span>, <span class="cm-variable">Class</span><span class="cm-operator">&lt;?&gt;</span> <span class="cm-variable">clazz</span>, <span class="cm-variable-3">Object</span> <span class="cm-variable">bean</span>) <span class="cm-keyword">throws</span> <span class="cm-variable">ReflectiveOperationException</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">for</span>(<span class="cm-variable">Field</span> <span class="cm-variable">field</span> : <span class="cm-variable">clazz</span>.<span class="cm-variable">getDeclaredFields</span>()) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">tryInjectProperties</span>(<span class="cm-variable">def</span>, <span class="cm-variable">clazz</span>, <span class="cm-variable">bean</span>, <span class="cm-variable">field</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">for</span> (<span class="cm-variable">Method</span> <span class="cm-variable">method</span> : <span class="cm-variable">clazz</span>.<span class="cm-variable">getDeclaredMethods</span>()) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">tryInjectProperties</span>(<span class="cm-variable">def</span>, <span class="cm-variable">clazz</span>, <span class="cm-variable">bean</span>, <span class="cm-variable">method</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">Class</span><span class="cm-operator">&lt;?&gt;</span> <span class="cm-variable">superclass</span> <span class="cm-operator">=</span> <span class="cm-variable">clazz</span>.<span class="cm-variable">getSuperclass</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">superclass</span> <span class="cm-operator">!=</span> <span class="cm-atom">null</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">injectProperties</span>(<span class="cm-variable">def</span>, <span class="cm-variable">superclass</span>, <span class="cm-variable">bean</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 291px;"></div><div class="CodeMirror-gutters" style="display: none; height: 291px;"></div></div></div></pre><p><span>è€Œåœ¨å…·ä½“çš„ </span><code>tryInjectProperties</code><span> ä¸­ï¼š</span></p><blockquote><p><span>è¿™é‡Œè¿›è¡Œäº†è¯¦ç»†çš„ä»£ç è§£é‡Šï¼Œæ˜¯åœ¨ä¸´æ‘¹åŸé¡¹ç›®æ—¶é˜…è¯»ä»£ç ç¼–å†™æ€è·¯çš„æ–‡å­—æ•´ç†è€Œæˆçš„ï¼Œæ‰€ä»¥ç›¸å¯¹å‰é¢æ›´åŠ ç»†è‡´ã€‚</span></p></blockquote><p><strong><span>å‚æ•°</span></strong><span>éƒ¨åˆ†ï¼šè®¿é—®å¯¹è±¡ ==ã€‹éœ€è¦æ³¨å…¥çš„å±æ€§ã€æ–¹æ³•</span></p><ol start='' ><li><p><span>è·å–å¯¹è±¡æ³¨è§£å¹¶ä¸”å¤„ç†å¯¹è±¡ç±»å‹</span></p><ol start='' ><li><p><span>è·å–è®¿é—®å¯¹è±¡çš„ @Valueã€@Autowired æ ‡æ³¨ï¼ˆç»ˆäºä¸å†æ˜¯ç”¨å·¥å…·ç±»æ–¹æ³• </span><code>ClassUtils.getAnnotation()</code><span> å»å¾—åˆ°æ³¨è§£äº†ï¼‰</span></p><ol start='' ><li><span>å½“æœªè¢«è¦æ±‚çš„ä¸¤ä¸ªæ³¨è§£æ ‡æ³¨åˆ™ç›´æ¥è¿”å›</span></li></ol></li><li><p><span>åˆ›å»º fieldã€method çš„å˜é‡ï¼Œåˆ¤æ–­å½“å‰è®¿é—®å¯¹è±¡çš„ç±»å‹</span></p><ol start='' ><li><span>æå–äº† checkFieldOrMethod è¿›è¡Œä¿®é¥°ç¬¦çš„åˆ¤æ–­</span></li><li><span>è®¾ç½®å–æ¶ˆè¯¥å¯¹è±¡çš„è®¿é—®æ£€æŸ¥</span></li><li><span>å°†è¿™é‡Œç±»å‹å˜é‡èµ‹å€¼ç»™å‰é¢åˆ›å»ºçš„ å±æ€§ã€æ–¹æ³•å˜é‡</span></li><li><span>å½“è®¿é—®å¯¹è±¡ä¸ºæ–¹æ³•æ—¶ï¼Œåœ¨ä½¿ç”¨ checkFieldOrMethod æ£€æŸ¥å®Œä¿®é¥°ç¬¦ä¹‹åï¼Œéœ€è¦å†è¿›è¡Œå‚æ•°ä¸ªæ•°çš„åˆ¤æ–­ï¼Œå› ä¸ºsetteræ–¹æ³•åªå…è®¸ä¸€ä¸ªå‚æ•°ã€‚</span></li></ol></li><li><p><span>é€šè¿‡ä¸‰å…ƒè¿ç®—ç¬¦æ¥åˆå§‹åŒ–æ–°åˆ›å»ºçš„accessibleNameã€accessibleTypeå˜é‡</span></p></li></ol></li><li><p><span>åœ¨æ­£å¼æ³¨å…¥å‰è¿˜éœ€è¦æ’é™¤ value å’Œ Autowired éƒ½ä¸ä¸ºç©ºçš„æƒ…å†µï¼Œç„¶åå†ä¾æ¬¡å¤„ç†ä¸åŒçš„æ³¨å…¥æ–¹å¼ã€‚</span></p></li><li><p><span>åœ¨è¿›è¡Œéç©ºåˆ¤æ–­ä¹‹å</span></p><ul><li><span>ä½¿ç”¨ </span><code>@Value</code><span> æ³¨å…¥æ—¶ä½¿ç”¨ </span><code>this.propertyResolver</code><span> æ³¨å…¥ï¼Œæ­¤æ—¶è°ƒç”¨æ–¹æ³•getRequiredPropertyå¾—åˆ°å¯¹è±¡ï¼Œå†è¿›ä¸€æ­¥å¤„ç†å±æ€§/æ–¹æ³•ï¼Œå°†å…¶è®¾ç½®åˆ°ä½œä¸ºå‚æ•°ä¼ å…¥çš„beanå¯¹è±¡ä¸Š</span></li><li><span>ä½¿ç”¨ </span><code>@Autowired</code><span> æ³¨å…¥æ—¶åœ¨å¾—åˆ°åç§°ä¹‹åï¼Œé€šè¿‡åç§°åœ¨ </span><code>beans</code><span> çš„ </span><code>Map&lt;String, BeanDefinition&gt;</code><span> ä¸­æ‰¾åˆ°å¯¹åº”çš„å®ä¾‹ä½œä¸ºä¾èµ–ï¼Œå¦‚æœ </span><code>@Autowired</code><span> çš„ </span><code>value</code><span> ä¸º </span><code>true</code><span>ï¼ˆå¿…éœ€ï¼‰å´åˆä¾èµ–ä¸ºç©ºï¼Œå°†ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œä¾èµ–ä¸ä¸ºç©ºåˆ™æ­£å¸¸çš„è¿›è¡Œæ³¨å…¥</span></li></ul></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.2002px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-3">void</span> <span class="cm-def">tryInjectProperties</span>(<span class="cm-variable">BeanDefinition</span> <span class="cm-variable">def</span>, <span class="cm-variable">Class</span><span class="cm-operator">&lt;?&gt;</span> <span class="cm-variable">clazz</span>, <span class="cm-variable-3">Object</span> <span class="cm-variable">bean</span>, <span class="cm-variable">AccessibleObject</span> <span class="cm-variable">acc</span>) <span class="cm-keyword">throws</span> <span class="cm-variable">ReflectiveOperationException</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">Value</span> <span class="cm-variable">value</span> <span class="cm-operator">=</span> <span class="cm-variable">acc</span>.<span class="cm-variable">getAnnotation</span>(<span class="cm-variable">Value</span>.<span class="cm-keyword">class</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">Autowired</span> <span class="cm-variable">autowired</span> <span class="cm-operator">=</span> <span class="cm-variable">acc</span>.<span class="cm-variable">getAnnotation</span>(<span class="cm-variable">Autowired</span>.<span class="cm-keyword">class</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">value</span> <span class="cm-operator">==</span> <span class="cm-atom">null</span> <span class="cm-operator">&amp;&amp;</span> <span class="cm-variable">autowired</span> <span class="cm-operator">==</span> <span class="cm-atom">null</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">Field</span> <span class="cm-variable">field</span> <span class="cm-operator">=</span> <span class="cm-atom">null</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">Method</span> <span class="cm-variable">method</span> <span class="cm-operator">=</span> <span class="cm-atom">null</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">acc</span> <span class="cm-keyword">instanceof</span> <span class="cm-variable">Field</span> <span class="cm-variable">f</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">checkFieldOrMethod</span>(<span class="cm-variable">f</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">f</span>.<span class="cm-variable">setAccessible</span>(<span class="cm-atom">true</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">field</span> <span class="cm-operator">=</span> <span class="cm-variable">f</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">acc</span> <span class="cm-keyword">instanceof</span> <span class="cm-variable">Method</span> <span class="cm-variable">m</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">checkFieldOrMethod</span>(<span class="cm-variable">m</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">m</span>.<span class="cm-variable">getParameters</span>().<span class="cm-variable">length</span> <span class="cm-operator">!=</span> <span class="cm-number">1</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">throw</span> <span class="cm-keyword">new</span> <span class="cm-variable">BeanDefinitionException</span>(</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-3">String</span>.<span class="cm-variable">format</span>(<span class="cm-string">"Cannot inject a non-setter method %s for bean '%s': %s"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">m</span>.<span class="cm-variable">getName</span>(), <span class="cm-variable">def</span>.<span class="cm-variable">getName</span>(), <span class="cm-variable">def</span>.<span class="cm-variable">getBeanClass</span>().<span class="cm-variable">getName</span>()));</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">m</span>.<span class="cm-variable">setAccessible</span>(<span class="cm-atom">true</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">method</span> <span class="cm-operator">=</span> <span class="cm-variable">m</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-3">String</span> <span class="cm-variable">accessibleName</span> <span class="cm-operator">=</span> <span class="cm-variable">field</span> <span class="cm-operator">!=</span> <span class="cm-atom">null</span> <span class="cm-operator">?</span> <span class="cm-variable">field</span>.<span class="cm-variable">getName</span>() : <span class="cm-variable">method</span>.<span class="cm-variable">getName</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">Class</span><span class="cm-operator">&lt;?&gt;</span> <span class="cm-variable">accessibleType</span> <span class="cm-operator">=</span> <span class="cm-variable">field</span> <span class="cm-operator">!=</span> <span class="cm-atom">null</span> <span class="cm-operator">?</span> <span class="cm-variable">field</span>.<span class="cm-variable">getType</span>() : <span class="cm-variable">method</span>.<span class="cm-variable">getParameters</span>()[<span class="cm-number">0</span>].<span class="cm-variable">getType</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">value</span> <span class="cm-operator">!=</span> <span class="cm-atom">null</span> <span class="cm-operator">&amp;&amp;</span> <span class="cm-variable">autowired</span> <span class="cm-operator">!=</span> <span class="cm-atom">null</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">throw</span> <span class="cm-keyword">new</span> <span class="cm-variable">BeanCreationException</span>(<span class="cm-variable-3">String</span>.<span class="cm-variable">format</span>(<span class="cm-string">"Cannot specify both @Autowired and @Value when inject %s.%s for bean '%s': %s"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">clazz</span>.<span class="cm-variable">getSimpleName</span>(), <span class="cm-variable">accessibleName</span>, <span class="cm-variable">def</span>.<span class="cm-variable">getName</span>(), <span class="cm-variable">def</span>.<span class="cm-variable">getBeanClass</span>().<span class="cm-variable">getName</span>()));</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">value</span> <span class="cm-operator">!=</span> <span class="cm-atom">null</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-3">Object</span> <span class="cm-variable">property</span> <span class="cm-operator">=</span> <span class="cm-keyword">this</span>.<span class="cm-variable">propertyResolver</span>.<span class="cm-variable">getRequiredProperty</span>(<span class="cm-variable">value</span>.<span class="cm-variable">value</span>(), <span class="cm-variable">accessibleType</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">field</span> <span class="cm-operator">!=</span> <span class="cm-atom">null</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">logger</span>.<span class="cm-variable">atDebug</span>().<span class="cm-variable">log</span>(<span class="cm-string">"Field injection: {}.{} = {}"</span>, <span class="cm-variable">def</span>.<span class="cm-variable">getBeanClass</span>().<span class="cm-variable">getName</span>(), <span class="cm-variable">accessibleName</span>, <span class="cm-variable">property</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">field</span>.<span class="cm-variable">set</span>(<span class="cm-variable">bean</span>, <span class="cm-variable">property</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  } <span class="cm-keyword">else</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">logger</span>.<span class="cm-variable">atDebug</span>().<span class="cm-variable">log</span>(<span class="cm-string">"Method injection: {}.{} = {}"</span>, <span class="cm-variable">def</span>.<span class="cm-variable">getBeanClass</span>().<span class="cm-variable">getName</span>(), <span class="cm-variable">accessibleName</span>, <span class="cm-variable">property</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">method</span>.<span class="cm-variable">invoke</span>(<span class="cm-variable">bean</span>, <span class="cm-variable">property</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">autowired</span> <span class="cm-operator">!=</span> <span class="cm-atom">null</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-3">String</span> <span class="cm-variable">name</span> <span class="cm-operator">=</span> <span class="cm-variable">autowired</span>.<span class="cm-variable">name</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-3">boolean</span> <span class="cm-variable">required</span> <span class="cm-operator">=</span> <span class="cm-variable">autowired</span>.<span class="cm-variable">value</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-3">Object</span> <span class="cm-variable">depends</span> <span class="cm-operator">=</span> <span class="cm-variable">name</span>.<span class="cm-variable">isEmpty</span>() <span class="cm-operator">?</span> <span class="cm-variable">findBean</span>(<span class="cm-variable">accessibleType</span>) : <span class="cm-variable">findBean</span>(<span class="cm-variable">name</span>, <span class="cm-variable">accessibleType</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">required</span> <span class="cm-operator">&amp;&amp;</span> <span class="cm-variable">depends</span> <span class="cm-operator">==</span> <span class="cm-atom">null</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">throw</span> <span class="cm-keyword">new</span> <span class="cm-variable">BeanCreationException</span>(<span class="cm-variable-3">String</span>.<span class="cm-variable">format</span>(<span class="cm-string">"Missing autowired bean with type '%s' when create bean '%s': %s."</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">accessibleType</span>.<span class="cm-variable">getName</span>(), <span class="cm-variable">def</span>.<span class="cm-variable">getName</span>(), <span class="cm-variable">def</span>.<span class="cm-variable">getBeanClass</span>().<span class="cm-variable">getName</span>()));</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">depends</span> <span class="cm-operator">!=</span> <span class="cm-atom">null</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">field</span> <span class="cm-operator">!=</span> <span class="cm-atom">null</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">logger</span>.<span class="cm-variable">atDebug</span>().<span class="cm-variable">log</span>(<span class="cm-string">"Field injection: {}.{} = {}"</span>, <span class="cm-variable">def</span>.<span class="cm-variable">getBeanClass</span>().<span class="cm-variable">getName</span>(), <span class="cm-variable">accessibleName</span>, <span class="cm-variable">depends</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">field</span>.<span class="cm-variable">set</span>(<span class="cm-variable">bean</span>, <span class="cm-variable">depends</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">method</span> <span class="cm-operator">!=</span> <span class="cm-atom">null</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">logger</span>.<span class="cm-variable">atDebug</span>().<span class="cm-variable">log</span>(<span class="cm-string">"Method injection: {}.{} = {}"</span>, <span class="cm-variable">def</span>.<span class="cm-variable">getBeanClass</span>().<span class="cm-variable">getName</span>(), <span class="cm-variable">accessibleName</span>, <span class="cm-variable">depends</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">method</span>.<span class="cm-variable">invoke</span>(<span class="cm-variable">bean</span>, <span class="cm-variable">depends</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 1613px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1613px;"></div></div></div></pre><h2 id='initbean'><span>InitBean</span></h2><p><span>åœ¨è¿™ä¸€æ­¥ä¸­æˆ‘ä»¬éœ€è¦å®Œæˆçš„æ˜¯åŒ…å«setterå’Œå­—æ®µçš„å¼±ä¾èµ–æ³¨å…¥ã€‚</span></p><blockquote><p><span>è¿™é‡Œçš„å¼±ä¾èµ–ç›¸å¯¹äºå‰ç¯‡æåˆ°çš„å¼ºä¾èµ–ï¼Œå¼ºä¾èµ–æ˜¯åœ¨ </span><code>new bean</code><span> æ—¶å°±éœ€è¦å®Œæˆçš„æ³¨å…¥ï¼Œæ¯”å¦‚å·¥å‚æ–¹æ³•åˆ›å»ºçš„beanã€éç©ºå‚æ•°çš„æ„é€ æ–¹æ³•åˆ›å»ºçš„beanï¼›è€Œå¼±ä¾èµ–æ˜¯å…è®¸åœ¨beanåˆ›å»ºä¹‹åè¿›è¡Œçš„æ³¨å…¥çš„ä¾èµ–</span></p></blockquote><p><span>æ ¸å¿ƒæ–¹æ³• </span><code>callMethod</code><span> ï¼š</span></p><ul><li><span>å¦‚æœä½œä¸ºå‚æ•°ä¼ å…¥çš„åˆå§‹åŒ–æ–¹æ³•ä¸ä¸ºç©ºï¼Œé‚£ä¹ˆæˆ‘ä»¬ç›´æ¥è°ƒç”¨</span></li><li><span>å¦åˆ™å½“åˆå§‹åŒ–æ–¹æ³•å­˜åœ¨æ—¶ï¼ˆ</span><code>namedMethod</code><span> ä¸ä¸º </span><code>null</code><span>  ï¼‰,ä½¿ç”¨ </span><code>ClassUtils.getNamedMethod</code><span> æ–¹æ³•åœ¨å®é™…ç±»å‹ä¸­æ‰¾åˆ°æ–¹æ³•ï¼Œå…³é—­è®¿é—®æ£€æŸ¥åé€šè¿‡åå°„è°ƒç”¨åˆå§‹åŒ–æ–¹æ³•ã€‚</span></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.2px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">private</span> <span class="cm-variable-3">void</span> <span class="cm-def">callMethod</span>(<span class="cm-variable-3">Object</span> <span class="cm-variable">beanInstance</span>, <span class="cm-variable">Method</span> <span class="cm-variable">method</span>, <span class="cm-variable-3">String</span> <span class="cm-variable">namedMethod</span>) { &nbsp;</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// è°ƒç”¨init/destroyæ–¹æ³•: &nbsp;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">method</span> <span class="cm-operator">!=</span> <span class="cm-atom">null</span>) { &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">try</span> { &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">method</span>.<span class="cm-variable">invoke</span>(<span class="cm-variable">beanInstance</span>); &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  } <span class="cm-keyword">catch</span> (<span class="cm-variable">ReflectiveOperationException</span> <span class="cm-variable">e</span>) { &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">throw</span> <span class="cm-keyword">new</span> <span class="cm-variable">BeanCreationException</span>(<span class="cm-variable">e</span>); &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  } &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  } <span class="cm-keyword">else</span> <span class="cm-keyword">if</span> (<span class="cm-variable">namedMethod</span> <span class="cm-operator">!=</span> <span class="cm-atom">null</span>) { &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// æŸ¥æ‰¾initMethod/destroyMethod="xyz"ï¼Œæ³¨æ„æ˜¯åœ¨å®é™…ç±»å‹ä¸­æŸ¥æ‰¾: &nbsp;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">Method</span> <span class="cm-variable">named</span> <span class="cm-operator">=</span> <span class="cm-variable">ClassUtils</span>.<span class="cm-variable">getNamedMethod</span>(<span class="cm-variable">beanInstance</span>.<span class="cm-variable">getClass</span>(), <span class="cm-variable">namedMethod</span>); &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">named</span>.<span class="cm-variable">setAccessible</span>(<span class="cm-atom">true</span>); &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">try</span> { &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">named</span>.<span class="cm-variable">invoke</span>(<span class="cm-variable">beanInstance</span>); &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  } <span class="cm-keyword">catch</span> (<span class="cm-variable">ReflectiveOperationException</span> <span class="cm-variable">e</span>) { &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">throw</span> <span class="cm-keyword">new</span> <span class="cm-variable">BeanCreationException</span>(<span class="cm-variable">e</span>); &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  } &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  } &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 426px;"></div><div class="CodeMirror-gutters" style="display: none; height: 426px;"></div></div></div></pre><p><span>è€Œç»“åˆ </span><code>beanDefinition</code><span> çš„åˆ›å»ºè¿‡ç¨‹ï¼Œæˆ‘ä»¬å…¶å®å¯ä»¥æ¸…æ™°çš„åˆ¤æ–­å‡ºå‰è€…å¤„ç†çš„æ˜¯ </span><code>@PostConstruct</code><span>ï¼Œåè€…å¤„ç†çš„æ˜¯å·¥å‚ç±»çš„æ–¹æ³•</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.2px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">BeanDefinition</span> <span class="cm-variable">beanDefinition</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">BeanDefinition</span>(<span class="cm-variable">beanName</span>, <span class="cm-variable">clazz</span>, <span class="cm-variable">getSuitableConstructor</span>(<span class="cm-variable">clazz</span>), &nbsp;</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">getOrder</span>(<span class="cm-variable">clazz</span>), <span class="cm-variable">clazz</span>.<span class="cm-variable">isAnnotationPresent</span>(<span class="cm-variable">Primary</span>.<span class="cm-keyword">class</span>), &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-atom">null</span>, <span class="cm-atom">null</span>, &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">ClassUtils</span>.<span class="cm-variable">findAnnotationMethod</span>(<span class="cm-variable">clazz</span>, <span class="cm-variable">PostConstruct</span>.<span class="cm-keyword">class</span>), &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">ClassUtils</span>.<span class="cm-variable">findAnnotationMethod</span>(<span class="cm-variable">clazz</span>, <span class="cm-variable">PreDestroy</span>.<span class="cm-keyword">class</span>)); &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">addBeanDefinitions</span>(<span class="cm-variable">defs</span>, <span class="cm-variable">beanDefinition</span>);</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 134px;"></div><div class="CodeMirror-gutters" style="display: none; height: 134px;"></div></div></div></pre><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.2px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">var</span> <span class="cm-variable">def</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">BeanDefinition</span>(<span class="cm-variable">ClassUtils</span>.<span class="cm-variable">getBeanName</span>(<span class="cm-variable">method</span>), <span class="cm-variable">classType</span>, <span class="cm-variable">factoryBeanName</span>, <span class="cm-variable">method</span>, &nbsp;</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">getOrder</span>(<span class="cm-variable">method</span>), <span class="cm-variable">method</span>.<span class="cm-variable">isAnnotationPresent</span>(<span class="cm-variable">Primary</span>.<span class="cm-keyword">class</span>), &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">bean</span>.<span class="cm-variable">initMethod</span>().<span class="cm-variable">isEmpty</span>() <span class="cm-operator">?</span> <span class="cm-atom">null</span> : <span class="cm-variable">bean</span>.<span class="cm-variable">initMethod</span>(), &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">bean</span>.<span class="cm-variable">destroyMethod</span>().<span class="cm-variable">isEmpty</span>() <span class="cm-operator">?</span> <span class="cm-atom">null</span> : <span class="cm-variable">bean</span>.<span class="cm-variable">destroyMethod</span>(), &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-atom">null</span>, <span class="cm-atom">null</span>); &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">addBeanDefinitions</span>(<span class="cm-variable">defs</span>, <span class="cm-variable">def</span>);</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 134px;"></div><div class="CodeMirror-gutters" style="display: none; height: 134px;"></div></div></div></pre><h2 id='beanpostprocessor'><span>BeanPostProcessor</span></h2><p><span>ç°åœ¨æˆ‘ä»¬è¦å¤„ç† spring ä»£ç†æœºåˆ¶ï¼Œä»¥</span><a href='https://www.liaoxuefeng.com/wiki/1539348902182944/1540069487804448'><span>å»–é›ªå³°è€å¸ˆçš„ä»£ç æ¡ˆä¾‹</span></a><span> </span><code>userService</code><span> å’Œ </span><code>userServiceProxy</code><span> ä¸ºä¾‹ä»‹ç»äº‹åŠ¡çš„å®ç°ï¼š</span></p><p><span>åœ¨ </span><code>main</code><span> ä¸­å¾—åˆ°çš„ </span><code>userService</code><span> çš„ beanï¼Œæ˜¯è¢« </span><code>BeanPostProcessor</code><span> å°† </span><code>userService</code><span> æ›¿æ¢çš„ </span><code>userServicePoxy</code><span>ï¼ˆå¯¹ </span><code>BeanPostProcessor</code><span> æ¥è¯´å°±æ˜¯å½“ä¼ å…¥çš„ </span><code>bean</code><span> åŒå±äº </span><code>userService</code><span> ç±»ï¼Œä¼šåˆ›å»ºå…¶ä»£ç†è¿”å›ï¼‰ã€‚è€Œåœ¨ </span><code>userServicePoxy</code><span> ä¸­ï¼Œå°† </span><code>uesrService</code><span> ä½œä¸ºå˜é‡ï¼Œè°ƒç”¨ </span><code>userServicePoxy</code><span> çš„æ–¹æ³•ã€‚</span></p><p><span>éœ€è¦æ³¨æ„çš„æ˜¯ï¼šåœ¨éœ€è¦ </span><code>userService</code><span> æ—¶è¿”å› </span><code>userServicePoxy</code><span>ï¼Œè€Œå¯¹äºbeanå®é™…çš„å±æ€§ </span><code>jdbcTemplate</code><span> æ³¨å…¥åˆ°åŸå§‹çš„ </span><code>userService</code><span> ä¸­ã€‚</span></p><p><span>æ•´ç†ä¸€ä¸‹æ€è·¯ï¼š</span></p><ol start='' ><li><span>å¯¹äºè¢«ä»£ç†çš„beanï¼Œéœ€è¦è¿™ä¸ªbeanæ—¶åº”è¯¥è¿”å›ä»£ç†</span></li><li><span>è™½ç„¶æˆ‘ä»¬è·å–åˆ°çš„beanæ˜¯ä»£ç†ï¼Œä½†æ˜¯æ³¨å…¥çš„ä¾èµ–åº”è¯¥åœ¨åŸæœ¬çš„beanä¸Šï¼Œä¿è¯åŸæœ¬beançš„åŠŸèƒ½æ­£å¸¸</span></li></ol><p><span>é‚£ä¹ˆåœ¨åç»­çš„ä»£ç å®ç°ä¸­æˆ‘ä»¬éœ€è¦åšçš„ç¬¬ä¸€æ­¥å°±æ˜¯ç­›é€‰å‡º </span><code>BeanPostProcessor</code><span> çš„ beanï¼Œè¿™æ˜¯ç¤ºä¾‹ï¼š</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.2px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-meta">@Bean</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">BeanPostProcessor</span> <span class="cm-def">createProxy</span>() {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">// â€¦â€¦</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 90px;"></div><div class="CodeMirror-gutters" style="display: none; height: 90px;"></div></div></div></pre><p><span>é‚£ä¹ˆå¯¹åº”çš„æˆ‘ä»¬åº”è¯¥åˆ¤æ–­è¿™ä¸ª bean çš„ç±»å‹æ˜¯å¦æ˜¯ BeanPostProcessorï¼Œè€Œä¸æ˜¯åƒå‰é¢çš„ </span><code>@Configuration</code><span> å»å¤„ç†é…ç½®ã€‚å†è®²ç­›é€‰å‡ºçš„ </span><code>BeanPostProcess</code><span> å­˜æ”¾åˆ°ç±»çš„List </span><code>beanPostProcessors</code></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.2px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">List</span><span class="cm-operator">&lt;</span><span class="cm-variable">BeanPostProcessor</span><span class="cm-operator">&gt;</span> <span class="cm-variable">processors</span> <span class="cm-operator">=</span> <span class="cm-keyword">this</span>.<span class="cm-variable">beans</span>.<span class="cm-variable">values</span>().<span class="cm-variable">stream</span>()</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// è¿‡æ»¤å‡º BeanPostProcessor ç±»å‹çš„bean</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  .<span class="cm-variable">filter</span>(<span class="cm-keyword">this</span>::<span class="cm-variable">isBeanPostProcessorDefinition</span>).<span class="cm-variable">sorted</span>().<span class="cm-variable">map</span>(<span class="cm-variable">bd</span> <span class="cm-operator">-&gt;</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> (<span class="cm-variable">BeanPostProcessor</span>) <span class="cm-variable">createBeanAsEarlySingleton</span>(<span class="cm-variable">bd</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }).<span class="cm-variable">collect</span>(<span class="cm-variable">Collectors</span>.<span class="cm-variable">toList</span>());</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">this</span>.<span class="cm-variable">beanPostProcessors</span>.<span class="cm-variable">addAll</span>(<span class="cm-variable">processors</span>);</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 134px;"></div><div class="CodeMirror-gutters" style="display: none; height: 134px;"></div></div></div></pre><p><span>è€Œæ›´ç»†è‡´çš„å¤„ç†å°±æ˜¯å°±æ˜¯åœ¨ setter+å­—æ®µæ³¨å…¥ å’Œ åˆå§‹åŒ–æ–¹æ³• ä¸­äº†ï¼š</span></p><p><span>åœ¨setter+å­—æ®µæ³¨å…¥çš„ </span><code>injectBean</code><span> æ–°å¢å¤„ç†ï¼Œå°±æ˜¯æˆ‘ä»¬å°†å±æ€§æ³¨å…¥åˆ°åŸæœ¬çš„beanä¸­ï¼š</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.2px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">Object</span> <span class="cm-variable">instance</span> <span class="cm-operator">=</span> <span class="cm-variable">getProxiedInstance</span>(<span class="cm-variable">beanDefinition</span>);</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">injectProperties</span>(<span class="cm-variable">beanDefinition</span>, <span class="cm-variable">beanDefinition</span>.<span class="cm-variable">getBeanClass</span>(), <span class="cm-variable">instance</span>);</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>åœ¨åˆå§‹åŒ–æ–¹æ³•çš„ </span><code>initBean</code><span> ä¸­å¤„ç†ï¼Œç›¸å¯¹äºåŸæœ¬çš„åªæ˜¯è°ƒç”¨ </span><code>callMethod</code><span>ï¼Œè¿™é‡Œéœ€è¦è·å–åˆ°åŸå§‹beanï¼Œç„¶åå¯¹è¿™ä¸ªbeanæ‰§è¡Œåˆå§‹åŒ–ï¼Œç„¶åæ˜¯ </span><code>beanPostPocessor</code><span> çš„åˆå§‹åŒ–å¤„ç†ã€‚</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.2px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-3">void</span> <span class="cm-def">initBean</span>(<span class="cm-variable">BeanDefinition</span> <span class="cm-variable">beanDefinition</span>) {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// è·å–beanç¤ºä¾‹ï¼Œæˆ–è€…è¢«ä»£ç†çš„åŸå§‹å®ä¾‹ï¼š</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">final</span> <span class="cm-variable-3">Object</span> <span class="cm-variable">beanInstance</span> <span class="cm-operator">=</span> <span class="cm-variable">getProxiedInstance</span>(<span class="cm-variable">beanDefinition</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">callMethod</span>(<span class="cm-variable">beanInstance</span>, <span class="cm-variable">beanDefinition</span>.<span class="cm-variable">getInitMethod</span>(), <span class="cm-variable">beanDefinition</span>.<span class="cm-variable">getInitMethodName</span>());</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// è°ƒç”¨ BeanPostProcessor.postProcessAfterInitialization()</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">beanPostProcessors</span>.<span class="cm-variable">forEach</span>(<span class="cm-variable">bp</span> <span class="cm-operator">-&gt;</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-3">Object</span> <span class="cm-variable">processedInstance</span> <span class="cm-operator">=</span> <span class="cm-variable">bp</span>.<span class="cm-variable">postProcessAfterInitialization</span>(<span class="cm-variable">beanDefinition</span>.<span class="cm-variable">getInstance</span>(), <span class="cm-variable">beanDefinition</span>.<span class="cm-variable">getName</span>());</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">processedInstance</span> <span class="cm-operator">!=</span> <span class="cm-variable">beanDefinition</span>.<span class="cm-variable">getInstance</span>()) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">logger</span>.<span class="cm-variable">atDebug</span>().<span class="cm-variable">log</span>(<span class="cm-string">"BeanPostProcessor {} return different bean from {} to {}."</span>, <span class="cm-variable">bp</span>.<span class="cm-variable">getClass</span>().<span class="cm-variable">getSimpleName</span>(),<span class="cm-variable">beanDefinition</span>.<span class="cm-variable">getInstance</span>().<span class="cm-variable">getClass</span>().<span class="cm-variable">getName</span>(), <span class="cm-variable">processedInstance</span>.<span class="cm-variable">getClass</span>().<span class="cm-variable">getName</span>());</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">beanDefinition</span>.<span class="cm-variable">setInstance</span>(<span class="cm-variable">processedInstance</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  });</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 358px;"></div><div class="CodeMirror-gutters" style="display: none; height: 358px;"></div></div></div></pre><p><span>æœ€åæ˜¯ç›¸å½“äºæ•´ä¸ªå®ç°çš„å·¥å…·æ–¹æ³•â€”â€”è·å–åˆ°åŸå§‹çš„beançš„æ–¹æ³•ï¼š</span></p><p><span>æˆ‘ä»¬åº”è¯¥å¦‚ä½•åœ¨ bean å¯èƒ½è¢«ä»£ç†æ‰€ä¿®æ”¹è¿‡çš„æƒ…å†µä¸‹è·å–åˆ°åŸå§‹çš„ beanï¼Ÿ</span></p><p><span>è¿™é‡Œçš„æ–¹æ³•æ˜¯ï¼šéå†åè½¬åæ‰€æœ‰çš„ </span><code>BeanPostProcessor</code><span>ï¼Œæˆ‘ä»¬å°†å…·ä½“çš„è·å–äº¤ç»™æ¥å£çš„å®ç°ï¼Œå› ä¸ºåœ¨è¿™ä¸ªå®ç°ç±»ä¸­ä¼šå°†åŸæœ¬çš„beanä½œä¸ºå±æ€§ã€‚</span></p><p><span>æ³¨æ„è¿™é‡Œçš„åè½¬ </span><code>Collections.revers(reversedBeanPostProcessors);</code><span>  å±æ€§çš„åº”ç”¨å¯èƒ½æ˜¯å¤šå±‚æ¬¡çš„ï¼Œæ­£å¥½å¥‘åˆåè½¬åçš„é¡ºåºã€‚</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.2px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-3">Object</span> <span class="cm-def">getProxiedInstance</span>(<span class="cm-variable">BeanDefinition</span> <span class="cm-variable">def</span>) {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-3">Object</span> <span class="cm-variable">beanInstance</span> <span class="cm-operator">=</span> <span class="cm-variable">def</span>.<span class="cm-variable">getInstance</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// å¦‚æœä»£ç†æ”¹å˜äº†åŸå§‹beanï¼Œæœ‰å¸Œæœ›å‘åŸå§‹beanæ³¨å…¥å±æ€§ï¼š</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">ArrayList</span><span class="cm-operator">&lt;</span><span class="cm-variable">BeanPostProcessor</span><span class="cm-operator">&gt;</span> <span class="cm-variable">reversedBeanPostProcessors</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">ArrayList</span><span class="cm-operator">&lt;&gt;</span>(<span class="cm-keyword">this</span>.<span class="cm-variable">beanPostProcessors</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">Collections</span>.<span class="cm-variable">reverse</span>(<span class="cm-variable">reversedBeanPostProcessors</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">for</span> (<span class="cm-variable">BeanPostProcessor</span> <span class="cm-variable">revered</span> : <span class="cm-variable">reversedBeanPostProcessors</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-3">Object</span> <span class="cm-variable">restoredInstance</span> <span class="cm-operator">=</span> <span class="cm-variable">revered</span>.<span class="cm-variable">postProcessOnSetProperty</span>(<span class="cm-variable">beanInstance</span>, <span class="cm-variable">def</span>.<span class="cm-variable">getName</span>());</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">restoredInstance</span> <span class="cm-operator">!=</span> <span class="cm-variable">beanInstance</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">logger</span>.<span class="cm-variable">atDebug</span>().<span class="cm-variable">log</span>(<span class="cm-string">"BeanPostProcessor {} specified injection from {} to {}."</span>, <span class="cm-variable">revered</span>.<span class="cm-variable">getClass</span>().<span class="cm-variable">getSimpleName</span>(),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">beanInstance</span>.<span class="cm-variable">getClass</span>().<span class="cm-variable">getSimpleName</span>(), <span class="cm-variable">restoredInstance</span>.<span class="cm-variable">getClass</span>().<span class="cm-variable">getSimpleName</span>());</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">beanInstance</span> <span class="cm-operator">=</span> <span class="cm-variable">restoredInstance</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">beanInstance</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 381px;"></div><div class="CodeMirror-gutters" style="display: none; height: 381px;"></div></div></div></pre><p><span>æœ€åï¼š</span></p><p><span>æ•´ç†ç”¨æˆ·çº§åˆ« </span><code>BeanPostProcessor</code><span>ã€æ¡†æ¶ </span><code>ConfigurableApplicationContext</code><span> çº§åˆ«çš„æ¥å£</span></p><p><span>è¿™é‡Œæ˜¯å¾ˆåŸºç¡€çš„è§£è€¦ï¼Œé«˜çº§æ¨¡å—ä¸ç›´æ¥ä¾èµ–äºä½çº§æ¨¡å—ï¼Œè€Œæ˜¯ä¾èµ–æ¥å£ï¼Œä½çº§æ¨¡å—å®ç°æ¥å£ã€‚</span></p><h1 id='----aop----'><span>â€” AOP â€”</span></h1><p><span>é¢å‘åˆ‡é¢æ˜¯ä¸€ç§ä»£ç†ï¼Œè€Œä»£ç†æ˜¯æ‹¦æˆªå¯¹ç›®æ ‡beanæ–¹æ³•çš„è°ƒç”¨ï¼Œæˆ‘ä»¬æœ‰ä¸‰ç§æ–¹å¼å®ç°æ‹¦æˆªï¼Œè¿™é‡Œæˆ‘ä»¬æŒ‰ç…§ç¨‹åºè¿è¡Œçš„é¡ºåºï¼š</span></p><ol start='' ><li><p><span>ç¼–è¯‘å™¨ï¼šé€šè¿‡ç¼–è¯‘å™¨å°†åˆ‡é¢è°ƒç”¨ç¼–è¯‘è¿›å­—èŠ‚ç æ–‡ä»¶ï¼Œä½†éœ€è¦å®šä¹‰æ–°çš„å…³é”®å­—å¹¶æ‰©å±•ç¼–è¯‘å™¨</span></p><p><span>è¿™ç§æ–¹æ³•çš„å®ç°æœ‰ </span><code>AspectJ</code><span>ï¼Œä½¿ç”¨äº† </span><code>aspect</code><span> å…³é”®å­—</span></p></li><li><p><span>ç±»åŠ è½½å™¨ï¼šåœ¨ç±»è¢«è£…è½½åˆ° JVM æ—¶ï¼Œä½¿ç”¨ç±»åŠ è½½èµ·å®ç°å¯¹ç›®æ ‡ç±»çš„å­—èŠ‚ç â€œå¢å¼ºâ€</span></p></li><li><p><span>è¿è¡ŒæœŸï¼šä¸åŒäºç¼–è¯‘å™¨çš„å®ç°ï¼Œè¿™é‡Œç›®æ ‡ç±»å’Œåˆ‡é¢éƒ½æ˜¯æ™®é€š java ç±»ï¼Œåˆ©ç”¨ JVM çš„åŠ¨æ€ä»£ç†åŠŸèƒ½æˆ–è€…ç¬¬ä¸‰æ–¹åº“ç»‡å…¥</span></p><p><span>è¿™ä¸ªæ˜¯æœ€ç®€å•çš„æ–¹æ¡ˆï¼Œæœ‰ä¸¤ç§å¸¸è§çš„å®ç°ï¼š</span></p><ol start='' ><li><span>Javaæ ‡å‡†åº“çš„åŠ¨æ€ä»£ç†æœºåˆ¶ï¼Œä¸æ”¯æŒå¯¹å…·ä½“ç±»çš„ä»£ç†</span></li><li><span>ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“ï¼Œé€šè¿‡åŠ¨æ€ç”Ÿæˆå­—èŠ‚ç ï¼Œæ”¯æŒå¯¹å…·ä½“ç±»çš„ä»£ç†</span></li></ol></li></ol><p><span>æœ€åæˆ‘ä»¬ç¡®å®šä½¿ç”¨ç¬¬ä¸‰æ–¹åº“+æ³¨è§£çš„æ–¹å¼å®ç°ã€‚</span></p><p><span>å¼€å§‹å…·ä½“çš„å®ç°åï¼Œæˆ‘ä»¬éœ€è¦æ³¨æ„å¿…é¡»æä¾›çš„ä¸¤ä¸ªBeanï¼š</span></p><ol start='' ><li><span>åŸå§‹Beanï¼Œå³éœ€è¦è¢«ä»£ç†çš„Beanï¼›</span></li><li><span>æ‹¦æˆªå™¨ï¼Œå³æ‹¦æˆªäº†ç›®æ ‡Beançš„æ–¹æ³•åï¼Œä¼šè‡ªåŠ¨è°ƒç”¨æ‹¦æˆªå™¨å®ç°ä»£ç†åŠŸèƒ½ã€‚</span></li></ol><p><span>æ‹¦æˆªå™¨éœ€è¦å®šä¹‰æ¥å£ï¼Œè¿™é‡Œæˆ‘ä»¬ç›´æ¥ç”¨Javaæ ‡å‡†åº“çš„</span><code>InvocationHandler</code><span>ï¼Œå…å»äº†è‡ªå®šä¹‰æ¥å£ã€‚åç»­æˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯ï¼š</span></p><ol start='' ><li><span>ä» </span><code>IOC</code><span> å®¹å™¨ä¸­è·å– bean</span></li><li><span>å®ç°äº†</span><code>InvocationHandler</code><span>çš„æ‹¦æˆªå™¨Bean</span></li><li><span>é€šè¿‡ç¬¬ä¸‰æ–¹åº“ç”Ÿäº§å­—èŠ‚ç å®Œæˆå¯¹å…·ä½“ç±»çš„ä»£ç†</span></li></ol><h2 id='around'><span>Around</span></h2><p><span>åœ¨è¿™é‡Œæˆ‘ä»¬å®Œæˆä»å®¹å™¨ä¸­è·å–beanå’Œå®ç°æ‹¦æˆªå™¨çš„æ­¥éª¤ã€‚åœ¨ä»£ç ç¼–å†™ä¹‹å‰æˆ‘ä»¬å…ˆæ•´ç†æ€è·¯ï¼š</span></p><p><span>ä»ç›¸å¯¹å…·ä½“çš„ï¼šæˆ‘ä»¬å¸Œæœ› @Around æ³¨è§£çš„ bean è§¦å‘ AOPï¼Œ</span><code>AroundInvocationHandler</code><span> ä¼šå¤„ç†å¯¹è¿™ä¸ª bean çš„æ‹¦æˆªï¼Œè€Œä»è¿™ä¸ªæ³¨è§£æ‰©å±•åˆ°æ›´æŠ½è±¡çš„è‡ªå®šä¹‰æ³¨è§£ï¼Œæˆ‘ä»¬éœ€è¦è®¾ç½® </span><code>AroundInvocationHandler</code><span> çš„å‚æ•°ä¸ºæ³¨è§£å¹¶ä¿®æ”¹åç§°ä¸º </span><code>AnnotationProxyBeanPostProcessor</code><span>ï¼Œåœ¨åç»­çš„ä½¿ç”¨ä¸­åªéœ€è¦åˆ›å»ºç»§æ‰¿è¿™ä¸ªæ¥å£å¹¶åˆ¶å®šæ³›å‹çš„ç±»å³å¯ã€‚</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.2px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">abstract</span> <span class="cm-keyword">class</span> <span class="cm-def">AnnotationProxyBeanPostProcessor</span><span class="cm-operator">&lt;</span><span class="cm-variable">A</span> <span class="cm-keyword">extends</span> <span class="cm-variable">Annotation</span><span class="cm-operator">&gt;</span> <span class="cm-keyword">implements</span> <span class="cm-variable">BeanPostProcessor</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">// ç›®æ ‡å¯¹è±¡çš„é›†åˆ</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">Map</span><span class="cm-operator">&lt;</span><span class="cm-variable-3">String</span>, <span class="cm-variable-3">Object</span><span class="cm-operator">&gt;</span> <span class="cm-variable">originBeans</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">HashMap</span><span class="cm-operator">&lt;&gt;</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">// åˆ‡å…¥ç‚¹ï¼ˆæ³¨é‡Šååœ¨è¯¥æ–¹æ³•è¢«è°ƒç”¨çš„æ—¶å€™è¢«æ‹¦æˆªï¼‰</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">Class</span><span class="cm-operator">&lt;</span><span class="cm-variable">A</span><span class="cm-operator">&gt;</span> <span class="cm-variable">annotationClass</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">/*â€¦â€¦*/</span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span> }</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 134px;"></div><div class="CodeMirror-gutters" style="display: none; height: 134px;"></div></div></div></pre><p><span>å¯¹æ¥å£ </span><code>BeanPostProcessor</code><span> çš„å®ç°ï¼Œåœ¨ spring åˆå§‹åŒ– bean å‰è°ƒç”¨ã€‚å¾—åˆ°æ³¨è§£å¹¶é€šè¿‡æ³¨è§£å¾—åˆ° nameï¼Œæ ¹æ®ç±»å‹ã€beanã€nameæ¥å¾—åˆ°ä»£ç†å¯¹è±¡å¹¶è¿”å›ã€‚</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.2px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable-3">Object</span> <span class="cm-def">postProcessBeforeInitialization</span>(<span class="cm-variable-3">Object</span> <span class="cm-variable">bean</span>, <span class="cm-variable-3">String</span> <span class="cm-variable">beanName</span>) {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">Class</span><span class="cm-operator">&lt;?&gt;</span> <span class="cm-variable">beanClass</span> <span class="cm-operator">=</span> <span class="cm-variable">bean</span>.<span class="cm-variable">getClass</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">A</span> <span class="cm-variable">annotation</span> <span class="cm-operator">=</span> <span class="cm-variable">beanClass</span>.<span class="cm-variable">getAnnotation</span>(<span class="cm-variable">annotationClass</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">annotation</span> <span class="cm-operator">!=</span> <span class="cm-atom">null</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-3">String</span> <span class="cm-variable">handlerName</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">try</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">handlerName</span> <span class="cm-operator">=</span> (<span class="cm-variable-3">String</span>) <span class="cm-variable">annotation</span>.<span class="cm-variable">annotationType</span>().<span class="cm-variable">getMethod</span>(<span class="cm-string">"value"</span>).<span class="cm-variable">invoke</span>(<span class="cm-variable">annotation</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  } <span class="cm-keyword">catch</span> (<span class="cm-variable">ReflectiveOperationException</span> <span class="cm-variable">e</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">throw</span> <span class="cm-keyword">new</span> <span class="cm-variable">AopConfigException</span>(<span class="cm-variable-3">String</span>.<span class="cm-variable">format</span>(<span class="cm-string">"@%s must have value() returned String type."</span>, <span class="cm-keyword">this</span>.<span class="cm-variable">annotationClass</span>.<span class="cm-variable">getSimpleName</span>()), <span class="cm-variable">e</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-3">Object</span> <span class="cm-variable">proxy</span> <span class="cm-operator">=</span> <span class="cm-variable">createProxy</span>(<span class="cm-variable">beanClass</span>, <span class="cm-variable">bean</span>, <span class="cm-variable">handlerName</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">originBeans</span>.<span class="cm-variable">put</span>(<span class="cm-variable">beanName</span>, <span class="cm-variable">bean</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">proxy</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  } <span class="cm-keyword">else</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">bean</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">// ä¸€ä¸ªè·å–åŸå§‹beançš„çª—å£</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-meta">@Override</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable-3">Object</span> <span class="cm-def">postProcessOnSetProperty</span>(<span class="cm-variable-3">Object</span> <span class="cm-variable">bean</span>, <span class="cm-variable-3">String</span> <span class="cm-variable">beanName</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-3">Object</span> <span class="cm-variable">origin</span> <span class="cm-operator">=</span> <span class="cm-keyword">this</span>.<span class="cm-variable">originBeans</span>.<span class="cm-variable">get</span>(<span class="cm-variable">beanName</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">origin</span> <span class="cm-operator">!=</span> <span class="cm-atom">null</span> <span class="cm-operator">?</span> <span class="cm-variable">origin</span> : <span class="cm-variable">bean</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 560px;"></div><div class="CodeMirror-gutters" style="display: none; height: 560px;"></div></div></div></pre><p><span>åœ¨ </span><code>createProxy</code><span> ä¸­ï¼Œå…ˆé€šè¿‡åç§°å¾—åˆ° BeanDefinitionï¼Œè¦æ±‚ä¸€å®šå­˜åœ¨ï¼Œç„¶åä¸€æ­¥æ­¥éªŒè¯ç¤ºä¾‹ï¼Œæ²¡æœ‰åˆ™åˆ›å»ºï¼Œæœ€åäº¤ç»™ </span><code>ProxyResolver</code><span> å¤„ç†ï¼ŒåŠ¨æ€æ­£å¸¸å­—èŠ‚ç ã€‚</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.2px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-3">Object</span> <span class="cm-def">createProxy</span>(<span class="cm-variable">Class</span><span class="cm-operator">&lt;?&gt;</span> <span class="cm-variable">beanClass</span>, <span class="cm-variable-3">Object</span> <span class="cm-variable">bean</span>, <span class="cm-variable-3">String</span> <span class="cm-variable">handlerName</span>) {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">ConfigurableApplicationContext</span> <span class="cm-variable">context</span> <span class="cm-operator">=</span> (<span class="cm-variable">ConfigurableApplicationContext</span>) <span class="cm-variable">ApplicationContextUtils</span>.<span class="cm-variable">getRequiredApplicationContext</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">BeanDefinition</span> <span class="cm-variable">definition</span> <span class="cm-operator">=</span> <span class="cm-variable">context</span>.<span class="cm-variable">findBeanDefinition</span>(<span class="cm-variable">handlerName</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">definition</span> <span class="cm-operator">==</span> <span class="cm-atom">null</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">throw</span> <span class="cm-keyword">new</span> <span class="cm-variable">AopConfigException</span>(<span class="cm-variable-3">String</span>.<span class="cm-variable">format</span>(<span class="cm-string">"@%s proxy handler '%s' not found."</span>, <span class="cm-keyword">this</span>.<span class="cm-variable">annotationClass</span>.<span class="cm-variable">getSimpleName</span>(), <span class="cm-variable">handlerName</span>));</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-3">Object</span> <span class="cm-variable">handlerBean</span> <span class="cm-operator">=</span> <span class="cm-variable">definition</span>.<span class="cm-variable">getInstance</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">handlerBean</span> <span class="cm-operator">==</span> <span class="cm-atom">null</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">handlerBean</span> <span class="cm-operator">=</span> <span class="cm-variable">context</span>.<span class="cm-variable">createBeanAsEarlySingleton</span>(<span class="cm-variable">definition</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">handlerBean</span> <span class="cm-keyword">instanceof</span> <span class="cm-variable">InvocationHandler</span> <span class="cm-variable">handler</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">ProxyResolver</span>.<span class="cm-variable">getInstance</span>().<span class="cm-variable">createProxy</span>(<span class="cm-variable">bean</span>, <span class="cm-variable">handler</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  } <span class="cm-keyword">else</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">throw</span> <span class="cm-keyword">new</span> <span class="cm-variable">AopConfigException</span>(<span class="cm-variable-3">String</span>.<span class="cm-variable">format</span>(<span class="cm-string">"@%s proxy handler '%s' is not type of %s."</span>, <span class="cm-keyword">this</span>.<span class="cm-variable">annotationClass</span>.<span class="cm-variable">getSimpleName</span>(), <span class="cm-variable">handlerName</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">InvocationHandler</span>.<span class="cm-keyword">class</span>.<span class="cm-variable">getName</span>()));</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 448px;"></div><div class="CodeMirror-gutters" style="display: none; height: 448px;"></div></div></div></pre><p><span>æˆ‘ä»¬éœ€è¦ç‰¹æ®Šå¤„ç†æ„é€ æ–¹æ³•ï¼Œéœ€è¦ç¡®ä¿é’ˆå¯¹ç‰¹å®šæ³¨è§£ç±»å‹è®¾è®¡ï¼Œä¿è¯å®ä¾‹åŒ–æ—¶å°±çŸ¥é“å®ƒå¤„ç†çš„æ³¨è§£ç±»å‹ã€‚</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.2px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable">AnnotationProxyBeanPostProcessor</span>() {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">this</span>.<span class="cm-variable">annotationClass</span> <span class="cm-operator">=</span> <span class="cm-variable">getParameterizedType</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 67px;"></div><div class="CodeMirror-gutters" style="display: none; height: 67px;"></div></div></div></pre><p><span>è¿™æ®µä»£ç è·å–æ³›å‹çˆ¶ç±»çš„ç±»å‹ï¼Œå¦‚æœç±»å®šä¹‰æ˜¯</span><code>MyProcessor extends AnnotationProxyBeanPostProcessor&lt;MyAnnotation&gt;</code><span>ï¼Œé‚£ä¹ˆè¿™æ®µä»£ç ä¼šæå–</span><code>MyAnnotation</code><span>çš„ç±»å‹ä¿¡æ¯ã€‚</span></p><p><span>é€šè¿‡ </span><code>getClass().getGenericSuperclass()</code><span> è·å–å½“å‰ç±»çš„çˆ¶ç±»ï¼Œç°åˆ¤æ–­æ˜¯å¦æ˜¯æ³›å‹ç±»å‹æŒ‡é’ˆ</span><sup class='md-footnote'><a href='#dfref-footnote-4' name='ref-footnote-4'>4</a></sup><span> </span><code>ParameterizedType</code><span> </span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.2px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-meta">@SuppressWarnings</span>(<span class="cm-string">"unchecked"</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">private</span> <span class="cm-variable">Class</span><span class="cm-operator">&lt;</span><span class="cm-variable">A</span><span class="cm-operator">&gt;</span> <span class="cm-def">getParameterizedType</span>() {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">Type</span> <span class="cm-variable">type</span> <span class="cm-operator">=</span> <span class="cm-variable">getClass</span>().<span class="cm-variable">getGenericSuperclass</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// è¦æ±‚typeæ˜¯æ³›å‹ç±»å‹</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-operator">!</span>(<span class="cm-variable">type</span> <span class="cm-keyword">instanceof</span> <span class="cm-variable">ParameterizedType</span>)) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">throw</span> <span class="cm-keyword">new</span> <span class="cm-variable">IllegalArgumentException</span>(<span class="cm-string">"Class "</span> <span class="cm-operator">+</span> <span class="cm-variable">getClass</span>().<span class="cm-variable">getName</span>() <span class="cm-operator">+</span> <span class="cm-string">" does not have parameterized type."</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">ParameterizedType</span> <span class="cm-variable">pt</span> <span class="cm-operator">=</span> (<span class="cm-variable">ParameterizedType</span>) <span class="cm-variable">type</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// å¾—åˆ°å®é™…å‚æ•°ç±»å‹</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">Type</span>[] <span class="cm-variable">arguments</span> <span class="cm-operator">=</span> <span class="cm-variable">pt</span>.<span class="cm-variable">getActualTypeArguments</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">arguments</span>.<span class="cm-variable">length</span> <span class="cm-operator">!=</span> <span class="cm-number">1</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">throw</span> <span class="cm-keyword">new</span> <span class="cm-variable">IllegalArgumentException</span>(<span class="cm-string">"Class "</span> <span class="cm-operator">+</span> <span class="cm-variable">getClass</span>().<span class="cm-variable">getName</span>() <span class="cm-operator">+</span> <span class="cm-string">" has more than 1 parameterized types."</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">Type</span> <span class="cm-variable">r</span> <span class="cm-operator">=</span> <span class="cm-variable">arguments</span>[<span class="cm-number">0</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-operator">!</span>(<span class="cm-variable">r</span> <span class="cm-keyword">instanceof</span> <span class="cm-variable">Class</span><span class="cm-operator">&lt;?&gt;</span>)) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">throw</span> <span class="cm-keyword">new</span> <span class="cm-variable">IllegalArgumentException</span>(<span class="cm-string">"Class "</span> <span class="cm-operator">+</span> <span class="cm-variable">getClass</span>().<span class="cm-variable">getName</span>() <span class="cm-operator">+</span> <span class="cm-string">" does not have parameterized type of class."</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> (<span class="cm-variable">Class</span><span class="cm-operator">&lt;</span><span class="cm-variable">A</span><span class="cm-operator">&gt;</span>) <span class="cm-variable">r</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 538px;"></div><div class="CodeMirror-gutters" style="display: none; height: 538px;"></div></div></div></pre><p><span>è¿™æ˜¯ </span><code>@Around</code><span> çš„ä½¿ç”¨ç¤ºä¾‹ï¼š</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.2px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">class</span> <span class="cm-def">AroundProxyBeanPostProcessor</span> <span class="cm-keyword">extends</span> <span class="cm-variable">AnnotationProxyBeanPostProcessor</span><span class="cm-operator">&lt;</span><span class="cm-variable">Around</span><span class="cm-operator">&gt;</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>å¯¹äº </span><code>Before</code><span> å’Œ </span><code>Around</code><span> æ‹¦æˆªï¼Œæˆ‘ä»¬åªéœ€è¦å®Œæˆæ‹¦æˆªå™¨æ¨¡æ¿ï¼Œè¿™é‡Œæˆ‘ä»¬éœ€è¦æ³¨æ„ </span><code>After</code><span> æ‹¦æˆªè¿è¡Œä¿®æ”¹æ–¹æ³•è¿”å›å€¼</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.2px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">abstract</span> <span class="cm-keyword">class</span> <span class="cm-def">BeforeInvocationHandlerAdapter</span> <span class="cm-keyword">implements</span> <span class="cm-variable">InvocationHandler</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-keyword">abstract</span> <span class="cm-variable-3">void</span> <span class="cm-variable">before</span>(<span class="cm-variable-3">Object</span> <span class="cm-variable">proxy</span>, <span class="cm-variable">Method</span> <span class="cm-variable">method</span>, <span class="cm-variable-3">Object</span>[] <span class="cm-variable">args</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-meta">@Override</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable-3">Object</span> <span class="cm-variable">invoke</span>(<span class="cm-variable-3">Object</span> <span class="cm-variable">proxy</span>, <span class="cm-variable">Method</span> <span class="cm-variable">method</span>, <span class="cm-variable-3">Object</span>[] <span class="cm-variable">args</span>) <span class="cm-keyword">throws</span> <span class="cm-variable">Throwable</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">before</span>(<span class="cm-variable">proxy</span>, <span class="cm-variable">method</span>, <span class="cm-variable">args</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">method</span>.<span class="cm-variable">invoke</span>(<span class="cm-variable">proxy</span>, <span class="cm-variable">args</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 202px;"></div><div class="CodeMirror-gutters" style="display: none; height: 202px;"></div></div></div></pre><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.2px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">abstract</span> <span class="cm-keyword">class</span> <span class="cm-def">AfterInvocationHandlerAdapter</span> <span class="cm-keyword">implements</span> <span class="cm-variable">InvocationHandler</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// after æ‹¦æˆªå¯ä»¥ä¿®æ”¹è¿”å›å€¼</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-keyword">abstract</span> <span class="cm-variable-3">Object</span> <span class="cm-variable">after</span>(<span class="cm-variable-3">Object</span> <span class="cm-variable">proxy</span>, <span class="cm-variable-3">Object</span> <span class="cm-variable">returnValue</span>, <span class="cm-variable">Method</span> <span class="cm-variable">method</span>, <span class="cm-variable-3">Object</span>[] <span class="cm-variable">args</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-meta">@Override</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-keyword">final</span> <span class="cm-variable-3">Object</span> <span class="cm-variable">invoke</span>(<span class="cm-variable-3">Object</span> <span class="cm-variable">proxy</span>, <span class="cm-variable">Method</span> <span class="cm-variable">method</span>, <span class="cm-variable-3">Object</span>[] <span class="cm-variable">args</span>) <span class="cm-keyword">throws</span> <span class="cm-variable">Throwable</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-3">Object</span> <span class="cm-variable">ret</span> <span class="cm-operator">=</span> <span class="cm-variable">method</span>.<span class="cm-variable">invoke</span>(<span class="cm-variable">proxy</span>, <span class="cm-variable">args</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">after</span>(<span class="cm-variable">proxy</span>, <span class="cm-variable">ret</span>, <span class="cm-variable">method</span>, <span class="cm-variable">args</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 224px;"></div><div class="CodeMirror-gutters" style="display: none; height: 224px;"></div></div></div></pre><p>&nbsp;</p><h2 id='proxyresolver'><span>ProxyResolver</span></h2><p><span>å…ˆå¯¼å…¥ </span><code>byteBuddy</code><span> çš„ maven é…ç½®ï¼Œåç»­å°±æ˜¯æ ¹æ®æ–‡æ¡£æˆ–è€…å…¶ä»–æ•™ç¨‹ï¼Œ</span><a href='https://www.baeldung.com/byte-buddy'><span>æ¨èæ•™ç¨‹</span></a><span>ï¼Œå®Œæˆ</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.2px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-operator">&lt;</span><span class="cm-variable">T</span><span class="cm-operator">&gt;</span> <span class="cm-variable">T</span> <span class="cm-def">createProxy</span>(<span class="cm-variable">T</span> <span class="cm-variable">bean</span>, <span class="cm-variable">InvocationHandler</span> <span class="cm-variable">handler</span>) {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">Class</span><span class="cm-operator">&lt;?&gt;</span> <span class="cm-variable">targetClass</span> <span class="cm-operator">=</span> <span class="cm-variable">bean</span>.<span class="cm-variable">getClass</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">logger</span>.<span class="cm-variable">atDebug</span>().<span class="cm-variable">log</span>(<span class="cm-string">"create proxy for bean {} @{}"</span>, <span class="cm-variable">targetClass</span>.<span class="cm-variable">getName</span>(), <span class="cm-variable-3">Integer</span>.<span class="cm-variable">toHexString</span>(<span class="cm-variable">bean</span>.<span class="cm-variable">hashCode</span>()));</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// åŠ¨æ€åˆ›å»ºä»£ç†ç±»</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">Class</span><span class="cm-operator">&lt;?&gt;</span> <span class="cm-variable">proxyClass</span> <span class="cm-operator">=</span> <span class="cm-keyword">this</span>.<span class="cm-variable">byteBuddy</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// è¿™ä¸ªä»£ç†ç±»æ˜¯ targetClass çš„å­ç±»ï¼Œå­ç±»ä½¿ç”¨é»˜è®¤çš„æ„é€ æ–¹æ³•</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  .<span class="cm-variable">subclass</span>(<span class="cm-variable">targetClass</span>, <span class="cm-variable">ConstructorStrategy</span>.<span class="cm-variable">Default</span>.<span class="cm-variable">DEFAULT_CONSTRUCTOR</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// å¤„ç† target æ‰€æœ‰ public çš„æ–¹æ³•çš„è°ƒç”¨</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  .<span class="cm-variable">method</span>(<span class="cm-variable">ElementMatchers</span>.<span class="cm-variable">isPublic</span>())</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// æ‹¦æˆªå™¨ï¼Œå°†æ‰€æœ‰å¯¹å­ç±»çš„ public æ–¹æ³•è°ƒç”¨è½¬å‘åˆ°åŸæœ¬çš„ bean ä¸­æ‰§è¡Œ</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  .<span class="cm-variable">intercept</span>(<span class="cm-variable">InvocationHandlerAdapter</span>.<span class="cm-variable">of</span>(</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">new</span> <span class="cm-variable">InvocationHandler</span>() {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable-3">Object</span> <span class="cm-variable">invoke</span>(<span class="cm-variable-3">Object</span> <span class="cm-variable">proxy</span>, <span class="cm-variable">Method</span> <span class="cm-variable">method</span>, <span class="cm-variable-3">Object</span>[] <span class="cm-variable">args</span>) <span class="cm-keyword">throws</span> <span class="cm-variable">Throwable</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// å°†æ–¹æ³•çš„è°ƒç”¨è½¬å‘åˆ°åŸæœ¬çš„beanä¸Š</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">handler</span>.<span class="cm-variable">invoke</span>(<span class="cm-variable">bean</span>, <span class="cm-variable">method</span>, <span class="cm-variable">args</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  )).<span class="cm-variable">make</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  .<span class="cm-variable">load</span>(<span class="cm-variable">targetClass</span>.<span class="cm-variable">getClassLoader</span>())</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  .<span class="cm-variable">getLoaded</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-3">Object</span> <span class="cm-variable">proxy</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">try</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">proxy</span> <span class="cm-operator">=</span> <span class="cm-variable">proxyClass</span>.<span class="cm-variable">getConstructor</span>().<span class="cm-variable">newInstance</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  } <span class="cm-keyword">catch</span> (<span class="cm-variable">RuntimeException</span> <span class="cm-variable">e</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">throw</span> <span class="cm-variable">e</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  } <span class="cm-keyword">catch</span> (<span class="cm-variable">Exception</span> <span class="cm-variable">e</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">throw</span> <span class="cm-keyword">new</span> <span class="cm-variable">RuntimeException</span>(<span class="cm-variable">e</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> (<span class="cm-variable">T</span>) <span class="cm-variable">proxy</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 717px;"></div><div class="CodeMirror-gutters" style="display: none; height: 717px;"></div></div></div></pre><h1 id='---jdbcå’Œäº‹åŠ¡---'><span>â€”JDBCå’Œäº‹åŠ¡â€”</span></h1><p><span>è¿™é‡Œå°†ä¼šå®ç° </span><code>JdbcTemplate</code><span> æ¨¡æ¿ï¼Œä»¥åŠï¼ˆé€šè¿‡æ³¨è§£å®ç°çš„ï¼‰å£°æ˜å¼äº‹åŠ¡çš„æ”¯æŒã€‚</span></p><p><span>è®¾ç½®è¯»å–çš„é…ç½®å˜é‡ï¼Œè·å–æ•°æ®åº“è¿æ¥ï¼Œå†å¤„ç† </span><code>PrepareStatement</code><span> é¢„é˜² sql æ³¨å…¥ï¼Œè¿™é‡Œçš„æ˜¯ç°å®æ˜¯åœ¨æœ€åŸºç¡€çš„ </span><code>execute</code><span> è‡³ä¸Šï¼Œå®šä¹‰</span><code>PreparedStatementCreator</code><span> æ¥å£å’Œ </span><code>PreparedStatementCallback</code><span> æ¥å£ï¼Œå‰è€…å¤„ç† sql å’Œé…ç½® </span><code>PrepareStatement</code><span>ï¼Œåè€…æ¥å—ä¸€ä¸ª </span><code>PreparedStatement</code><span> å¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œå¹¶æ‰§è¡Œæ•°æ®åº“æ“ä½œã€‚</span></p><p><span>åœ¨æ‰§è¡Œè¯­å¥åæˆ‘ä»¬ä½¿ç”¨ </span><code>BeanRowMapper</code><span> å¤„ç†å¾—åˆ°çš„ç»“æœï¼Œå®ç°è‡ªåŠ¨æ˜ å°„å’Œè‡ªåŠ¨åŒ–å­—æ®µåŒ¹é…ã€‚</span></p><h2 id='jdbctemplate'><span>JdbcTemplate</span></h2><p><span>æœ€åŸºç¡€çš„è¿æ¥ï¼š</span></p><ol start='' ><li><span>æŠ½è±¡å‡ºäº†è·å–å½“å‰è¿æ¥çš„éƒ¨åˆ†åˆ°å·¥å…·ç±»ï¼Œç”±äºè¦è¿›è¡Œäº‹åŠ¡çš„ç®¡ç†å¯¼è‡´è¿™éƒ¨åˆ†çš„ä»£ç éœ€è¦è¢«è§£è€¦ï¼›</span></li><li><span>è¿›è¡Œéç©ºåˆ¤æ–­ï¼Œä¸ä¸ºç©ºåˆ™ç›´æ¥è°ƒç”¨</span></li><li><span>ä¸ºç©ºåˆ™è·å–æ–°çš„è¿æ¥ï¼Œè®¾ç½®è‡ªåŠ¨æäº¤ä¸º trueï¼Œå¹¶ä¸”åœ¨æ‰§è¡Œ sql åå†æ¬¡çŸ«æ­£ã€‚</span></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.2px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// è·å–æ–°è¿æ¥:</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">try</span> (<span class="cm-variable">Connection</span> <span class="cm-variable">newConn</span> <span class="cm-operator">=</span> <span class="cm-variable">dataSource</span>.<span class="cm-variable">getConnection</span>()) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">final</span> <span class="cm-variable-3">boolean</span> <span class="cm-variable">autoCommit</span> <span class="cm-operator">=</span> <span class="cm-variable">newConn</span>.<span class="cm-variable">getAutoCommit</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-operator">!</span><span class="cm-variable">autoCommit</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">newConn</span>.<span class="cm-variable">setAutoCommit</span>(<span class="cm-atom">true</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">T</span> <span class="cm-variable">result</span> <span class="cm-operator">=</span> <span class="cm-variable">action</span>.<span class="cm-variable">doInConnection</span>(<span class="cm-variable">newConn</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-operator">!</span><span class="cm-variable">autoCommit</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">newConn</span>.<span class="cm-variable">setAutoCommit</span>(<span class="cm-atom">false</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">result</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  } <span class="cm-keyword">catch</span> (<span class="cm-variable">SQLException</span> <span class="cm-variable">e</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">throw</span> <span class="cm-keyword">new</span> <span class="cm-variable">DataAccessException</span>(<span class="cm-variable">e</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 314px;"></div><div class="CodeMirror-gutters" style="display: none; height: 314px;"></div></div></div></pre><p><span>åµŒå¥—å‰è€…çš„ executeï¼Œè¿™é‡Œä¸»è¦æ˜¯å›è°ƒæ¨¡å¼çš„åµŒå¥—ä½¿ç”¨ï¼Œæˆ‘ä»¬å°†åˆ›å»ºæ€æ ·çš„ </span><code>PreparedStatement</code><span> ï¼ˆ sql è¯­å¥å’Œå‚æ•°ï¼‰å’Œ æ‰§è¡Œ+ç»“æœå¤„ç† çš„ </span><code>PreparedStatementCallback</code><span> äº¤ç»™æ–¹æ³•çš„è°ƒç”¨ã€‚</span></p><p><span>æœ€å¤–å±‚çš„è°ƒç”¨ï¼š</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.2px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-meta">@SuppressWarnings</span>(<span class="cm-string">"unchecked"</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-operator">&lt;</span><span class="cm-variable">T</span><span class="cm-operator">&gt;</span> <span class="cm-variable">T</span> <span class="cm-def">queryForObject</span>(<span class="cm-variable-3">String</span> <span class="cm-variable">sql</span>, <span class="cm-variable">Class</span><span class="cm-operator">&lt;</span><span class="cm-variable">T</span><span class="cm-operator">&gt;</span> <span class="cm-variable">clazz</span>, <span class="cm-variable-3">Object</span>... <span class="cm-variable">args</span>) <span class="cm-keyword">throws</span> <span class="cm-variable">DataAccessException</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">clazz</span> <span class="cm-operator">==</span> <span class="cm-variable-3">String</span>.<span class="cm-keyword">class</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> (<span class="cm-variable">T</span>) <span class="cm-variable">queryForObject</span>(<span class="cm-variable">sql</span>, <span class="cm-variable">StringRowMapper</span>.<span class="cm-variable">instance</span>, <span class="cm-variable">args</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">clazz</span> <span class="cm-operator">==</span> <span class="cm-variable-3">Boolean</span>.<span class="cm-keyword">class</span> <span class="cm-operator">||</span> <span class="cm-variable">clazz</span> <span class="cm-operator">==</span> <span class="cm-variable-3">boolean</span>.<span class="cm-keyword">class</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> (<span class="cm-variable">T</span>) <span class="cm-variable">queryForObject</span>(<span class="cm-variable">sql</span>, <span class="cm-variable">BooleanRowMapper</span>.<span class="cm-variable">instance</span>, <span class="cm-variable">args</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// isPrimitiveå¤„ç†äº†Javaçš„åŸºæœ¬æ•°æ®ç±»å‹ï¼ˆå¦‚int, doubleç­‰ï¼‰ã€‚åŸºæœ¬ç±»å‹ä¸­çš„booleanå’Œcharå·²ç»è¢«å‰é¢å¤„ç†</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// åŸºæœ¬æ•°æ®ç±»å‹çš„åŒ…è£…ç±»ï¼ˆå¦‚Integer, Doubleï¼‰ç»§æ‰¿è‡ªNumberï¼Œè¿›è€Œç¡®ä¿äº†æ‰€æœ‰æ•°å­—ç±»å‹</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable-3">Number</span>.<span class="cm-keyword">class</span>.<span class="cm-variable">isAssignableFrom</span>(<span class="cm-variable">clazz</span>) <span class="cm-operator">||</span> <span class="cm-variable">clazz</span>.<span class="cm-variable">isPrimitive</span>()) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> (<span class="cm-variable">T</span>) <span class="cm-variable">queryForObject</span>(<span class="cm-variable">sql</span>, <span class="cm-variable">NumberRowMapper</span>.<span class="cm-variable">instance</span>, <span class="cm-variable">args</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">queryForObject</span>(<span class="cm-variable">sql</span>, <span class="cm-keyword">new</span> <span class="cm-variable">BeanRowMapper</span><span class="cm-operator">&lt;&gt;</span>(<span class="cm-variable">clazz</span>), <span class="cm-variable">args</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 336px;"></div><div class="CodeMirror-gutters" style="display: none; height: 336px;"></div></div></div></pre><p><span>è€Œä»–è°ƒç”¨çš„ </span><code>queryForObject</code><span>ï¼Œä¸‰ä¸ªå‚æ•°åˆ†åˆ«ä¸ºï¼šæ‰§è¡Œçš„sqlè¯­å¥ã€å°†ç»“æœè¡Œæ˜ å°„ä¸ºå¯¹è±¡çš„ </span><code>RowMapper</code><span> å¯¹è±¡ã€æŸ¥è¯¢å‚æ•°ã€‚ä½†å…·ä½“ä¸Šæ˜¯å¦‚ä½•å¤„ç† </span><code>RowMapper</code><span> å¯¹è±¡çš„ï¼Ÿ</span></p><p><span>åœ¨ </span><code>PreparedStatementCallback</code><span> çš„å®ç°ä¸­ä½¿ç”¨äº† </span><code>RowMapper</code><span> çš„è°ƒç”¨ï¼Œåœ¨å…·ä½“çš„æŸ¥è¯¢åè°ƒç”¨æ–¹æ³• </span><code>rowMapper.mapRow(rs, rs.getRow())</code><span>ï¼Œè¿™æ ·åœ¨ç»“æœå¤„ç†åè°ƒç”¨ </span><code>PreparedStatementCallback.doInPreparedStatement()</code><span> ï¼Œè€Œæˆ‘ä»¬ä¼ å…¥çš„åŒ¿åå‡½æ•°æ­£æ˜¯ä½œä¸ºè¿™ä¸ªæ–¹æ³•çš„å®ç°ã€‚</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.19971px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-operator">&lt;</span><span class="cm-variable">T</span><span class="cm-operator">&gt;</span> <span class="cm-variable">T</span> <span class="cm-def">queryForObject</span>(<span class="cm-variable-3">String</span> <span class="cm-variable">sql</span>, <span class="cm-variable">RowMapper</span><span class="cm-operator">&lt;</span><span class="cm-variable">T</span><span class="cm-operator">&gt;</span> <span class="cm-variable">rowMapper</span>, <span class="cm-variable-3">Object</span>... <span class="cm-variable">args</span>) <span class="cm-keyword">throws</span> <span class="cm-variable">DataAccessException</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">execute</span>(<span class="cm-variable">preparedStatementCreator</span>(<span class="cm-variable">sql</span>, <span class="cm-variable">args</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// PreparedStatementCallback</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  (<span class="cm-variable">PreparedStatement</span> <span class="cm-variable">ps</span>) <span class="cm-operator">-&gt;</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">T</span> <span class="cm-variable">t</span> <span class="cm-operator">=</span> <span class="cm-atom">null</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">try</span> (<span class="cm-variable">ResultSet</span> <span class="cm-variable">rs</span> <span class="cm-operator">=</span> <span class="cm-variable">ps</span>.<span class="cm-variable">executeQuery</span>()) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">while</span> (<span class="cm-variable">rs</span>.<span class="cm-variable">next</span>()) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">t</span> <span class="cm-operator">==</span> <span class="cm-atom">null</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">t</span> <span class="cm-operator">=</span> <span class="cm-variable">rowMapper</span>.<span class="cm-variable">mapRow</span>(<span class="cm-variable">rs</span>, <span class="cm-variable">rs</span>.<span class="cm-variable">getRow</span>());</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  } <span class="cm-keyword">else</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">throw</span> <span class="cm-keyword">new</span> <span class="cm-variable">DataAccessException</span>(<span class="cm-string">"Multiple rows found."</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">t</span> <span class="cm-operator">==</span> <span class="cm-atom">null</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">throw</span> <span class="cm-keyword">new</span> <span class="cm-variable">DataAccessException</span>(<span class="cm-string">"Empty result set."</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">t</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  });</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 470px;"></div><div class="CodeMirror-gutters" style="display: none; height: 470px;"></div></div></div></pre><p><span>å¯¹äºæ›´æ–°ï¼ˆåŒ…æ‹¬ sql çš„ updateã€deleteï¼‰éœ€è¦é¢å¤–å¤„ç†ï¼Œåœ¨æ›´æ–°åå°†ä¼šè¿”å›ä¸»é”®ï¼š</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.2px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable-3">Number</span> <span class="cm-def">updateAndReturnGeneratedKey</span>(<span class="cm-variable-3">String</span> <span class="cm-variable">sql</span>, <span class="cm-variable-3">Object</span>... <span class="cm-variable">args</span>) <span class="cm-keyword">throws</span> <span class="cm-variable">DataAccessException</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">execute</span>(</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// PreparedStatementCreator</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  (<span class="cm-variable">Connection</span> <span class="cm-variable">con</span>) <span class="cm-operator">-&gt;</span> {<span class="cm-tab" role="presentation" cm-text="	">   </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">// è¿”å›ç”Ÿæˆçš„keys</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">var</span> <span class="cm-variable">ps</span> <span class="cm-operator">=</span> <span class="cm-variable">con</span>.<span class="cm-variable">prepareStatement</span>(<span class="cm-variable">sql</span>, <span class="cm-variable">Statement</span>.<span class="cm-variable">RETURN_GENERATED_KEYS</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">bindArgs</span>(<span class="cm-variable">ps</span>, <span class="cm-variable">args</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">ps</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  },</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// PreparedStatementCallback</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  (<span class="cm-variable">PreparedStatement</span> <span class="cm-variable">ps</span>) <span class="cm-operator">-&gt;</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-3">int</span> <span class="cm-variable">n</span> <span class="cm-operator">=</span> <span class="cm-variable">ps</span>.<span class="cm-variable">executeUpdate</span>();<span class="cm-tab" role="presentation" cm-text="	"> </span><span class="cm-comment">// æ‰§è¡Œupdate</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">n</span> <span class="cm-operator">==</span> <span class="cm-number">0</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">throw</span> <span class="cm-keyword">new</span> <span class="cm-variable">DataAccessException</span>(<span class="cm-string">"0 rows inserted."</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">n</span> <span class="cm-operator">&gt;</span> <span class="cm-number">1</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">throw</span> <span class="cm-keyword">new</span> <span class="cm-variable">DataAccessException</span>(<span class="cm-string">"Multiple rows inserted."</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">try</span> (<span class="cm-variable">ResultSet</span> <span class="cm-variable">keys</span> <span class="cm-operator">=</span> <span class="cm-variable">ps</span>.<span class="cm-variable">getGeneratedKeys</span>()) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">while</span> (<span class="cm-variable">keys</span>.<span class="cm-variable">next</span>()) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> (<span class="cm-variable-3">Number</span>) <span class="cm-variable">keys</span>.<span class="cm-variable">getObject</span>(<span class="cm-number">1</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">throw</span> <span class="cm-keyword">new</span> <span class="cm-variable">DataAccessException</span>(<span class="cm-string">"Should not reach here."</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  });</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 560px;"></div><div class="CodeMirror-gutters" style="display: none; height: 560px;"></div></div></div></pre><h2 id='transaction'><span>Transaction</span></h2><p><span>é¦–å…ˆåˆ›å»º </span><code>BeanPostProcessor</code><span>ï¼Œè¦æ±‚è¢« </span><code>@Transactional</code><span> æ³¨é‡Šçš„ç»„ä»¶è¢«ä»£ç†ã€‚</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.2px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">class</span> <span class="cm-def">TransactionalBeanPostProcessor</span> <span class="cm-keyword">extends</span> <span class="cm-variable">AnnotationProxyBeanPostProcessor</span><span class="cm-operator">&lt;</span><span class="cm-variable">Transactional</span><span class="cm-operator">&gt;</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>å…¶æ¬¡ï¼Œéœ€è¦æ³¨æ„åˆ°åœ¨æœ€å¼€å§‹æ—¶æˆ‘ä»¬å°±é€šè¿‡äº‹åŠ¡çš„å·¥å…·ç±»è·å–åˆ°é“¾æ¥ </span><code>TransactionalUtils.getCurrentConnection()</code><span>ï¼Œåœ¨è¿™ä¸ªæ–¹æ³•ä¼š åˆ¤æ–­ </span><code>DataSourceTransactionManager</code><span> çš„å±æ€§â€”â€”æ•°æ®åº“è¿æ¥ æ˜¯å¦ä¸ºç©ºï¼Œä¸ä¸ºç©ºåˆ™è·å–å…¶è¿æ¥ã€‚</span></p><p><span>è€Œåœ¨ </span><code>DataSourceTransactionManager</code><span> ä¸­ï¼Œæˆ‘ä»¬å®ç°äº† </span><code>InvocationHandler</code><span> æ¥å£ï¼Œå®šä¹‰å½“äº‹åŠ¡å¼€å¯æ—¶çš„å¤„ç†å’Œè°ƒç”¨ã€‚è¿™é‡Œéœ€è¦æ³¨æ„ä¸äº‹åŠ¡â€œå…³è”â€çš„çº¿ç¨‹å¤„ç†ï¼Œå…¶ä»–çš„å°±æ˜¯å¸¸è§„çš„å¼‚å¸¸å¤„ç†ã€æäº¤è®¾ç½®äº†ã€‚</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.2px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable-3">Object</span> <span class="cm-def">invoke</span>(<span class="cm-variable-3">Object</span> <span class="cm-variable">proxy</span>, <span class="cm-variable">Method</span> <span class="cm-variable">method</span>, <span class="cm-variable-3">Object</span>[] <span class="cm-variable">args</span>) <span class="cm-keyword">throws</span> <span class="cm-variable">Throwable</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">TransactionStatus</span> <span class="cm-variable">ts</span> <span class="cm-operator">=</span> <span class="cm-variable">transactionStatus</span>.<span class="cm-variable">get</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">ts</span> <span class="cm-operator">==</span> <span class="cm-atom">null</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// å¦‚æœæ— äº‹åŠ¡ï¼Œåˆ™å¼€å¯äº‹åŠ¡</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">try</span> (<span class="cm-variable">Connection</span> <span class="cm-variable">connection</span> <span class="cm-operator">=</span> <span class="cm-variable">dataSource</span>.<span class="cm-variable">getConnection</span>()) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">final</span> <span class="cm-variable-3">boolean</span> <span class="cm-variable">autoCommit</span> <span class="cm-operator">=</span> <span class="cm-variable">connection</span>.<span class="cm-variable">getAutoCommit</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">autoCommit</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">connection</span>.<span class="cm-variable">setAutoCommit</span>(<span class="cm-atom">false</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">try</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// è®¾ç½®äº‹åŠ¡çŠ¶æ€å¹¶è°ƒç”¨ä¸šåŠ¡æ–¹æ³•</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">transactionStatus</span>.<span class="cm-variable">set</span>(<span class="cm-keyword">new</span> <span class="cm-variable">TransactionStatus</span>(<span class="cm-variable">connection</span>));</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-3">Object</span> <span class="cm-variable">res</span> <span class="cm-operator">=</span> <span class="cm-variable">method</span>.<span class="cm-variable">invoke</span>(<span class="cm-variable">proxy</span>, <span class="cm-variable">args</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">connection</span>.<span class="cm-variable">commit</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">res</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  } <span class="cm-keyword">catch</span> (<span class="cm-variable">InvocationTargetException</span> <span class="cm-variable">e</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">logger</span>.<span class="cm-variable">warn</span>(<span class="cm-string">"will rollback transaction for caused exception: {}"</span>, <span class="cm-variable">e</span>.<span class="cm-variable">getCause</span>() <span class="cm-operator">==</span> <span class="cm-atom">null</span> <span class="cm-operator">?</span> <span class="cm-string">"null"</span> : <span class="cm-variable">e</span>.<span class="cm-variable">getCause</span>().<span class="cm-variable">getClass</span>().<span class="cm-variable">getName</span>());</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">var</span> <span class="cm-variable">te</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">TransactionException</span>(<span class="cm-variable">e</span>.<span class="cm-variable">getCause</span>());</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">try</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">connection</span>.<span class="cm-variable">rollback</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  } <span class="cm-keyword">catch</span> (<span class="cm-variable">SQLException</span> <span class="cm-variable">sqle</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">te</span>.<span class="cm-variable">addSuppressed</span>(<span class="cm-variable">sqle</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">throw</span> <span class="cm-variable">te</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  } <span class="cm-keyword">finally</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// ç§»é™¤çº¿ç¨‹å˜é‡ï¼Œå¹¶æ¢å¤è¿æ¥çš„æäº¤é»˜è®¤çŠ¶æ€</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">transactionStatus</span>.<span class="cm-variable">remove</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">autoCommit</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">connection</span>.<span class="cm-variable">setAutoCommit</span>(<span class="cm-atom">true</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  } <span class="cm-keyword">else</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">method</span>.<span class="cm-variable">invoke</span>(<span class="cm-variable">proxy</span>, <span class="cm-variable">args</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 851px;"></div><div class="CodeMirror-gutters" style="display: none; height: 851px;"></div></div></div></pre><p>&nbsp;</p><h1 id='----web-mvc----'><span>â€” Web MVC â€”</span></h1><p><span>è¿™é‡Œæ”¯æŒ spring çš„ </span><code>DispatcherServlet</code><span>ã€</span><code>@Controller</code><span>ã€</span><code>@RestController</code><span> å’Œ </span><code>ViewResolver</code></p><p><span>åœ¨è¿™é‡Œæˆ‘ä»¬éœ€è¦å…ˆæ¢³ç†Java Webåº”ç”¨å¦‚ä½•å¤„ç†è¯·æ±‚ï¼Œä¸€å¥è¯çš„æ¦‚æ‹¬å°±æ˜¯é€šè¿‡servletã€‚è€ŒServletæ ‡å‡†å‘Šè¯‰æˆ‘ä»¬éœ€è¦æŒ‰æ¥å£ç¼–å†™å“ªäº›ç»„ä»¶ï¼šServletã€Filterå’ŒListenerï¼›ä¹Ÿè§„å®šäº†ä¸€ä¸ªæœåŠ¡å™¨ï¼ˆå¦‚Tomcatã€Jettyã€JBossç­‰ï¼‰åº”è¯¥æä¾›ä»€ä¹ˆæ ·çš„æœåŠ¡ï¼ŒæŒ‰ä»€ä¹ˆé¡ºåºåŠ è½½åº”ç”¨ç¨‹åºçš„ç»„ä»¶ï¼Œæœ€åæ‰èƒ½è·‘èµ·æ¥å¤„ç†æ¥è‡ªç”¨æˆ·çš„HTTPè¯·æ±‚ã€‚</span></p><ul><li><span>Servletï¼šå¤„ç†HTTPè¯·æ±‚ï¼Œç„¶åè¾“å‡ºå“åº”ï¼›</span></li><li><span>Filterï¼šå¯¹HTTPè¯·æ±‚è¿›è¡Œè¿‡æ»¤ï¼Œå¯ä»¥æœ‰å¤šä¸ªFilterå½¢æˆè¿‡æ»¤å™¨é“¾ï¼Œå®ç°æƒé™æ£€æŸ¥ã€é™æµã€ç¼“å­˜ç­‰é€»è¾‘ï¼›</span></li><li><span>Listenerï¼šç”¨æ¥ç›‘å¬Webåº”ç”¨ç¨‹åºäº§ç”Ÿçš„äº‹ä»¶ï¼ŒåŒ…æ‹¬å¯åŠ¨ã€åœæ­¢ã€Sessionæœ‰ä¿®æ”¹ç­‰ã€‚</span></li></ul><p><span>è€Œè¿™äº›éƒ½è¢« </span><code>Servlet Container</code><span> å®¹å™¨ç®¡ç†ï¼Œéœ€è¦æ³¨æ„è¿™äº›ç»„ä»¶çš„ç®¡ç†ï¼Œåˆ›å»ºäºé”€æ¯ã€‚ä½† spring æœ¬èº«çš„ IOC å®¹å™¨æ€ä¹ˆå¤„ç†å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ï¼š</span></p><p><span>å¯¹äºä¸€ä¸ªWebåº”ç”¨ç¨‹åºæ¥è¯´ï¼Œå¯åŠ¨æ—¶ï¼Œåº”ç”¨ç¨‹åºæœ¬èº«åªæ˜¯ä¸€ä¸ª</span><code>war</code><span>åŒ…ï¼Œå¹¶æ²¡æœ‰</span><code>main()</code><span>æ–¹æ³•ï¼Œå› æ­¤ï¼Œå¯åŠ¨æ—¶æ‰§è¡Œçš„æ˜¯Serverçš„</span><code>main()</code><span>æ–¹æ³•ã€‚ä»¥TomcatæœåŠ¡å™¨ä¸ºä¾‹ï¼š</span></p><ol start='' ><li><p><span>å¯åŠ¨æœåŠ¡å™¨ï¼Œå³æ‰§è¡ŒTomcatçš„</span><code>main()</code><span>æ–¹æ³•ï¼›</span></p></li><li><p><span>Tomcatæ ¹æ®é…ç½®æˆ–è‡ªåŠ¨æ£€æµ‹åˆ°ä¸€ä¸ª</span><code>xyz.war</code><span>åŒ…åï¼Œä¸ºè¿™ä¸ª</span><code>xyz.war</code><span>åº”ç”¨ç¨‹åºåˆ›å»ºServletå®¹å™¨ï¼›</span></p></li><li><p><span>Tomcatç»§ç»­æŸ¥æ‰¾</span><code>xyz.war</code><span>å®šä¹‰çš„Servletã€Filterå’ŒListenerç»„ä»¶ï¼ŒæŒ‰é¡ºåºå®ä¾‹åŒ–æ¯ä¸ªç»„ä»¶ï¼ˆListeneræœ€å…ˆè¢«å®ä¾‹åŒ–ï¼Œç„¶åæ˜¯Filterï¼Œæœ€åæ˜¯Servletï¼‰ï¼›</span></p><p><span>åœ¨è¿™é‡Œè¿›è¡Œäº† IOC å®¹å™¨çš„åˆå§‹åŒ–ã€‚IOCçš„é…ç½®é»˜è®¤æ¥è‡ª classpath çš„ </span><code>application.yml</code><span> æˆ– </span><code>application.properties</code></p></li><li><p><span>ç”¨æˆ·å‘é€HTTPè¯·æ±‚ï¼ŒTomcatæ”¶åˆ°è¯·æ±‚åï¼Œè½¬å‘ç»™Servletå®¹å™¨ï¼Œå®¹å™¨æ ¹æ®åº”ç”¨ç¨‹åºå®šä¹‰çš„æ˜ å°„ï¼ŒæŠŠè¯·æ±‚å‘é€ä¸ªè‹¥å¹²Filterå’Œä¸€ä¸ªServletå¤„ç†ï¼›</span></p></li><li><p><span>å¤„ç†æœŸé—´äº§ç”Ÿçš„äº‹ä»¶åˆ™ç”±Servletå®¹å™¨è‡ªåŠ¨è°ƒç”¨Listenerã€‚</span></p></li></ol><p><span>åœ¨</span><code>ContextLoaderListener</code><span>çš„</span><code>contextInitialized()</code><span>æ–¹æ³•å†…ï¼Œå…ˆè·å–</span><code>ServletContext</code><span>å¼•ç”¨ï¼Œå†é€šè¿‡</span><code>getInitParameter(&quot;configuration&quot;)</code><span>æ‹¿åˆ°å®Œæ•´ç±»åï¼Œå°±å¯ä»¥é¡ºåˆ©åˆ›å»ºIoCå®¹å™¨äº†ã€‚</span></p><p><span>ç”¨Mavenæ‰“åŒ…åï¼ŒæŠŠç”Ÿæˆçš„</span><code>xyz.war</code><span>æ”¹ä¸º</span><code>ROOT.war</code><span>ï¼Œå¤åˆ¶åˆ°Tomcatçš„</span><code>webapps</code><span>ç›®å½•ä¸‹ï¼Œæ¸…é™¤æ‰å…¶ä»–webappï¼Œå¯åŠ¨Tomcatï¼Œè¾“å…¥</span><code>http://localhost:8080</code><span>å¯çœ‹åˆ°è¾“å‡º</span><code>Hello, world!</code><span>ã€‚</span></p><h1 id='å¯åŠ¨'><span>å¯åŠ¨</span></h1><p><strong><span>ContextLoaderListener</span></strong><span>ï¼šåœ¨Webåº”ç”¨å¯åŠ¨æ—¶è¢«è°ƒç”¨ï¼Œè´Ÿè´£åŠ è½½ spring çš„åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ï¼ˆ </span><code>ApplicationContext</code><span> ï¼‰ã€‚</span></p><p><strong><span>DispatcherServlet</span></strong><span>ï¼šå°†æ¥æ”¶åˆ°çš„HTTPè¯·æ±‚è½¬å‘åˆ°ç›¸åº”çš„å¤„ç†å™¨ï¼ˆ</span><code>Controller</code><span>ï¼‰ã€‚å®ƒé€šè¿‡æŸ¥æ‰¾ä¸è¯·æ±‚ç›¸åŒ¹é…çš„æ§åˆ¶å™¨æ–¹æ³•ï¼Œå¹¶è°ƒç”¨è¯¥æ–¹æ³•æ¥å¤„ç†è¯·æ±‚ã€‚</span></p><p><span>é‡å†™ </span><code>contextInitialized</code><span> å®Œæˆåˆå§‹åŒ–ï¼š</span></p><ul><li><p><span>åˆ›å»º </span><code>PropertyResolver</code><span> è¯»å– yml é…ç½®</span></p></li><li><p><span>åˆ›å»ºå±æ€§è§£æå™¨ï¼Œé…ç½®è¯·æ±‚ã€å“åº”çš„ç¼–ç æ–¹å¼</span></p></li><li><p><span>åˆ›å»º spring ä¸Šä¸‹æ–‡ ï¼ˆ </span><code>ApplicationContext</code><span> ï¼‰ï¼Œå°† Spring çš„åº”ç”¨ä¸Šä¸‹æ–‡å­˜å‚¨ä¸ºä¸€ä¸ªå…¨å±€å±æ€§</span></p><p><span>è¿™é‡Œè·å– web.xml ä¸­çš„ configurationï¼Œç„¶åé€šè¿‡å®Œæ•´ç±»åæ¥æ‰¾åˆ° </span><code>ApplicationContext</code></p></li><li><p><span>æ³¨å†Œ </span><code>DispatcherServlet</code><span> å¹¶æ·»åŠ åˆ° servletContext ä¸­</span></p><p><span>å…ˆä½¿ç”¨springçš„åº”ç”¨ä¸Šä¸‹æ–‡å’Œé…ç½®æ¥åˆå§‹åŒ–åˆ›å»º  </span><code>DispatcherServlet</code><span>ï¼Œå°†å…¶æ·»åŠ åˆ° </span><code>ServletContext</code><span> ä¸­</span></p></li></ul><h1 id='è¯·æ±‚å¤„ç†'><span>è¯·æ±‚å¤„ç†</span></h1><p><span>åœ¨æ•´ä¸ªHTTPå¤„ç†æµç¨‹ä¸­ï¼Œå…¥å£æ˜¯</span><code>DispatcherServlet</code><span>çš„</span><code>service()</code><span>æ–¹æ³•ï¼Œæ•´ä¸ªæµç¨‹å¦‚ä¸‹ï¼š</span></p><ol start='' ><li><p><span>Servletå®¹å™¨è°ƒç”¨</span><code>DispatcherServlet</code><span>çš„</span><code>service()</code><span>æ–¹æ³•å¤„ç†HTTPè¯·æ±‚ï¼›</span></p></li><li><p><code>service()</code><span>æ ¹æ®GETæˆ–POSTè°ƒç”¨</span><code>doGet()</code><span>æˆ–</span><code>doPost()</code><span>æ–¹æ³•ï¼›</span></p></li><li><p><span>æ ¹æ®URLä¾æ¬¡åŒ¹é…</span><code>Dispatcher</code><span>ï¼ŒåŒ¹é…åè°ƒç”¨</span><code>process()</code><span>æ–¹æ³•ï¼Œè·å¾—è¿”å›å€¼ï¼›</span></p></li><li><p><span>æ ¹æ®è¿”å›å€¼å†™å…¥å“åº”ï¼š</span></p><ol start='' ><li><span>voidæˆ–nullè¿”å›å€¼æ— éœ€å†™å…¥å“åº”ï¼›</span></li><li><span>Stringæˆ–byte[]è¿”å›å€¼ç›´æ¥å†™å…¥å“åº”ï¼ˆæˆ–é‡å®šå‘ï¼‰ï¼›</span></li><li><span>RESTç±»å‹å†™å…¥JSONåºåˆ—åŒ–ç»“æœï¼›</span></li><li><span>ModelAndViewç±»å‹è°ƒç”¨ViewResolverå†™å…¥æ¸²æŸ“ç»“æœã€‚</span></li></ol></li><li><p><span>æœªåŒ¹é…åˆ°åˆ¤æ–­æ˜¯å¦é™æ€èµ„æºï¼š</span></p><ol start='' ><li><span>ç¬¦åˆé™æ€ç›®å½•ï¼ˆé»˜è®¤</span><code>/static/</code><span>ï¼‰åˆ™è¯»å–æ–‡ä»¶ï¼Œå†™å…¥æ–‡ä»¶å†…å®¹ï¼›</span></li><li><span>ç½‘ç«™å›¾æ ‡ï¼ˆé»˜è®¤</span><code>/favicon.ico</code><span>ï¼‰åˆ™è¯»å–</span><code>.ico</code><span>æ–‡ä»¶ï¼Œå†™å…¥æ–‡ä»¶å†…å®¹ï¼›</span></li></ol></li><li><p><span>å…¶ä»–æƒ…å†µè¿”å›404ã€‚</span></p></li></ol><p><code>DispatcherServlet</code><span>å†…éƒ¨è´Ÿè´£ä»IoCå®¹å™¨æ‰¾åˆ°å¤„ç†è¯·æ±‚çš„beanï¼Œå³è¢« @Controllerã€@RestController æ ‡è®°çš„Beanï¼Œè€Œä¸”éœ€è¦å¾—åˆ°å¤„ç†çš„è·¯ç”±å’Œæ–¹æ³•ç±»å‹ç­‰ç­‰ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¿™äº›ä¿¡æ¯æ•´ç†ä¸ºurlå¤„ç†å™¨ </span><code>Dispatcher</code><span> ï¼š</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.2px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-def">Dispatcher</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// æ˜¯å¦è¿”å›REST:</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-3">boolean</span> <span class="cm-variable">isRest</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// æ˜¯å¦æœ‰@ResponseBody:</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-3">boolean</span> <span class="cm-variable">isResponseBody</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// æ˜¯å¦è¿”å›void:</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-3">boolean</span> <span class="cm-variable">isVoid</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// URLæ­£åˆ™åŒ¹é…:</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">Pattern</span> <span class="cm-variable">urlPattern</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// Beanå®ä¾‹:</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-3">Object</span> <span class="cm-variable">controller</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// å¤„ç†æ–¹æ³•:</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">Method</span> <span class="cm-variable">handlerMethod</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// æ–¹æ³•å‚æ•°:</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">Param</span>[] <span class="cm-variable">methodParameters</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 358px;"></div><div class="CodeMirror-gutters" style="display: none; height: 358px;"></div></div></div></pre><p><span>å¯¹äºå•ä¸ª Param æœ‰ï¼š</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.2px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-def">Param</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// å‚æ•°åç§°:</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-3">String</span> <span class="cm-variable">name</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// å‚æ•°ç±»å‹:</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">ParamType</span> <span class="cm-variable">paramType</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// å‚æ•°Classç±»å‹:</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">Class</span><span class="cm-operator">&lt;?&gt;</span> <span class="cm-variable">classType</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// å‚æ•°é»˜è®¤å€¼</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-3">String</span> <span class="cm-variable">defaultValue</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 224px;"></div><div class="CodeMirror-gutters" style="display: none; height: 224px;"></div></div></div></pre><p><span>å‚æ•°ç±»å‹æœ‰ï¼Œè®¾ç½®ä¸ºæšä¸¾ç±»ï¼š</span></p><ul><li><code>PATH_VARIABLE</code><span>ï¼šè·¯å¾„å‚æ•°ï¼Œä»URLä¸­æå–ï¼›</span></li><li><code>REQUEST_PARAM</code><span>ï¼šURLå‚æ•°ï¼Œä»URL Queryæˆ–Formè¡¨å•æå–ï¼›</span></li><li><code>REQUEST_BODY</code><span>ï¼šRESTè¯·æ±‚å‚æ•°ï¼Œä»Postä¼ é€’çš„JSONæå–ï¼›</span></li><li><code>SERVLET_VARIABLE</code><span>ï¼š</span><code>HttpServletRequest</code><span>ç­‰Servlet APIæä¾›çš„å‚æ•°ï¼Œç›´æ¥ä»</span><code>DispatcherServlet</code><span>çš„æ–¹æ³•å‚æ•°è·å¾—ã€‚</span></li></ul><p><span>åé¢å½“è¯·æ±‚æ¥ä¸´æ—¶åŒ¹é… URLï¼Œè½¬å‘åˆ°å¯¹åº”çš„beanä¸­å¤„ç†ï¼Œ</span><code>Dispatcher</code><span>å¤„ç†åè¿”å›ç±»å‹åŒ…æ‹¬ï¼š</span></p><ul><li><code>void</code><span>æˆ–</span><code>null</code><span>ï¼šè¡¨ç¤ºå†…éƒ¨å·²å¤„ç†å®Œæ¯•ï¼›</span></li><li><code>String</code><span>ï¼šå¦‚æœä»¥</span><code>redirect:</code><span>å¼€å¤´ï¼Œåˆ™è¡¨ç¤ºä¸€ä¸ªé‡å®šå‘ï¼›</span></li><li><code>String</code><span>æˆ–</span><code>byte[]</code><span>ï¼šå¦‚æœé…åˆ</span><code>@ResponseBody</code><span>ï¼Œåˆ™è¡¨ç¤ºè¿”å›å€¼ç›´æ¥å†™å…¥å“åº”ï¼›</span></li><li><code>ModelAndView</code><span>ï¼šè¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªMVCå“åº”ï¼ŒåŒ…å«Modelå’ŒViewåç§°ï¼Œåç»­ç”¨æ¨¡æ¿å¼•æ“å¤„ç†åå†™å…¥å“åº”ï¼›</span></li><li><span>å…¶å®ƒç±»å‹ï¼šå¦‚æœæ˜¯</span><code>@RestController</code><span>ï¼Œåˆ™åºåˆ—åŒ–ä¸ºJSONåå†™å…¥å“åº”ã€‚</span></li></ul><p><span>ä¸ç¬¦åˆä¸Šè¿°è¦æ±‚çš„è¿”å›ç±»å‹åˆ™æŠ¥500é”™è¯¯ã€‚</span></p><p>&nbsp;</p><p><code>@RestController</code><span> å’Œ </span><code>@Controller</code><span> éƒ½æ˜¯Spring MVCæ¡†æ¶ä¸­ç”¨äºå®šä¹‰æ§åˆ¶å™¨ï¼ˆControllerï¼‰çš„æ³¨è§£ï¼Œä½†å®ƒä»¬çš„ç”¨é€”å’Œè¡Œä¸ºæœ‰æ‰€ä¸åŒï¼š</span></p><ol start='' ><li><p><strong><span>@Controller</span></strong><span>:</span></p><ul><li><code>@Controller</code><span> æ˜¯ä¸€ä¸ªç±»çº§åˆ«çš„æ³¨è§£ï¼Œç”¨äºå®šä¹‰ä¸€ä¸ªæ§åˆ¶å™¨ç±»ï¼Œè¯¥ç±»åŒ…å«å¤„ç†HTTPè¯·æ±‚çš„æ–¹æ³•ã€‚</span></li><li><span>å®ƒä¸»è¦ç”¨äºå¤„ç†æœåŠ¡å™¨ç«¯è¯·æ±‚å¹¶è¿”å›å“åº”è§†å›¾ï¼ˆViewï¼‰ï¼Œé€šå¸¸ä¸è§†å›¾è§£æå™¨ï¼ˆViewResolverï¼‰ä¸€èµ·å·¥ä½œï¼Œå°†è¿”å›çš„è§†å›¾åè§£æä¸ºå…·ä½“çš„é¡µé¢ã€‚</span></li><li><code>@Controller</code><span> é€šå¸¸ä¸ </span><code>@RequestMapping</code><span> æˆ–å…¶æ´¾ç”Ÿæ³¨è§£ï¼ˆå¦‚ </span><code>@GetMapping</code><span>, </span><code>@PostMapping</code><span> ç­‰ï¼‰ä¸€èµ·ä½¿ç”¨ï¼Œä»¥æ˜ å°„HTTPè¯·æ±‚åˆ°ç‰¹å®šçš„å¤„ç†æ–¹æ³•ã€‚</span></li><li><span>å½“ä½¿ç”¨ </span><code>@Controller</code><span> æ—¶ï¼Œè¿”å›çš„å­—ç¬¦ä¸²é€šå¸¸è¢«è§†ä¸ºè§†å›¾çš„åç§°ï¼Œè€Œä¸æ˜¯ç›´æ¥å†™å…¥HTTPå“åº”ä½“ã€‚</span></li></ul></li><li><p><strong><span>@RestController</span></strong><span>:</span></p><ul><li><code>@RestController</code><span> ä¹Ÿæ˜¯ç±»çº§åˆ«çš„æ³¨è§£ï¼Œå®ƒæ˜¯ </span><code>@Controller</code><span> å’Œ </span><code>@ResponseBody</code><span> æ³¨è§£çš„ç»„åˆã€‚</span></li><li><span>ä½¿ç”¨ </span><code>@RestController</code><span> æ ‡æ³¨çš„ç±»ä¸­çš„æ–¹æ³•ï¼Œå…¶è¿”å›å€¼é€šå¸¸ç›´æ¥å†™å…¥HTTPå“åº”ä½“ä¸­ï¼Œè€Œä¸æ˜¯è¿”å›ä¸€ä¸ªè§†å›¾åç§°ã€‚</span></li><li><span>è¿™é€šå¸¸ç”¨äºåˆ›å»ºRESTful WebæœåŠ¡ï¼Œå…¶ä¸­JSONæˆ–XMLç­‰æ•°æ®æ ¼å¼ç›´æ¥ä½œä¸ºå“åº”ä½“è¿”å›ã€‚</span></li><li><code>@RestController</code><span> é€‚ç”¨äºé‚£äº›ä¸éœ€è¦ä¾èµ–è§†å›¾è§£æå™¨çš„æ§åˆ¶å™¨ï¼Œè€Œæ˜¯éœ€è¦ç›´æ¥è¿”å›æ•°æ®çš„æƒ…å†µã€‚</span></li></ul></li></ol><p>&nbsp;</p><h1 id='deploy'><span>Deploy</span></h1><p><span>åŸºæœ¬çš„ </span><code>settings.xml</code><span>ã€</span><code>pom.xml</code><span> è¿™é‡Œå°±ä¸å¤šå†™äº†ï¼Œå‚è€ƒæ–‡ç« æ”¾åœ¨åé¢ï¼Œä½†éœ€è¦æ³¨æ„çš„æ˜¯ </span><code>gpg</code><span> ç”Ÿæˆ key çš„æ—¶å€™ä½¿ç”¨çš„ userName æ˜¯ </span><strong><span>å‘½åç©ºé—´</span></strong><span>ï¼Œçœ‹åˆ°çš„æ•™ç¨‹å¾ˆå¤šçš„ç›´æ¥çš„ä½¿ç”¨äº†ç”¨æˆ·åï¼Œä¸ç¡®å®šä»–ä»¬æ˜¯å¦åˆ›å»ºäº†åŒåçš„å‘½åç©ºé—´ï¼Œä½†æˆ‘ä¸ªäººçš„å®è·µä¸­ï¼Œè¢«ä½¿ç”¨çš„æ˜¯å‘½åç©ºé—´ã€‚</span></p><h2 id='1åå°„-æ— æ³•å¤„ç†-private-å±æ€§'><span>1ã€åå°„-æ— æ³•å¤„ç† private å±æ€§</span></h2><p><span>Unable to make field private final java.util.Comparator java.util.TreeMap.comparator accessible: module java.base does not &quot;opens java.util&quot; to unnamed module @1704f67f</span></p><p><span>è§£å†³æ–¹å¼ï¼š</span></p><ol start='' ><li><span>æ›´æ–°ä¾èµ–åˆ°æœ€æ–°ç‰ˆæœ¬</span></li><li><span>ä¿®æ”¹ JDK ä¸ºç‰ˆæœ¬ 11/8 </span></li></ol><p><span>åé¢ä¸€ä¸ªæ–¹æ³•æ˜¯æœ‰æ•ˆçš„ï¼Œä½†æ˜¯æ•´ä¸ªé¡¹ç›®æ²¡æ³•é€šè¿‡ç‰ˆæœ¬11çš„ç¼–è¯‘ã€‚å¾ˆå–œæ¬¢çš„è¯­æ³• </span><code>if x instance of XX x1</code><span> åœ¨è¿™ä¸ªé¡¹ç›®ä¸­ç”¨åˆ°äº†å¾ˆå¤šï¼Œè€Œè¿™ä¸ªè¯­æ³•è¦æ±‚16åŠä»¥ä¸Šï¼Œæ›´åˆ«è¯´æµ‹è¯•æ–‡ä»¶ä¸­çš„äº†ã€‚</span></p><h2 id='2401---unauthorized'><span>2ã€401 - Unauthorized</span></h2><p><span>æ‰§è¡Œ </span><code>mvn clean deploy -P sonatype -X</code><span> æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯</span></p><ol start='' ><li><p><span>ä¸é€šè¿‡è‡ªåŠ¨åŒ–éƒ¨ç½²ï¼Œä½¿ç”¨ </span><code>curl</code></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.2px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">curl -u yourusername:yourpassword \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  https://your-nexus-instance.com/nexus/content/repositories/your-repo-id/com/juvenxu/your-artifactid/1.0.0/your-artifactid-1.0.0.pom \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  --request PUT --data @path/to/your-artifactid-1.0.0.pom</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 90px;"></div><div class="CodeMirror-gutters" style="display: none; height: 90px;"></div></div></div></pre><p><span>åœ¨è¿™ä¸ªå‘½ä»¤ä¸­ï¼š</span></p><ul><li><span>æ›¿æ¢ </span><code>yourusername:yourpassword</code><span> ä¸ºä½ çš„ Nexus ä»“åº“çš„ç”¨æˆ·åå’Œå¯†ç ã€‚</span></li><li><span>æ›¿æ¢ </span><code>https://your-nexus-instance.com/nexus/content/repositories/your-repo-id/</code><span> ä¸º Nexus ä»“åº“çš„å®é™… URLã€‚</span></li><li><span>æ›¿æ¢ </span><code>com/juvenxu</code><span> ä¸ºå®é™…çš„ Group IDï¼Œå…¶ä¸­çš„ç‚¹ï¼ˆ</span><code>.</code><span>ï¼‰å·²ç»è¢«è½¬æ¢ä¸ºæ–œæ ï¼ˆ</span><code>/</code><span>ï¼‰ã€‚</span></li><li><span>æ›¿æ¢ </span><code>your-artifactid</code><span> å’Œ </span><code>1.0.0</code><span> ä¸ºå®é™…çš„ Artifact ID å’Œç‰ˆæœ¬å·ã€‚</span></li><li><span>æ›¿æ¢ </span><code>path/to/your-artifactid-1.0.0.pom</code><span> ä¸ºæœ¬åœ° POM æ–‡ä»¶çš„è·¯å¾„ã€‚</span></li></ul></li><li><p><span>ä¿è¯ pom å’Œ settings.xml ä¸­çš„ id å¯¹åº”ã€æ£€æŸ¥userTokenç­‰ã€‚ã€‚ã€‚</span></p></li></ol><h2 id='3èµ„æ–™æ”¶å½•'><span>3ã€èµ„æ–™æ”¶å½•</span></h2><ol start='' ><li><a href='https://central.sonatype.com/'><span>sonatypeå®˜ç½‘</span></a></li><li><a href='https://www.sonatype.com/blog/2010/11/what-to-do-when-sonatype-nexus-returns-401'><span>401 - Unauthorized å®˜æ–¹çš„WhatToDo</span></a></li><li><a href='https://stackoverflow.com/questions/24830610/why-am-i-getting-a-401-unauthorized-error-in-maven'><span>stackoverflowçš„æé—®ï¼ˆå‘½ä»¤è¡Œå‘å¸ƒæˆåŠŸä½†æ˜¯è„šæœ¬å‘å¸ƒå¤±è´¥ï¼‰</span></a></li><li><a href='https://www.zhaowenyu.com/maven-doc/maven-deploy.html'><span>sonatypeå‘å¸ƒ ç›¸å½“å®Œæ•´ä¸”å¸ƒå±€èˆ’æœçš„ä¸­æ–‡æ•™ç¨‹</span></a></li><li><a href='https://blog.csdn.net/csdnerM/article/details/136784455'><span>sonatypeå‘å¸ƒ æœ€ç»†è‡´å¹¶ä¸”æ˜¯</span><strong><span>æœ€æ–°</span></strong><span>çš„ä¸­æ–‡æ•™ç¨‹</span></a></li><li><a href='https://www.liaoxuefeng.com/wiki/1252599548343744/1347981037010977'><span>å¤šç§å‘å¸ƒæ–¹å¼æåŠä¸”æ­¥éª¤è¯¦ç»†çš„ä¸­æ–‡æ•™ç¨‹</span></a><span> ï¼ˆç»è¿‡å°è¯•å‘ç°GitHub Pages ä¸å¯ç”¨ï¼‰</span></li></ol><hr /><p><span>åœ¨è¿›è¡Œèµ„æ–™æ”¶å½•çš„è¿‡ç¨‹ä¸­ï¼Œå¹¶ä¸”åœ¨å‰é¢å¾ˆå¤šæ¬¡çš„å°è¯•ä¸­æ„è¯†åˆ°æ„å»ºä½¿ç”¨çš„æ’ä»¶æ˜¯å½±å“æŠ¥é”™çš„é‡è¦å› ç´ ï¼Œäºæ˜¯å†æ¬¡å°è¯•äº†ä¸Šé¢æ•´ç†çš„ç¬¬äº”ç¯‡æ•™ç¨‹ï¼Œä¿®æ”¹é¡¹ç›®çš„buildä¸ºä¸‹é¢çš„å†…å®¹</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="xml" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="xml"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.2px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><span><span>â€‹</span>x</span></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">build</span><span class="cm-tag cm-bracket">&gt;</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">plugins</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">&lt;!-- &nbsp; centralå‘å¸ƒæ’ä»¶ &nbsp;  --&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">plugin</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">groupId</span><span class="cm-tag cm-bracket">&gt;</span>org.sonatype.central<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">groupId</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">artifactId</span><span class="cm-tag cm-bracket">&gt;</span>central-publishing-maven-plugin<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">artifactId</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">version</span><span class="cm-tag cm-bracket">&gt;</span>0.4.0<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">version</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">extensions</span><span class="cm-tag cm-bracket">&gt;</span>true<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">extensions</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">configuration</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">publishingServerId</span><span class="cm-tag cm-bracket">&gt;</span>masiyi<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">publishingServerId</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">tokenAuth</span><span class="cm-tag cm-bracket">&gt;</span>true<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">tokenAuth</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">configuration</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">plugin</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">&lt;!-- &nbsp; sourceæºç æ’ä»¶ --&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">plugin</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">groupId</span><span class="cm-tag cm-bracket">&gt;</span>org.apache.maven.plugins<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">groupId</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">artifactId</span><span class="cm-tag cm-bracket">&gt;</span>maven-source-plugin<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">artifactId</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">version</span><span class="cm-tag cm-bracket">&gt;</span>2.2.1<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">version</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">executions</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">execution</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">id</span><span class="cm-tag cm-bracket">&gt;</span>attach-sources<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">id</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">goals</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">goal</span><span class="cm-tag cm-bracket">&gt;</span>jar-no-fork<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">goal</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">goals</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">execution</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">executions</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">plugin</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">&lt;!-- &nbsp; javadocæ’ä»¶ --&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">plugin</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">groupId</span><span class="cm-tag cm-bracket">&gt;</span>org.apache.maven.plugins<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">groupId</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">artifactId</span><span class="cm-tag cm-bracket">&gt;</span>maven-javadoc-plugin<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">artifactId</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">version</span><span class="cm-tag cm-bracket">&gt;</span>2.9.1<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">version</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">executions</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">execution</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">id</span><span class="cm-tag cm-bracket">&gt;</span>attach-javadocs<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">id</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">goals</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">goal</span><span class="cm-tag cm-bracket">&gt;</span>jar<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">goal</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">goals</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">execution</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">executions</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">plugin</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">plugin</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">groupId</span><span class="cm-tag cm-bracket">&gt;</span>org.apache.maven.plugins<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">groupId</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">artifactId</span><span class="cm-tag cm-bracket">&gt;</span>maven-gpg-plugin<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">artifactId</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">version</span><span class="cm-tag cm-bracket">&gt;</span>1.5<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">version</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">configuration</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">&lt;!-- åŒ¹é…å½“ä¸‹ç¯å¢ƒä¸­çš„ gpg.exe ä½ç½®ï¼Œé…ç½®è‡ªå·±çš„ gpg åç§° --&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">executable</span><span class="cm-tag cm-bracket">&gt;&lt;/</span><span class="cm-tag">executable</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">keyname</span><span class="cm-tag cm-bracket">&gt;&lt;/</span><span class="cm-tag">keyname</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">configuration</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">executions</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">execution</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">id</span><span class="cm-tag cm-bracket">&gt;</span>sign-artifacts<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">id</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">phase</span><span class="cm-tag cm-bracket">&gt;</span>verify<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">phase</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">goals</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">goal</span><span class="cm-tag cm-bracket">&gt;</span>sign<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">goal</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">goals</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">execution</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">executions</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">plugin</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">plugins</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">build</span><span class="cm-tag cm-bracket">&gt;</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 1411px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1411px;"></div></div></div></pre><p align="center"><i><b>æ„å»ºæˆåŠŸï¼</b></i></p><p><span>å¤§æƒŠå–œï¼Œçœ‹åˆ°åšä¸»è¯•äº†100å¤šæ¬¡ï¼Œæˆ‘ä¹Ÿå·®ä¸å¤ªå¤šğŸ˜­ğŸ˜­ğŸ˜­ğŸ˜­ï¼Œæœ€åæŒ‰ç…§è¿™ç¯‡æ•™ç¨‹æˆåŠŸçœŸæ˜¯ç¼˜åˆ†ï¼Œæ„å¤–ä¹‹å–œï¼</span></p><p><span>åœ¨æ„å»ºæˆåŠŸä¹‹åçš„æœç´¢ä¸­å‘ç°ï¼Œåœ¨ç»„ä»¶çš„è¯¦ç»†ç•Œé¢ä¸­ä¸‹æ‹‰å¯ä»¥çœ‹åˆ°è¿™ä¸ªç»„ä»¶çš„è¯¦ç»†çš„ </span><code>pom.xml</code><span> æ„å»ºä»£ç ã€‚è¿™ä¸ªçš„æ„å»ºä»£ç å¯ä»¥ä½œä¸ºæˆ‘ä»¬æ„å»ºè‡ªå·±é¡¹ç›®çš„å‚è€ƒã€‚</span></p><p><span>æˆ‘æ²¡æœ‰æ”¶åˆ°æç¤ºï¼Œä½†æ˜¯åœ¨</span><a href='https://www.51cto.com/article/740167.html'><span>è¿™ç¯‡æ–‡ç« </span></a><span>ä¸­æåˆ°ï¼š</span></p><blockquote><p><span>å¤§æ„å°±æ˜¯sonatypeåˆ°ä¸­å¤®ä»“åº“çš„åŒæ­¥æ˜¯æ¿€æ´»çš„ï¼Œå½“æˆ‘ä»¬æˆåŠŸå‘å¸ƒç»„ä»¶åï¼Œé€šå¸¸30åˆ†é’Ÿå·¦å³å°±å¯ä»¥åœ¨ </span><a href='https://repo1.maven.org/maven2/' target='_blank' class='url'>https://repo1.maven.org/maven2/</a><span>ä¸Šè®¿é—®åˆ°äº†ï¼Œä½†æ˜¯æ›´æ–°åˆ°</span><a href='https://search.maven.org/' target='_blank' class='url'>https://search.maven.org/</a><span>å¯èƒ½éœ€è¦4ä¸ªå°æ—¶ã€‚</span></p></blockquote><p><span>å¯¹ç»„ä»¶ä¿®æ”¹åä¸Šä¼ æ–°çš„ç»„ä»¶éœ€è¦è®¾ç½®</span><strong><span>æ–°çš„ç‰ˆæœ¬å·</span></strong><span>ã€‚</span></p><p>&nbsp;</p><div class='footnotes-area'  ><hr/>
<div class='footnote-line'><span class='md-fn-count'>1</span> <span>å§”æ‰˜æ¨¡å¼çš„è®¾è®¡æ€æƒ³çš„å®ç°ã€‚</span><code>convert</code><span>æ–¹æ³•æœ¬èº«å¹¶ä¸ç›´æ¥åŒ…å«è½¬æ¢é€»è¾‘ï¼Œè€Œæ˜¯ä½œä¸ºä¸€ä¸ªè°ƒåº¦è€…ï¼Œæ ¹æ®ç›®æ ‡ç±»å‹ä»ä¸€ä¸ªé¢„å®šä¹‰çš„æ˜ å°„ä¸­é€‰å–æ­£ç¡®çš„è½¬æ¢é€»è¾‘ï¼ˆå³</span><code>Function</code><span>å®ä¾‹ï¼‰ï¼Œç„¶åå§”æ‰˜ç»™è¿™ä¸ªé€‰ä¸­çš„è½¬æ¢å™¨å»æ‰§è¡Œå®é™…çš„è½¬æ¢æ“ä½œã€‚è¿™æ ·åšå¯ä»¥è®©</span><code>convert</code><span>æ–¹æ³•ä¿æŒç®€æ´ï¼ŒåŒæ—¶å…è®¸è½¬æ¢é€»è¾‘çš„é«˜åº¦å¯å®šåˆ¶å’Œæ‰©å±•ã€‚</span> <a name='dfref-footnote-1' href='#ref-footnote-1' title='å›åˆ°æ–‡æ¡£' class='reversefootnote' >â†©</a></div>
<div class='footnote-line'><span class='md-fn-count'>2</span> <span>å®ä¾‹çš„ç±»å‹å¯ä»¥é€šè¿‡ </span><code>instance.getClass()</code><span> è·å¾—</span> <a name='dfref-footnote-2' href='#ref-footnote-2' title='å›åˆ°æ–‡æ¡£' class='reversefootnote' >â†©</a></div>
<div class='footnote-line'><span class='md-fn-count'>3</span> <span>javaä¸­æ²¡æœ‰æ˜¾å¼æŒ‡é’ˆä½†æ˜¯è¿™é‡Œç”¨æŒ‡é’ˆçš„æ¦‚å¿µæ›´åˆé€‚</span> <a name='dfref-footnote-3' href='#ref-footnote-3' title='å›åˆ°æ–‡æ¡£' class='reversefootnote' >â†©</a></div>
<div class='footnote-line'><span class='md-fn-count'>4</span> <span>ParameterizedTypeæ˜¯Javaåå°„APIä¸­çš„ä¸€ä¸ªæ¥å£ï¼Œä¸»è¦ç”¨äºè¡¨ç¤ºå‚æ•°åŒ–çš„ç±»å‹ï¼Œå³æ³›å‹ç±»å‹ã€‚ç”±äºJavaçš„ç±»å‹æ“¦é™¤æœºåˆ¶ï¼Œéƒ¨åˆ†æ³›å‹ä¿¡æ¯åœ¨ç¼–è¯‘åçš„å­—èŠ‚ç ä¸­ä¸å¯ç”¨ï¼Œä½†é€šè¿‡æ­¤ç±»åå°„APIå¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šæ¢å¤å’Œåˆ©ç”¨è¿™äº›ä¿¡æ¯ã€‚</span> <a name='dfref-footnote-4' href='#ref-footnote-4' title='å›åˆ°æ–‡æ¡£' class='reversefootnote' >â†©</a></div></div></div></div>
</body>
</html>